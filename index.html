<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="When you fall down,keep on getting back up">
<meta property="og:type" content="website">
<meta property="og:title" content="Junsong’s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Junsong’s Blog">
<meta property="og:description" content="When you fall down,keep on getting back up">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Junsong’s Blog">
<meta name="twitter:description" content="When you fall down,keep on getting back up">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> Junsong’s Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-hk">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Junsong’s Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            標籤
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/16/泰国之旅前的做的功课/" itemprop="url">
                  泰国之旅前的做的功课
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-07-16T22:21:40+08:00" content="2016-07-16">
              2016-07-16
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/16/泰国之旅前的做的功课/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/16/泰国之旅前的做的功课/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[toc]</p>
<h3 id="&#x9910;&#x5385;&#x4E00;&#x89C8;"><a href="#&#x9910;&#x5385;&#x4E00;&#x89C8;" class="headerlink" title="&#x9910;&#x5385;&#x4E00;&#x89C8;"></a>&#x9910;&#x5385;&#x4E00;&#x89C8;</h3><blockquote>
<p>&#x9910;&#x5385;&#x7684;&#x4F18;&#x7F3A;&#x70B9;&#x53D6;&#x81EA;&#x4E8E;&#x7F51;&#x7EDC;&#x8BC4;&#x4EF7;&#xFF0C;&#x4EC5;&#x4F9B;&#x53C2;&#x8003;</p>
<h4 id="The-Hilltop"><a href="#The-Hilltop" class="headerlink" title="The Hilltop"></a>The Hilltop</h4><ul>
<li>&#x8425;&#x4E1A;&#x65F6;&#x95F4;&#xFF1A;&#x65E9;11&#xFF1A;00&#x2014;&gt;&#x665A;12&#xFF1A;00</li>
<li>&#x9910;&#x5385;&#x5730;&#x70B9;&#xFF1A;99 Moo 3, Ao Nang, Krabi Town 81000, Thailand</li>
<li>&#x9884;&#x5B9A;&#x7535;&#x8BDD;&#xFF1A;+66 75 637 195</li>
<li>&#x9884;&#x5B9A;&#x65B9;&#x5F0F;&#xFF1A; &#x9152;&#x5E97;&#x53EF;&#x4EE5;&#x63D0;&#x524D;&#x4E00;&#x5929;&#x5E2E;&#x9884;&#x5B9A;</li>
<li>&#x4F18;&#x70B9;&#xFF1A;</li>
<li>&#x4F4D;&#x4E8E;&#x5C71;&#x9876;</li>
<li>&#x9732;&#x5929;&#x9910;&#x5385;</li>
<li>&#x53EF;&#x770B;&#x65E5;&#x843D;&#xFF08;&#x65E5;&#x843D;&#x4E0B;&#x5348;&#x516D;&#x70B9;&#x5DE6;&#x53F3;&#xFF09;</li>
<li>&#x6709;&#x4E50;&#x961F;&#x6F14;&#x594F;</li>
<li>&#x636E;&#x8BF4;&#x9910;&#x5385;&#x6709;&#x63A5;&#x9001;</li>
<li>&#x7F3A;&#x70B9;&#xFF1A;</li>
<li>&#x8D35;&#xFF08;&#x4EBA;&#x5747;500-1000THB&#xFF09;</li>
<li>&#x83DC;&#x5473;&#x9053;&#x4E00;&#x822C;</li>
<li>&#x53C2;&#x8003;&#x56FE;&#x7247;&#xFF1A;<br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160330_1.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160330_2.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160330_4.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160330_5.png" alt="Alt text"></li>
<li>&#x4E2A;&#x4EBA;&#x5EFA;&#x8BAE;&#xFF1A;&#x5982;&#x679C;&#x60F3;&#x4F53;&#x9A8C;&#x4E00;&#x628A;&#x5915;&#x9633;&#x665A;&#x9910;&#xFF0C;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#xFF0C;&#x4F46;&#x6700;&#x597D;&#x662F;&#x5929;&#x6C14;&#x597D;&#x7684;&#x65F6;&#x5019;&#x53BB;&#xFF0C;&#x9884;&#x5B9A;&#x65E9;&#x70B9;<h4 id="Jungle-Kitchen"><a href="#Jungle-Kitchen" class="headerlink" title="Jungle Kitchen"></a>Jungle Kitchen</h4></li>
<li>&#x5165;&#x9009;&#x7406;&#x7531;&#xFF1A;&#x732B;&#x9014;&#x9E70;&#x4E0A;&#x6392;&#x540D;&#x7B2C;&#x4E00;</li>
<li>&#x8425;&#x4E1A;&#x65F6;&#x95F4;&#xFF1A;&#x4E0A;&#x5348;10&#xFF1A;00-&#x4E0B;&#x5348;2&#xFF1A;30 || &#x4E0B;&#x5348;4&#xFF1A;30-&#x665A;&#x4E0A;10&#xFF1A;00</li>
<li>&#x9910;&#x5385;&#x5730;&#x70B9;&#xFF1A;33, Moo 2, AO Nang Road, Ao Nang, Krabi Town, Thailand</li>
<li>&#x9884;&#x5B9A;&#x7535;&#x8BDD;&#xFF1A;&#x6CA1;&#x627E;&#x5230;</li>
<li>&#x4F18;&#x70B9;&#xFF1A;</li>
<li>&#x4E1C;&#x897F;&#x597D;&#x5403;&#xFF0C;&#x7F51;&#x4E0A;&#x90FD;&#x8FD9;&#x4E48;&#x8BF4;</li>
<li>&#x4FBF;&#x5B9C;&#xFF0C;&#x8D85;&#x7EA7;&#x4FBF;&#x5B9C;&#xFF01;</li>
<li>&#x73AF;&#x5883;&#x8FD8;&#x53EF;&#x4EE5;&#xFF0C;&#x539F;&#x59CB;&#x4EBA;&#x5C0F;&#x5C4B;<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&#x53D6;&#x4E00;&#x6BB5;&#x8BC4;&#x8BBA;</div><div class="line">&#x5F9E;&#x548C;&#x5E73;&#x62C9;&#x53E4;&#x5A1C;&#x6B65;&#x884C;&#x5927;&#x7D04;20&#x5206;&#x9418;&#xFF0C;&#x5728;&#x8857;&#x9053;&#x8F49;&#x89D2;&#x8655;&#x7684;&#x5DE6;&#x5074;&#x3002;&#x6BCF;&#x9053;&#x83DC;&#x7D04;50~100&#x9296;&#xFF0C;&#x5305;&#x542B;&#x9EB5;&#x98EF;&#x7B49;&#x4E3B;&#x98DF;&#x8207;&#x51B0;&#x7802;&#x90FD;&#x662F;&#x9019;&#x500B;&#x50F9;&#x683C;&#xFF0C;&#x83DC;&#x55AE;&#x4EE5;&#x6599;&#x7406;&#x65B9;&#x5F0F;&#x5206;&#x985E;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x642D;&#x914D;&#x7092;&#x54EA;&#x7A2E;&#x8089;&#x6216;&#x8766;&#x5B50;&#xFF0C;&#x83DC;&#x6EFF;&#x597D;&#x5403;&#x7684;&#xFF0C;&#x8FA3;&#x5EA6;&#x7D04; little~small&#x5C31;&#x884C;&#x4E86;&#x3002;</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<ul>
<li>&#x7F3A;&#x70B9;&#xFF1A;</li>
<li>&#x8FDC;&#xFF0C;&#x6CA1;&#x53BB;&#x8FC7;&#xFF0C;&#x4F30;&#x8BA1;30&#x5206;&#x949F;&#x8DEF;&#x7A0B;&#xFF0C;&#x627E;&#x5230;&#x8DEF;&#x7684;&#x60C5;&#x51B5;&#x4E0B;</li>
<li>&#x6CA1;&#x9884;&#x5B9A;&#x65B9;&#x5F0F;</li>
<li>&#x6709;&#x868A;&#x5B50;&#xFF0C;&#x8BB0;&#x5F97;&#x64E6;&#x9632;&#x868A;&#x6C34;</li>
<li>&#x53C2;&#x8003;&#x56FE;&#x7247;&#xFF1A;<br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160330_6.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160330_10.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160330_7.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160330_8.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160330_9.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160330_12.png" alt="Alt text"></li>
<li>&#x4E2A;&#x4EBA;&#x5EFA;&#x8BAE;&#xFF1A;&#x60F3;&#x53BB;&#x7684;&#x8BDD;&#x5F97;&#x63D0;&#x524D;&#x9884;&#x5B9A;&#xFF0C;&#x6CA1;&#x7535;&#x8BDD;&#xFF0C;&#x4F30;&#x8BA1;&#x5F97;&#x627E;&#x5230;&#x5E97;&#x9762;&#x624D;&#x80FD;&#x9884;&#x5B9A;&#xFF0C;&#x597D;&#x5403;&#x5C31;&#x5F97;&#x82B1;&#x8D39;&#x70B9;&#x529F;&#x592B;&#xFF0C;&#x4E0D;&#x662F;&#x5417;~</li>
<li>&#x7F51;&#x4E0A;&#x63A8;&#x8350;&#x83DC;&#x5F0F;&#xFF1A;<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#x8FD9;&#x4E9B;&#x83DC;&#x82F1;&#x6587;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;%&gt;_&lt;%</div><div class="line">&#x83E0;&#x841D;&#x70E4;&#x9C7C;&#xFF0C;&#x5496;&#x55B1;&#x8783;&#x87F9;&#xFF0C;&#x9ED1;&#x6912;&#x7092;&#x867E;,&#x6CF0;&#x5F0F;&#x7092;&#x6CB3;&#x7C89;,&#x9A6C;&#x65AF;&#x66FC;</div><div class="line">Tom Yum Goong soup &#xFF0C; Red Curry&#xFF0C;</div><div class="line">Massaman Curry</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/./Snip20160330_13.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/./Snip20160330_14.png" alt="Alt text"></p>
<h4 id="Ton-Ma-Yom-Thai-Food-Restaurant"><a href="#Ton-Ma-Yom-Thai-Food-Restaurant" class="headerlink" title="Ton Ma Yom Thai Food Restaurant"></a>Ton Ma Yom Thai Food Restaurant</h4><ul>
<li>&#x5165;&#x699C;&#x7406;&#x7531;&#xFF1A;&#x732B;&#x9014;&#x9E70;&#x6392;&#x540D;&#x7B2C;&#x4E8C;&#xFF0C;&#x91CD;&#x8981;&#x7684;&#x662F;&#xFF0C;&#x6709;&#x7535;&#x8BDD;&#xFF01;</li>
<li>&#x8425;&#x4E1A;&#x65F6;&#x95F4;&#xFF1A;8am-2pm 5pm-9.30pm</li>
<li>&#x9910;&#x5385;&#x5730;&#x70B9;&#xFF1A;262/7 Moo 2, Soi 11 Leelavalley, Ao Nang, Krabi Town 81000, Thailand</li>
<li>&#x9884;&#x8BA2;&#x7535;&#x8BDD;&#xFF1A;+66 89 735 0605</li>
<li>&#x9884;&#x8BA2;&#x65B9;&#x5F0F;&#xFF1A;&#x524D;&#x53F0;&#x9884;&#x8BA2;&#xFF0C;&#x7535;&#x8BDD;&#x9884;&#x8BA2;</li>
<li>&#x4F18;&#x70B9;&#xFF1A;</li>
<li>&#x597D;&#x5403;&#xFF01;</li>
<li>&#x4FBF;&#x5B9C;</li>
<li>&#x6B63;&#x5B97;</li>
<li>&#x8FD9;&#x4E9B;&#x8FD8;&#x4E0D;&#x591F;&#x5417;&#xFF1F;</li>
<li>&#x7F3A;&#x70B9;</li>
<li>&#x504F;&#x50FB;&#x5427;&#xFF0C;&#x6CA1;&#x53BB;&#x8FC7;&#xFF0C;&#x8981;&#x5BFC;&#x822A;</li>
<li><p>&#x53C2;&#x8003;&#x56FE;&#x7247;<br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160330_16.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160330_18.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160330_17.png" alt="Alt text"></p>
</li>
<li><p>&#x4E2A;&#x4EBA;&#x5EFA;&#x8BAE;&#xFF1A;&#x60F3;&#x5C1D;&#x5C1D;&#x6B63;&#x5B97;&#x7684;&#x6CF0;&#x56FD;&#x83DC;&#xFF0C;&#x5C31;&#x53BB;&#x5427;&#xFF01;</p>
</li>
<li>&#x7F51;&#x4E0A;&#x63A8;&#x8350;&#x83DC;&#x5F0F;<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#x8292;&#x679C;&#x7CEF;&#x7C73;&#x996D;&#xFF0C;&#x6CF0;&#x56FD;&#x7092;&#x6CB3;&#x7C89;&#xFF0C;&#x6930;&#x5B50;&#x5496;&#x55B1;&#xFF0C;&#x7EFF;&#x5496;&#x55B1;&#x725B;&#x8089;&#xFF0C;&#x7092;&#x6742;&#x83DC;&#xFF0C;&#x51AC;&#x9634;&#x529F;&#x6D77;&#x9C9C;&#x6C64;</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160331_22.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160331_21.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160331_23.png" alt="Alt text"></p>
<ul>
<li>&#x4E00;&#x4E9B;&#x597D;&#x8BC4;&#xFF1A;<br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160331_20.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160331_24.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160331_26.png" alt="Alt text"><h4 id="Diver&#x2019;s-Inn-Steakhouse-and-International-Cuisine"><a href="#Diver&#x2019;s-Inn-Steakhouse-and-International-Cuisine" class="headerlink" title="Diver&#x2019;s Inn Steakhouse and International Cuisine"></a>Diver&#x2019;s Inn Steakhouse and International Cuisine</h4></li>
<li>&#x5165;&#x699C;&#x7406;&#x7531;&#xFF0C;&#x5403;&#x817B;&#x4E86;&#x6CF0;&#x56FD;&#x83DC;&#xFF0C;&#x8FD8;&#x6709;&#x6B27;&#x6D32;&#x83DC;&#x5440;&#xFF0C;&#x522B;&#x8BF4;&#x6211;&#x8003;&#x8651;&#x4E0D;&#x5468;&#x5168;&#xFF0C;&#x5230;&#x65F6;&#x60F3;&#x6362;&#x53E3;&#x5473;&#x522B;&#x627E;&#x6211;&#x54E6;&#xFF01;</li>
<li>&#x8425;&#x4E1A;&#x65F6;&#x95F4;&#xFF1A;11am-11pm</li>
<li>&#x9910;&#x5385;&#x5730;&#x70B9;&#xFF1A;27/9 Moo 2 | 150 M Above Mc Donalds, Opp. Siam Commercial Bank, Ao Nang, Krabi Town 81180, Thailand</li>
<li>&#x9884;&#x8BA2;&#x7535;&#x8BDD;&#xFF1A;+66 75 637 297</li>
<li>&#x9884;&#x8BA2;&#x65B9;&#x5F0F;&#xFF1A;&#x7535;&#x8BDD;&#x9884;&#x5B9A;</li>
<li>&#x618B;&#x8BF4;&#x8BDD;&#xFF01;&#x5148;&#x770B;&#x56FE;<br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160331_27.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160331_28.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160331_31.png" alt="Alt text"></li>
<li>&#x4E00;&#x4E9B;&#x597D;&#x8BC4;&#xFF1A;<br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160331_33.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160331_34.png" alt="Alt text"><br><img src="/2016/07/16/&#x6CF0;&#x56FD;&#x4E4B;&#x65C5;&#x524D;&#x7684;&#x505A;&#x7684;&#x529F;&#x8BFE;/Snip20160331_35.png" alt="Alt text"></li>
<li>&#x63A8;&#x8350;&#x83DC;&#x5F0F;&#xFF1A;<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#x808B;&#x773C;&#x725B;&#x6392;(rib eye)</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Lae-Lay-Grill"><a href="#Lae-Lay-Grill" class="headerlink" title="Lae Lay Grill"></a>Lae Lay Grill</h4><ul>
<li>&#x5165;&#x699C;&#x7406;&#x7531;<h4 id="May-amp-Zin-Restaurant"><a href="#May-amp-Zin-Restaurant" class="headerlink" title="May&amp;Zin. Restaurant"></a>May&amp;Zin. Restaurant</h4></li>
<li>&#x5165;&#x699C;&#x7406;&#x7531;<h3 id="&#x96F6;&#x98DF;&#x836F;&#x54C1;"><a href="#&#x96F6;&#x98DF;&#x836F;&#x54C1;" class="headerlink" title="&#x96F6;&#x98DF;&#x836F;&#x54C1;"></a>&#x96F6;&#x98DF;&#x836F;&#x54C1;</h3></li>
<li>mama&#x65B9;&#x4FBF;&#x9762;</li>
<li>&#x6CF0;&#x56FD;&#x7EA2;&#x725B;</li>
<li>&#x9632;&#x868A;&#x836F;</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/12/图片无限循环/" itemprop="url">
                  图片无限循环
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-07-12T09:07:49+08:00" content="2016-07-12">
              2016-07-12
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/12/图片无限循环/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/12/图片无限循环/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ps&#xFF1A;&#x6587;&#x4E2D;imageView&#x4E0E;image&#x662F;&#x5212;&#x5206;&#x5F97;&#x975E;&#x5E38;&#x6E05;&#x695A;&#x7684;&#xFF0C;image&#x6709;&#x65F6;&#x4E5F;&#x7528;<code>&#x56FE;&#x7247;</code>&#x8868;&#x793A;</p>
<ul>
<li>&#x56FE;&#x7247;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#x7684;&#x6587;&#x7AE0;&#x7F51;&#x4E0A;&#x5DF2;&#x7ECF;&#x6709;&#x4E00;&#x5927;&#x5806;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x8FD8;&#x662F;&#x5E0C;&#x671B;&#x81EA;&#x5DF1;&#x80FD;&#x5199;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x8BE6;&#x7EC6;&#x7684;&#x89E3;&#x8BFB;&#x6587;&#x7AE0;&#x51FA;&#x6765;</li>
<li>&#x6211;&#x4F1A;&#x5148;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x6587;&#x5B57;&#x52A0;&#x56FE;&#x7247;&#x63CF;&#x8FF0;&#x5B9E;&#x73B0;&#x7684;&#x539F;&#x7406;&#xFF0C;&#x6700;&#x540E;&#x518D;&#x4E0A;&#x4EE3;&#x7801;</li>
<li>&#x5728;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#x4E2D;&#x6211;&#x53EA;&#x4F7F;&#x7528;3&#x5F20;ImageView&#xFF0C;&#x5728;&#x4E0D;&#x65AD;&#x7684;&#x6ED1;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4E0D;&#x4F1A;&#x53BB;&#x79FB;&#x52A8;ImageView&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x6211;&#x8981;&#x505A;&#x7684;&#x53EA;&#x6709;&#x4E24;&#x4EF6;&#x4E8B;&#xFF1A;</li>
<li>&#x6BCF;&#x6B21;&#x6ED1;&#x52A8;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x8BA1;&#x7B97;&#x597D;imageView&#x65B0;&#x7684;image&#xFF0C;&#x7136;&#x540E;&#x8BBE;&#x7F6E;&#x7ED9;imageView</li>
<li><p>&#x7D27;&#x63A5;&#x7740;&#x91CD;&#x65B0;&#x8BBE;&#x7F6E;scrollView&#x7684;contentoffsize</p>
</li>
<li><p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4F1A;&#x56FE;&#x89E3;&#x4E0A;&#x9762;&#x6240;&#x8BF4;&#x7684;&#x4E24;&#x4E2A;&#x6B65;&#x9AA4;&#xFF1A;</p>
</li>
<li>&#x5148;&#x5047;&#x8BBE;&#x6211;&#x6709;5&#x5F20;&#x5E7F;&#x544A;&#x56FE;&#x7247;,&#x7531;&#x4E8E;&#x5BBD;&#x5EA6;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x53EA;&#x663E;&#x793A;&#x4E09;&#x5F20;&#xFF0C;&#x56FE;&#x7247;&#x4E2D;&#x7684;&#x6570;&#x5B57;&#x4EE3;&#x8868;&#x7B2C;&#x51E0;&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x770B;&#x6E05;&#x695A;&#xFF0C;&#x662F;<code>&#x56FE;&#x7247;</code>&#x4E0D;&#x662F;imageView!<br><img src="/2016/07/12/&#x56FE;&#x7247;&#x65E0;&#x9650;&#x5FAA;&#x73AF;/Snip20150626_1.png" alt="&#x521D;&#x59CB;&#x56FE;&#x7247;&#x663E;&#x793A;&#x72B6;&#x6001;"></li>
<li>&#x4E00;&#x5F00;&#x59CB;&#xFF0C;&#x628A;contentoffset&#x8BBE;&#x7F6E;&#x5230;&#x4E2D;&#x95F4;&#x7684;&#x90A3;&#x5F20;imageView&#x4E0A;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x663E;&#x793A;&#x4E2D;&#x95F4;&#x7684;imageView&#xFF0C;&#x5E76;&#x4E14;&#x4EE5;&#x540E;&#x6BCF;&#x6B21;&#x6EDA;&#x52A8;&#x5B8C;&#x90FD;&#x4F1A;&#x8FDB;&#x884C;&#x8FD9;&#x6837;&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x8FD9;&#x91CC;&#x5148;&#x8BB0;&#x4F4F;</li>
<li>&#x56FE;&#x4E2D;&#x663E;&#x793A;&#x7684;&#x662F;&#x7B2C;0&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x6240;&#x4EE5;&#x5411;&#x5DE6;&#x6ED1;&#x52A8;&#x663E;&#x793A;&#x7684;&#x80AF;&#x5B9A;&#x662F;&#x6700;&#x540E;&#x4E00;&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x7B2C;4&#x5F20;&#xFF0C;&#x540C;&#x7406;&#xFF0C;&#x53F3;&#x6ED1;&#x662F;&#x7B2C;1&#x5F20;</li>
<li>&#x6240;&#x4EE5;&#xFF0C;&#x4E09;&#x5F20;imageView&#x5206;&#x522B;&#x653E;&#x7F6E;&#x7B2C;4&#xFF0C;&#x7B2C;0&#xFF0C;&#x7B2C;1&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x662F;&#x975E;&#x5E38;&#x6B63;&#x5E38;&#x7684;</li>
<li>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x5411;&#x53F3;&#x6ED1;&#x52A8;&#xFF1A;<br><img src="/2016/07/12/&#x56FE;&#x7247;&#x65E0;&#x9650;&#x5FAA;&#x73AF;/Snip20150626_3.png" alt="&#x6ED1;&#x52A8;&#x540E;&#x5E94;&#x8BE5;&#x663E;&#x793A;&#x7684;&#x72B6;&#x6001;"></li>
<li>&#x5927;&#x5BB6;&#x6CE8;&#x610F;&#x770B;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x53EA;&#x8BBE;&#x7F6E;&#x4E86;&#x4E09;&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x90A3;&#x4E48;&#x7ECF;&#x8FC7;&#x6211;&#x4EEC;&#x5411;&#x53F3;&#x6ED1;&#x52A8;&#xFF0C;&#x5C4F;&#x5E55;&#x5E94;&#x8BE5;&#x663E;&#x793A;&#x7684;&#x5E94;&#x8BE5;&#x662F;&#x7B2C;1&#x5F20;&#xFF0C;&#x800C;&#x5DE6;&#x8FB9;&#x7684;imageView&#x653E;&#x7F6E;&#x7684;&#x5E94;&#x8BE5;&#x662F;&#x7B2C;0&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x53F3;&#x8FB9;&#x7684;imageView&#x653E;&#x7F6E;&#x7684;&#x5219;&#x662F;&#x7B2C;2&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x8FD9;&#x662F;&#x7406;&#x6240;&#x5F53;&#x7136;&#x7684;</li>
<li>&#x8FD9;&#x65F6;&#xFF0C;&#x5927;&#x5BB6;&#x80AF;&#x5B9A;&#x4F1A;&#x6709;&#x7591;&#x95EE;&#xFF0C;&#x6211;&#x4EEC;&#x521A;&#x521A;&#x4E0D;&#x662F;&#x53F3;&#x6ED1;&#x4E86;&#x4E48;&#xFF0C;&#x5C4F;&#x5E55;&#x5E94;&#x8BE5;&#x505C;&#x7559;&#x5728;&#x7B2C;&#x4E09;&#x5F20;imageView&#x4E0A;&#xFF0C;&#x5E76;&#x4E14;&#x53F3;&#x8FB9;&#x5DF2;&#x7ECF;&#x6CA1;&#x6709;imageView&#x4E86;&#xFF0C;scrollView&#x5DF2;&#x7ECF;&#x6ED1;&#x52A8;&#x5230;&#x5934;&#x4E86;&#xFF0C;&#x800C;&#x5DE6;&#x8FB9;&#x4E24;&#x5F20;imageView&#x4F9D;&#x7136;&#x653E;&#x7F6E;&#x7684;&#x662F;&#x7B2C;4&#x5F20;&#x548C;&#x7B2C;0&#x5F20;&#x56FE;&#x7247;&#x554A;&#xFF0C;&#x4F60;&#x73B0;&#x5728;&#x662F;&#x795E;&#x9A6C;&#x60C5;&#x51B5;&#xFF1F;</li>
<li>&#x5927;&#x5BB6;&#x7684;&#x7591;&#x95EE;&#x662F;&#x975E;&#x5E38;&#x6B63;&#x786E;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x60F3;&#x8BF7;&#x5927;&#x5BB6;&#x60F3;&#x4E00;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x5728;&#x5411;&#x53F3;&#x6ED1;&#x52A8;&#x8FD9;&#x4E2A;&#x7528;&#x6237;&#x64CD;&#x4F5C;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x6211;&#x9A6C;&#x4E0A;&#x66FF;&#x6362;&#x8FD9;&#x4E09;&#x5F20;imageView&#x7684;image&#xFF0C;&#x8BA9;&#x4E09;&#x5F20;imageView&#x5206;&#x522B;&#x663E;&#x793A;&#x7B2C;0&#xFF0C;&#x7B2C;1&#xFF0C;&#x7B2C;2&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x5E76;&#x4E14;&#xFF0C;&#x9A6C;&#x4E0A;&#x8BBE;&#x7F6E;scrollView&#x7684;contentoffset&#x4E8E;&#x4E2D;&#x95F4;&#x7684;&#x90A3;&#x5F20;imageView&#x4E0A;&#xFF0C;&#x770B;&#x6E05;&#x695A;&#x54C8;&#xFF0C;&#x662F;&#x9A6C;&#x4E0A;&#xFF01;</li>
<li>&#x7ECF;&#x8FC7;&#x4E0A;&#x9762;&#x90A3;&#x4E00;&#x5C0F;&#x6BB5;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x7684;scrollView&#x4E0D;&#x5C31;&#x662F;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#x4E86;&#x4E48;&#xFF1A;<br><img src="/2016/07/12/&#x56FE;&#x7247;&#x65E0;&#x9650;&#x5FAA;&#x73AF;/Snip20150626_4.png" alt=""></li>
<li>&#x8FD9;&#x65F6;&#x5019;&#xFF0C;&#x6709;&#x4E2A;&#x5173;&#x952E;&#x70B9;&#x6211;&#x5FC5;&#x987B;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#x4E00;&#x4E0B;&#xFF0C;&#x5728;&#x4E0A;&#x8FF0;&#x6B65;&#x9AA4;&#x64CD;&#x4F5C;&#x4E2D;&#xFF0C;&#x6211;&#x7684;&#x786E;&#x662F;&#x5148;&#x628A;&#x6BCF;&#x4E2A;imageView&#x5E94;&#x8BE5;&#x663E;&#x793A;&#x7684;&#x56FE;&#x7247;&#x8BBE;&#x7F6E;&#x5B8C;&#x6BD5;&#x540E;&#xFF0C;&#x518D;&#x6765;&#x8BBE;&#x7F6E;contentoffset&#x56DE;&#x5F52;&#x4E8E;&#x4E2D;&#x95F4;</li>
<li>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x6309;&#x7167;&#x6B63;&#x5E38;&#x903B;&#x8F91;&#xFF0C;&#x5C4F;&#x5E55;&#x66FE;&#x6709;&#x90A3;&#x4E48;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x663E;&#x793A;&#x7684;&#x5E94;&#x8BE5;&#x662F;&#x7B2C;3&#x4E2A;imageView&#x4E0A;&#x7684;&#x7B2C;2&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x7ECF;&#x8FC7;&#x5F3A;&#x5236;&#x8BBE;&#x7F6E;contentoffset&#xFF0C;&#x518D;&#x6B21;&#x663E;&#x793A;&#x7B2C;2&#x5F20;imageView&#x7684;&#x56FE;&#x7247;</li>
<li>&#x6211;&#x66FE;&#x7ECF;&#x4E5F;&#x6709;&#x8FC7;&#x8FD9;&#x6837;&#x7684;&#x7591;&#x95EE;&#xFF0C;&#x4F46;&#x662F;&#x5927;&#x5BB6;&#x60F3;&#x60F3;&#x770B;&#xFF0C;&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x4E00;&#x884C;&#x7684;&#x9700;&#x8981;&#x7684;&#x65F6;&#x95F4;&#x662F;&#x591A;&#x5C11;&#xFF1F;&#x5F53;&#x524D;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x521A;&#x628A;&#x754C;&#x9762;&#x7684;&#x56FE;&#x7247;&#x7ED9;&#x6362;&#x4E86;&#xFF0C;&#x540E;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x5C31;&#x9A6C;&#x4E0A;&#x628A;contentoffset&#x7ED9;&#x91CD;&#x7F6E;&#x4E86;&#xFF0C;&#x4F60;&#x89C9;&#x5F97;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x770B;&#x5230;&#x521A;&#x66FF;&#x6362;&#x7684;&#x56FE;&#x7247;&#x4E48;&#xFF1F;</li>
<li>&#x6240;&#x4EE5;&#x8BF4;&#xFF0C;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x8D64;&#x679C;&#x679C;&#x7684;&#x969C;&#x773C;&#x6CD5;&#xFF01;<h2 id="&#x4EE3;&#x7801;&#x89E3;&#x91CA;"><a href="#&#x4EE3;&#x7801;&#x89E3;&#x91CA;" class="headerlink" title="&#x4EE3;&#x7801;&#x89E3;&#x91CA;"></a>&#x4EE3;&#x7801;&#x89E3;&#x91CA;</h2></li>
<li>&#x6211;&#x5148;&#x5206;&#x6BB5;&#x4EE3;&#x7801;&#x89E3;&#x91CA;&#xFF0C;&#x518D;&#x5728;&#x6700;&#x540E;&#x4E0A;&#x5B8C;&#x6574;&#x7684;&#x4EE3;&#x7801;</li>
<li>&#x6574;&#x4E2A;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#x529F;&#x80FD;&#x5176;&#x5B9E;&#x91CD;&#x70B9;&#x53EA;&#x5728;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;&#x91CC;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//&#x8FD9;&#x56DB;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x7075;&#x9B42;</span></div><div class="line"><span class="comment">//&#x91CD;&#x7F6E;imageView&#x7684;&#x56FE;&#x7247;&#x4E0E;&#x91CD;&#x7F6E;contentoffset&#x4E8E;&#x4E2D;&#x95F4;&#x7684;&#x65B9;&#x6CD5;</span></div><div class="line">- (<span class="keyword">void</span>)updateImage</div><div class="line">{</div><div class="line"><span class="comment">//1.&#x904D;&#x5386;scrollview&#x7684;&#x4E09;&#x4E2A;imageView</span></div><div class="line"><span class="keyword">for</span> (<span class="built_in">NSUInteger</span> i = <span class="number">0</span>; i &lt; <span class="keyword">self</span>.scrollView.subviews.count; i++) {</div><div class="line"><span class="comment">//1.1&#x6309;&#x987A;&#x5E8F;&#x62FF;&#x5230;imageView</span></div><div class="line"><span class="built_in">UIImageView</span> *imagV = <span class="keyword">self</span>.scrollView.subviews[i];</div><div class="line"><span class="comment">//1.2&#x62FF;&#x5230;&#x5F53;&#x524D;&#x663E;&#x793A;&#x7684;&#x9875;&#x6570;</span></div><div class="line"><span class="built_in">NSInteger</span> index = <span class="keyword">self</span>.pageControl.currentPage;</div><div class="line"><span class="comment">//1.3&#x5982;&#x679C;&#x662F;&#x7B2C;&#x4E00;&#x5F20;imageView&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6700;&#x5DE6;&#x8FB9;&#x7684;&#x90A3;&#x5F20;imageView</span></div><div class="line"><span class="keyword">if</span> (i == <span class="number">0</span>) {</div><div class="line">index--;<span class="comment">//1.4&#x5E94;&#x5F53;&#x663E;&#x793A;&#x7684;&#x56FE;&#x7247;&#x5E94;&#x8BE5;&#x662F;&#x5F53;&#x524D;&#x9875;&#x6570;&#xFF08;&#x663E;&#x793A;&#x7684;&#x56FE;&#x7247;&#x524D;&#x4E00;&#x5F20;&#xFF09;&#x51CF;&#x4E00;</span></div><div class="line">}<span class="keyword">else</span> <span class="keyword">if</span>(i == <span class="number">2</span>)<span class="comment">//1.5&#x5982;&#x679C;&#x662F;&#x7B2C;&#x4E09;&#x5F20;imageView&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6700;&#x53F3;&#x8FB9;&#x7684;imageView</span></div><div class="line">{</div><div class="line">index++;<span class="comment">//1.6&#x5E94;&#x5F53;&#x663E;&#x793A;&#x7684;&#x56FE;&#x7247;&#x5E94;&#x8BE5;&#x662F;&#x5F53;&#x524D;&#x9875;&#x6570;&#xFF08;&#x663E;&#x793A;&#x7684;&#x56FE;&#x7247;&#x540E;&#x4E00;&#x5F20;&#xFF09;&#x52A0;&#x4E00;</span></div><div class="line">}</div><div class="line"><span class="comment">//2.1&#x4E24;&#x79CD;&#x7279;&#x6B8A;&#x60C5;&#x51B5;</span></div><div class="line"><span class="comment">//2.2&#x5F53;&#x4E2D;&#x95F4;&#x7684;imageView&#x663E;&#x793A;&#x7684;&#x662F;&#x7B2C;0&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x90A3;&#x4E48;currentpage&#x5C31;&#x662F;0&#xFF0C;&#x5DE6;&#x8FB9;&#x7684;imageView&#x6309;&#x7406;&#x6765;&#x8BF4;&#x5E94;&#x8BE5;&#x663E;&#x793A;&#x7684;&#x662F;&#x6700;&#x540E;&#x4E00;&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x8FD9;&#x6848;&#x4F8B;&#x6709;&#x4E94;&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x6240;&#x4EE5;&#x4E5F;&#x5C31;&#x662F;&#x7B2C;4&#x5F20;&#xFF0C;&#x7531;&#x4E8E;&#x4E4B;&#x524D;index--&#x4E3A;-1&#xFF0C;&#x6240;&#x4EE5;&#x8FDB;&#x5165;&#x5224;&#x65AD;</span></div><div class="line"><span class="keyword">if</span> (index &lt; <span class="number">0</span>) {</div><div class="line">index = <span class="keyword">self</span>.pageControl.numberOfPages - <span class="number">1</span>;<span class="comment">//2.3&#x628A;&#x9875;&#x6570;&#x91CD;&#x7F6E;&#x4F4D;&#x6700;&#x540E;&#x4E00;&#x5F20;</span></div><div class="line">}<span class="keyword">else</span> <span class="keyword">if</span>(index &gt;= <span class="keyword">self</span>.pageControl.numberOfPages )<span class="comment">//2.4&#x8FD9;&#x662F;&#x53E6;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#xFF0C;&#x5F53;&#x6ED1;&#x52A8;&#x5230;&#x6700;&#x53F3;&#x8FB9;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E2D;&#x95F4;imageView&#x663E;&#x793A;&#x7684;&#x662F;&#x7B2C;&#x4E94;&#x5F20;&#x56FE;&#x7247;&#x65F6;&#xFF0C;&#x9875;&#x7801;&#x4E3A;5&#xFF0C;currentpage&#x4E3A;4&#xFF0C;&#x7531;&#x4E8E;&#x524D;&#x9762;index++&#x4E3A;5&#xFF0C;&#x6240;&#x4EE5;&#x8FDB;&#x5165;&#x8BE5;if&#x5224;&#x5B9A;&#xFF0C;&#x5C06;&#x53F3;&#x8FB9;&#x7684;imageView&#x7684;currentpage&#x8BBE;&#x4E3A;0</span></div><div class="line">{</div><div class="line">index = <span class="number">0</span>;<span class="comment">//2.5&#x5C06;&#x53F3;&#x8FB9;&#x7684;imageView&#x7684;currentpage&#x8BBE;&#x4E3A;0</span></div><div class="line">}</div><div class="line"></div><div class="line">imagV.tag = index;<span class="comment">//&#x5C06;&#x6BCF;&#x4E00;&#x5F20;imageView&#x7684;currentpage&#x4F5C;&#x4E3A;&#x5176;tag&#x503C;&#xFF0C;&#x7528;&#x4E8E;scrollViewDidScroll&#x65B9;&#x6CD5;&#x8BA1;&#x7B97;currentpage&#x7528;</span></div><div class="line">imagV.image = [<span class="built_in">UIImage</span> imageNamed:<span class="keyword">self</span>.imageNames[index]];<span class="comment">//&#x91CD;&#x7F6E;&#x4E09;&#x5F20;imageView&#x5E94;&#x5F53;&#x663E;&#x793A;&#x7684;&#x56FE;&#x7247;</span></div><div class="line">}</div><div class="line"><span class="comment">//&#x524D;&#x9762;&#x91CD;&#x65B0;&#x8BBE;&#x7F6E;&#x5B8C;imageView&#x7684;image&#x540E;&#xFF0C;&#x91CD;&#x7F6E;contentoffset&#xFF0C;&#x4F7F;scrollview&#x518D;&#x6B21;&#x663E;&#x793A;&#x4E2D;&#x95F4;&#x7684;imageView&#xFF0C;&#x8BBE;&#x7F6E;&#x4E0D;&#x5E26;&#x52A8;&#x753B;&#xFF0C;&#x6240;&#x4EE5;&#x7528;&#x6237;&#x65E0;&#x6CD5;&#x611F;&#x89C9;&#x5230;&#x754C;&#x9762;&#x6709;&#x6240;&#x91CD;&#x7F6E;</span></div><div class="line"><span class="keyword">if</span> (_isPortrait) {</div><div class="line"><span class="keyword">self</span>.scrollView.contentOffset = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="keyword">self</span>.scrollView.frame.size.height);</div><div class="line">}<span class="keyword">else</span></div><div class="line">{</div><div class="line"><span class="keyword">self</span>.scrollView.contentOffset = <span class="built_in">CGPointMake</span>(<span class="keyword">self</span>.scrollView.frame.size.width, <span class="number">0</span>);</div><div class="line">}</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//&#x5B9A;&#x65F6;&#x5668;&#x8981;&#x8D70;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x8DF3;&#x8F6C;&#x5230;&#x4E0B;&#x4E00;&#x5F20;imageView</span></div><div class="line">- (<span class="keyword">void</span>)next</div><div class="line">{</div><div class="line"><span class="comment">//&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;contentoffset&#x6765;&#x8DF3;&#x8F6C;&#x4E0B;&#x4E00;&#x5F20;&#xFF0C;&#x662F;&#x5E26;&#x52A8;&#x753B;&#x7684;</span></div><div class="line"><span class="keyword">if</span> (_isPortrait) {</div><div class="line">[<span class="keyword">self</span>.scrollView setContentOffset:<span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">2</span> * <span class="keyword">self</span>.scrollView.frame.size.height) animated:<span class="literal">YES</span>];</div><div class="line">}<span class="keyword">else</span></div><div class="line">{</div><div class="line">[<span class="keyword">self</span>.scrollView setContentOffset:<span class="built_in">CGPointMake</span>(<span class="number">2</span> * <span class="keyword">self</span>.scrollView.frame.size.width, <span class="number">0</span>) animated:<span class="literal">YES</span>];</div><div class="line">}</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//&#x5728;&#x8FD9;&#x4E2A;scrollView&#x4E00;&#x52A8;&#x5C31;&#x4F1A;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x91CC;&#x8BA1;&#x7B97;currentPage</span></div><div class="line">-(<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView</div><div class="line">{</div><div class="line"><span class="comment">//&#x8BA1;&#x7B97;&#x7684;&#x601D;&#x8DEF;&#x5C31;&#x662F;&#x53D6;&#x51FA;&#x4E09;&#x5F20;imageView&#xFF0C;&#x5224;&#x65AD;&#x4E09;&#x4E2A;imageView&#x7684;origin.x&#x4E5F;&#x5C31;&#x662F;imageView&#x5DE6;&#x4E0A;&#x89D2;&#x7684;x&#x4E0E;&#x5F53;&#x524D;contentoffset.X</span></div><div class="line">&#x5DEE;&#x503C;&#x6700;&#x5C0F;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#xFF0C;&#x8FD9;&#x4E2A;imageView&#x7684;tag&#x503C;&#x5C31;&#x662F;&#x5F53;&#x524D;&#x7684;currentPage&#xFF0C;&#x8FD9;&#x4E2A;&#x601D;&#x8DEF;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x4E0D;&#x8FC7;&#x591A;&#x9610;&#x8FF0;</div><div class="line"><span class="built_in">NSInteger</span> page = <span class="number">0</span>;</div><div class="line"><span class="built_in">CGFloat</span> minDistance = MAXFLOAT;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;<span class="keyword">self</span>.scrollView.subviews.count; i++) {</div><div class="line"><span class="built_in">UIImageView</span> *imageView = <span class="keyword">self</span>.scrollView.subviews[i];</div><div class="line"><span class="built_in">CGFloat</span> distance = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (_isPortrait) {</div><div class="line">distance = ABS(imageView.frame.origin.y - scrollView.contentOffset.y);</div><div class="line">}<span class="keyword">else</span></div><div class="line">{</div><div class="line">distance = ABS(imageView.frame.origin.x - scrollView.contentOffset.x);<span class="comment">//&#x8BA1;&#x7B97;&#x5DEE;&#x503C;&#xFF0C;&#x5E76;&#x4E14;&#x53D6;&#x7EDD;&#x5BF9;&#x503C;</span></div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> (distance &lt; minDistance) {</div><div class="line">minDistance = distance;</div><div class="line">page = imageView.tag;</div><div class="line">}</div><div class="line">}</div><div class="line"><span class="keyword">self</span>.pageControl.currentPage = page;<span class="comment">//&#x8BBE;&#x7F6E;&#x5F53;&#x524D;&#x9875;&#x6570;</span></div><div class="line">}</div><div class="line"><span class="comment">//&#x6BCF;&#x6B21;&#x5B9A;&#x65F6;&#x8DF3;&#x8F6C;&#x52A8;&#x753B;&#x6216;&#x8005;&#x62D6;&#x62FD;&#x6EDA;&#x52A8;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x8C03;&#x7528;&#x91CD;&#x7F6E;&#x65B9;&#x6CD5;&#xFF0C;&#x628A;&#x56FE;&#x7247;&#x4E0E;&#x4F4D;&#x7F6E;&#x90FD;&#x91CD;&#x7F6E;&#xFF0C;&#x8FDB;&#x5165;&#x65B0;&#x7684;&#x5FAA;&#x73AF;</span></div><div class="line">-(<span class="keyword">void</span>)scrollViewDidEndScrollingAnimation:(<span class="built_in">UIScrollView</span> *)scrollView<span class="comment">//timer&#x52A8;&#x753B;&#x7ED3;&#x675F;&#x8C03;&#x7528;</span></div><div class="line">{</div><div class="line">[<span class="keyword">self</span> updateImage];</div><div class="line">}</div><div class="line">-(<span class="keyword">void</span>)scrollViewDidEndDecelerating:(<span class="built_in">UIScrollView</span> *)scrollView<span class="comment">//&#x62D6;&#x62FD;&#x6EDA;&#x52A8;&#x505C;&#x6B62;&#x8C03;&#x7528;</span></div><div class="line">{</div><div class="line">[<span class="keyword">self</span> updateImage];</div><div class="line">}</div></pre></td></tr></table></figure>
<ul>
<li>&#x6211;&#x5DF2;&#x7ECF;&#x5C06;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#x7684;&#x7075;&#x9B42;&#x601D;&#x60F3;&#x4E0E;&#x4EE3;&#x7801;&#x7ED3;&#x5408;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x8BE6;&#x7EC6;&#x53D9;&#x8FF0;&#x4E86;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x5C31;&#x4E0D;&#x8FC7;&#x591A;&#x89E3;&#x91CA;&#x4E86;&#xFF0C;&#x89E3;&#x91CA;&#x591A;&#x4E86;&#x53CD;&#x800C;&#x4F1A;&#x9020;&#x6210;&#x53CD;&#x6548;&#x679C;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x662F;&#x8FD9;&#x4E2A;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#x7684;&#x6574;&#x4F53;&#x4EE3;&#x7801;&#xFF0C;&#x6B22;&#x8FCE;&#x62FF;&#x6765;&#x4F7F;&#x7528;</li>
</ul>
<h2 id="&#x5B8C;&#x6574;&#x4EE3;&#x7801;"><a href="#&#x5B8C;&#x6574;&#x4EE3;&#x7801;" class="headerlink" title="&#x5B8C;&#x6574;&#x4EE3;&#x7801;"></a>&#x5B8C;&#x6574;&#x4EE3;&#x7801;</h2><h3 id="&#x4F7F;&#x7528;"><a href="#&#x4F7F;&#x7528;" class="headerlink" title="&#x4F7F;&#x7528;"></a>&#x4F7F;&#x7528;</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//&#x63A7;&#x5236;&#x5668;&#x4E2D;&#x7684;&#x4F7F;&#x7528;&#x4EE3;&#x7801;</span></div><div class="line"><span class="comment">/*</span></div><div class="line">loopPageView *loopV = [[loopPageView alloc]init];</div><div class="line">loopV.imageNames = @[@&quot;img_00&quot;,@&quot;img_01&quot;,@&quot;img_02&quot;,@&quot;img_03&quot;,@&quot;img_04&quot;];</div><div class="line">loopV.frame = CGRectMake(0, 0, 300, 130);</div><div class="line">//    loopV.isPortrait = YES;//&#x6253;&#x5F00;&#x5C31;&#x4F1A;&#x7AD6;&#x7740;&#x663E;&#x793A;</div><div class="line">[self.view addSubview:loopV];</div><div class="line">*/</div></pre></td></tr></table></figure>
<h3 id="loopPageView-h"><a href="#loopPageView-h" class="headerlink" title="loopPageView.h"></a>loopPageView.h</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//loopPageView.h</span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">loopPageView</span> : <span class="title">UIView</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span> ,<span class="keyword">strong</span>)<span class="built_in">NSArray</span> *imageNames;</div><div class="line"><span class="comment">/**</span></div><div class="line">*  &#x662F;&#x5426;&#x5782;&#x76F4;&#x663E;&#x793A;</div><div class="line">*/</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">BOOL</span> isPortrait;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<h3 id="loopPageView-m"><a href="#loopPageView-m" class="headerlink" title="loopPageView.m"></a>loopPageView.m</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//loopPageView.m</span></div><div class="line"><span class="meta">#import <span class="meta-string">&quot;loopPageView.h&quot;</span></span></div><div class="line"></div><div class="line"><span class="meta">#define imageViewCount 3</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">loopPageView</span> ()&lt;<span class="title">UIScrollViewDelegate</span>&gt;</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">weak</span>) <span class="built_in">UIScrollView</span> *scrollView;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">weak</span>) <span class="built_in">UIPageControl</span> *pageControl;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">weak</span>) <span class="built_in">NSTimer</span> *timer;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">loopPageView</span></span></div><div class="line"><span class="meta">#pragma mark -</span></div><div class="line"><span class="meta">#pragma mark Life Cycle</span></div><div class="line">-(<span class="keyword">instancetype</span>)initWithFrame:(<span class="built_in">CGRect</span>)frame</div><div class="line">{</div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) {</div><div class="line"><span class="comment">//scrollView</span></div><div class="line"><span class="built_in">UIScrollView</span> *scrollV = [[<span class="built_in">UIScrollView</span> alloc]init];</div><div class="line"><span class="comment">//&#x8FD9;&#x91CC;&#x4E00;&#x5B9A;&#x5F97;&#x8BBE;&#x7F6E;&#x554A;&#xFF0C;&#x4E0D;&#x7136;&#x7528;&#x6765;&#x8BA1;&#x7B97;&#x7684;scrollview&#x7684;subviews&#x8FD9;&#x4E2A;&#x6570;&#x503C;&#x4E0D;&#x5BF9;&#x4E86;</span></div><div class="line">scrollV.showsHorizontalScrollIndicator = <span class="literal">NO</span>;</div><div class="line">scrollV.showsVerticalScrollIndicator = <span class="literal">NO</span>;</div><div class="line">scrollV.delegate = <span class="keyword">self</span>;</div><div class="line">scrollV.pagingEnabled = <span class="literal">YES</span>;</div><div class="line"><span class="keyword">self</span>.scrollView = scrollV;</div><div class="line">[<span class="keyword">self</span> addSubview:scrollV];</div><div class="line"><span class="comment">//&#x6DFB;&#x52A0;&#x4E09;&#x5F20;imageView</span></div><div class="line"><span class="keyword">for</span> (<span class="built_in">NSUInteger</span> i = <span class="number">0</span>; i &lt; imageViewCount; i++) {</div><div class="line"><span class="built_in">UIImageView</span> *imageV = [[<span class="built_in">UIImageView</span> alloc]init];</div><div class="line">[<span class="keyword">self</span>.scrollView addSubview:imageV];</div><div class="line">}</div><div class="line"><span class="comment">//pagecontrol</span></div><div class="line"><span class="built_in">UIPageControl</span> *pageC = [[<span class="built_in">UIPageControl</span> alloc]init];</div><div class="line"><span class="keyword">self</span>.pageControl = pageC;</div><div class="line">[<span class="keyword">self</span> addSubview:pageC];</div><div class="line"></div><div class="line"></div><div class="line">}</div><div class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">}</div><div class="line">-(<span class="keyword">void</span>)layoutSubviews</div><div class="line">{</div><div class="line">[<span class="keyword">super</span> layoutSubviews];</div><div class="line"></div><div class="line"><span class="built_in">CGFloat</span> w = <span class="keyword">self</span>.frame.size.width;</div><div class="line"><span class="built_in">CGFloat</span> h = <span class="keyword">self</span>.frame.size.height;</div><div class="line"><span class="keyword">self</span>.scrollView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, w, h);</div><div class="line"><span class="keyword">self</span>.pageControl.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, h - <span class="number">37</span>, w, <span class="number">37</span>);</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> (_isPortrait) {</div><div class="line">[<span class="keyword">self</span>.scrollView.subviews enumerateObjectsUsingBlock:^(<span class="keyword">id</span> obj, <span class="built_in">NSUInteger</span> idx, <span class="built_in">BOOL</span> *stop) {</div><div class="line"><span class="built_in">UIImageView</span> *img = (<span class="built_in">UIImageView</span> *)obj;</div><div class="line">img.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, idx * h, w, h);</div><div class="line">}];</div><div class="line"><span class="keyword">self</span>.scrollView.contentSize = <span class="built_in">CGSizeMake</span>(<span class="number">0</span>, imageViewCount * <span class="keyword">self</span>.scrollView.frame.size.height);</div><div class="line">}<span class="keyword">else</span></div><div class="line">{</div><div class="line">[<span class="keyword">self</span>.scrollView.subviews enumerateObjectsUsingBlock:^(<span class="keyword">id</span> obj, <span class="built_in">NSUInteger</span> idx, <span class="built_in">BOOL</span> *stop) {</div><div class="line"><span class="built_in">UIImageView</span> *img = (<span class="built_in">UIImageView</span> *)obj;</div><div class="line">img.frame = <span class="built_in">CGRectMake</span>(idx * w, <span class="number">0</span>, w, h);</div><div class="line">}];</div><div class="line"><span class="keyword">self</span>.scrollView.contentSize = <span class="built_in">CGSizeMake</span>(imageViewCount * <span class="keyword">self</span>.frame.size.width, <span class="number">0</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">self</span>.pageControl.numberOfPages = <span class="keyword">self</span>.imageNames.count;</div><div class="line"><span class="keyword">self</span>.pageControl.currentPage = <span class="number">0</span>;</div><div class="line"></div><div class="line">[<span class="keyword">self</span> updateImage];</div><div class="line"></div><div class="line"><span class="comment">//    [self performSelectorInBackground:@selector(startTimer) withObject:nil];</span></div><div class="line"></div><div class="line">}</div><div class="line"><span class="comment">//&#x5728;layoutSubviews&#x4E2D;&#x505A;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x8981;&#x5C0F;&#x5FC3;&#xFF0C;&#x5B83;&#x4F1A;&#x8D70;&#x81F3;&#x5C11;&#x4E24;&#x6B21;&#xFF0C;&#x4E4B;&#x524D;&#x65E0;&#x5F62;&#x4E2D;&#x8D70;&#x4E86;&#x4E24;&#x6B21;startTimer&#x65B9;&#x6CD5;&#xFF0C;&#x7136;&#x540E;&#x521B;&#x5EFA;&#x4E86;&#x4E24;&#x4E2A;timer&#xFF0C;&#x867D;&#x7136;&#x540E;&#x9762;&#x6211;&#x6253;self.timer&#x662F;null&#xFF0C;&#x4F46;&#x662F;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;timer&#xFF0C;&#x867D;&#x7136;&#x8868;&#x9762;&#x4E0A;&#x6CA1;&#x6709;&#x5F3A;&#x5236;&#x6307;&#x9488;&#x5F15;&#x7528;&#x5B83;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5B83;&#x5728;&#x521B;&#x5EFA;&#x51FA;&#x6765;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x6709;&#x5F3A;&#x6307;&#x9488;&#x5F15;&#x7528;&#x5B83;&#x4E86;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x6CA1;&#x6CD5;&#x83B7;&#x53D6;&#x53E6;&#x4E00;&#x4E2A;timer&#x5E76;&#x4E14;invalidate&#x6389;&#xFF0C;&#x5C3C;&#x739B;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x9732;&#x554A;&#xFF0C;&#x800C;&#x4E14;&#x4ED6;&#x5976;&#x5976;&#x7684;&#x8FD8;&#x4E00;&#x76F4;&#x64CD;&#x63A7;&#x6211;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x597D;&#x5751;&#x7239;&#xFF01;&#xFF01;&#xFF01;</span></div><div class="line"><span class="meta">#pragma mark -</span></div><div class="line"><span class="meta">#pragma mark <span class="meta-string">&lt;UIScrollViewDelegate&gt;</span></span></div><div class="line">-(<span class="keyword">void</span>)scrollViewWillBeginDragging:(<span class="built_in">UIScrollView</span> *)scrollView</div><div class="line">{</div><div class="line">[<span class="keyword">self</span> stopTimer];</div><div class="line">}</div><div class="line">-(<span class="keyword">void</span>)scrollViewDidEndDragging:(<span class="built_in">UIScrollView</span> *)scrollView willDecelerate:(<span class="built_in">BOOL</span>)decelerate</div><div class="line">{</div><div class="line">[<span class="keyword">self</span> startTimer];</div><div class="line">}</div><div class="line">-(<span class="keyword">void</span>)scrollViewDidEndDecelerating:(<span class="built_in">UIScrollView</span> *)scrollView</div><div class="line">{</div><div class="line">[<span class="keyword">self</span> updateImage];</div><div class="line">}</div><div class="line">-(<span class="keyword">void</span>)scrollViewDidEndScrollingAnimation:(<span class="built_in">UIScrollView</span> *)scrollView</div><div class="line">{</div><div class="line">[<span class="keyword">self</span> updateImage];</div><div class="line">}</div><div class="line">-(<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView</div><div class="line">{</div><div class="line"></div><div class="line"><span class="built_in">NSInteger</span> page = <span class="number">0</span>;</div><div class="line"><span class="built_in">CGFloat</span> minDistance = MAXFLOAT;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;<span class="keyword">self</span>.scrollView.subviews.count; i++) {</div><div class="line"><span class="built_in">UIImageView</span> *imageView = <span class="keyword">self</span>.scrollView.subviews[i];</div><div class="line"><span class="built_in">CGFloat</span> distance = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (_isPortrait) {</div><div class="line">distance = ABS(imageView.frame.origin.y - scrollView.contentOffset.y);</div><div class="line">}<span class="keyword">else</span></div><div class="line">{</div><div class="line">distance = ABS(imageView.frame.origin.x - scrollView.contentOffset.x);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> (distance &lt; minDistance) {</div><div class="line">minDistance = distance;</div><div class="line">page = imageView.tag;</div><div class="line">}</div><div class="line">}</div><div class="line"><span class="keyword">self</span>.pageControl.currentPage = page;</div><div class="line">}</div><div class="line"><span class="meta">#pragma mark -</span></div><div class="line"><span class="meta">#pragma mark private methods</span></div><div class="line">- (<span class="keyword">void</span>)updateImage</div><div class="line">{</div><div class="line"><span class="keyword">for</span> (<span class="built_in">NSUInteger</span> i = <span class="number">0</span>; i &lt; <span class="keyword">self</span>.scrollView.subviews.count; i++) {</div><div class="line"><span class="built_in">UIImageView</span> *imagV = <span class="keyword">self</span>.scrollView.subviews[i];</div><div class="line"><span class="built_in">NSInteger</span> index = <span class="keyword">self</span>.pageControl.currentPage;</div><div class="line"><span class="keyword">if</span> (i == <span class="number">0</span>) {</div><div class="line">index--;</div><div class="line">}<span class="keyword">else</span> <span class="keyword">if</span>(i == <span class="number">2</span>)</div><div class="line">{</div><div class="line">index++;</div><div class="line">}</div><div class="line"><span class="keyword">if</span> (index &lt; <span class="number">0</span>) {</div><div class="line">index = <span class="keyword">self</span>.pageControl.numberOfPages - <span class="number">1</span>;</div><div class="line">}<span class="keyword">else</span> <span class="keyword">if</span>(index &gt;= <span class="keyword">self</span>.pageControl.numberOfPages )</div><div class="line">{</div><div class="line">index = <span class="number">0</span>;</div><div class="line">}</div><div class="line">imagV.tag = index;</div><div class="line">imagV.image = [<span class="built_in">UIImage</span> imageNamed:<span class="keyword">self</span>.imageNames[index]];</div><div class="line"></div><div class="line"></div><div class="line">}</div><div class="line"><span class="keyword">if</span> (_isPortrait) {</div><div class="line"><span class="keyword">self</span>.scrollView.contentOffset = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="keyword">self</span>.scrollView.frame.size.height);</div><div class="line">}<span class="keyword">else</span></div><div class="line">{</div><div class="line"><span class="keyword">self</span>.scrollView.contentOffset = <span class="built_in">CGPointMake</span>(<span class="keyword">self</span>.scrollView.frame.size.width, <span class="number">0</span>);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line">}</div><div class="line">- (<span class="keyword">void</span>)next</div><div class="line">{</div><div class="line"><span class="keyword">if</span> (_isPortrait) {</div><div class="line">[<span class="keyword">self</span>.scrollView setContentOffset:<span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">2</span> * <span class="keyword">self</span>.scrollView.frame.size.height) animated:<span class="literal">YES</span>];</div><div class="line">}<span class="keyword">else</span></div><div class="line">{</div><div class="line">[<span class="keyword">self</span>.scrollView setContentOffset:<span class="built_in">CGPointMake</span>(<span class="number">2</span> * <span class="keyword">self</span>.scrollView.frame.size.width, <span class="number">0</span>) animated:<span class="literal">YES</span>];</div><div class="line">}</div><div class="line"></div><div class="line">}</div><div class="line">- (<span class="keyword">void</span>)startTimer</div><div class="line">{</div><div class="line"><span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">2.0</span>f target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(next) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</div><div class="line">[[<span class="built_in">NSRunLoop</span> mainRunLoop]addTimer:<span class="keyword">self</span>.timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</div><div class="line">}</div><div class="line">-(<span class="keyword">void</span>)stopTimer</div><div class="line">{</div><div class="line">[<span class="keyword">self</span>.timer invalidate];</div><div class="line"><span class="keyword">self</span>.timer = <span class="literal">nil</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="meta">#pragma mark -</span></div><div class="line"><span class="meta">#pragma mark setter and getter</span></div><div class="line"></div><div class="line">-(<span class="keyword">void</span>)setImageNames:(<span class="built_in">NSArray</span> *)imageNames</div><div class="line">{</div><div class="line">_imageNames = imageNames;</div><div class="line">[<span class="keyword">self</span> startTimer];</div><div class="line">}</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/12/消息转发/" itemprop="url">
                  消息转发
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-07-12T09:00:16+08:00" content="2016-07-12">
              2016-07-12
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/12/消息转发/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/12/消息转发/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>&#x6D88;&#x606F;&#x8F6C;&#x53D1;&#x7684;&#x4E00;&#x4E9B;&#x6E90;&#x7801;&#x5206;&#x6790;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//&#x6B63;&#x5E38;&#x8C03;&#x7528;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x90FD;&#x4F1A;&#x8F6C;&#x5316;&#x6210;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;</div><div class="line">id objc_msgSend(id self, SEL op, ...) {</div><div class="line">if (!self) return nil;</div><div class="line">//&#x83B7;&#x53D6;&#x65B9;&#x6CD5;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x901A;&#x8FC7;isa&#x6307;&#x9488;&#xFF0C;&#x53BB;&#x7C7B;&#x91CC;&#x7528;SEL&#x627E;&#x65B9;&#x6CD5;</div><div class="line">//&#x540C;&#x65F6;&#x8BB0;&#x4F4F;&#xFF0C;SEL&#x5176;&#x5B9E;&#x4E5F;&#x5C31;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x7F62;&#x4E86;</div><div class="line">IMP imp = class_getMethodImplementation(self-&gt;isa, SEL op);</div><div class="line">imp(self, op, ...); //&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x4F2A;&#x4EE3;&#x7801;...</div><div class="line">}</div></pre></td></tr></table></figure>
<ul>
<li>&#x63A5;&#x4E0B;&#x6765;&#x53BB;&#x5230;&#x65B9;&#x6CD5;&#x5BFB;&#x627E;&#x51FD;&#x6570;&#x91CC;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//&#x67E5;&#x627E;IMP</div><div class="line">IMP class_getMethodImplementation(Class cls, SEL sel) {</div><div class="line">if (!cls || !sel) return nil;</div><div class="line">//&#x771F;&#x6B63;&#x7684;&#x5BFB;&#x627E;&#x65B9;&#x6CD5;&#x5728;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x91CC;&#xFF0C;&#x8FD9;&#x91CC;&#x8D1F;&#x8D23;&#x9632;&#x6B62;&#x7C7B;&#x6216;&#x65B9;&#x6CD5;&#x4E3A;&#x7A7A;</div><div class="line">IMP imp = lookUpImpOrNil(cls, sel);</div><div class="line">//&#x5982;&#x82E5;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x8FDB;&#x5165;&#x4E86;&#x6211;&#x4EEC;&#x719F;&#x6089;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x8F6C;&#x53D1;&#x673A;&#x5236;</div><div class="line">if (!imp) return _objc_msgForward;</div><div class="line">//_objc_msgForward &#x7528;&#x4E8E;&#x6D88;&#x606F;&#x8F6C;&#x53D1;</div><div class="line">return imp;</div><div class="line">}</div></pre></td></tr></table></figure>
<ul>
<li>&#x67E5;&#x627E;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x7684;&#x4EE3;&#x7801;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">IMP lookUpImpOrNil(Class cls, SEL sel) {</div><div class="line">//&#x5982;&#x679C;&#x7C7B;&#x6CA1;&#x6709;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x90A3;&#x4E48;&#x521D;&#x59CB;&#x5316;&#x5B83;&#xFF0C;&#x719F;&#x6089;&#x7684;&#x61D2;&#x52A0;&#x8F7D;&#x5440;</div><div class="line">if (!cls-&gt;initialize()) {</div><div class="line">_class_initialize(cls);</div><div class="line">}</div><div class="line"></div><div class="line">Class curClass = cls;</div><div class="line">IMP imp = nil;</div><div class="line"></div><div class="line">do { //&#x5148;&#x67E5;&#x7F13;&#x5B58;,&#x7F13;&#x5B58;&#x6CA1;&#x6709;&#x65F6;&#x91CD;&#x5EFA;,&#x4ECD;&#x65E7;&#x6CA1;&#x6709;&#x5219;&#x5411;&#x7236;&#x7C7B;&#x67E5;&#x8BE2;</div><div class="line">if (!curClass) break;//&#x5982;&#x679C;&#x7C7B;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x8DF3;&#x51FA;</div><div class="line">if (!curClass-&gt;cache) fill_cache(cls, curClass);//&#x521B;&#x5EFA;&#x7F13;&#x5B58;&#xFF0C;&#x4E5F;&#x662F;&#x61D2;&#x52A0;&#x8F7D;</div><div class="line">//&#x5728;&#x7F13;&#x5B58;&#x4E2D;&#x67E5;&#x627E;&#x65B9;&#x6CD5;</div><div class="line">imp = cache_getImp(curClass, sel);</div><div class="line">//&#x627E;&#x5230;&#x8DF3;&#x51FA;</div><div class="line">if (imp) break;</div><div class="line">} while (curClass = curClass-&gt;superclass);//&#x4E00;&#x76F4;&#x5411;&#x7236;&#x7C7B;&#x627E;&#xFF0C;&#x6700;&#x7EC8;&#x4E3A;&#x7A7A;&#x65F6;&#x8DF3;&#x51FA;&#xFF0C;NSObeject&#x7C7B;&#x7684;&#x7236;&#x7C7B;&#x5C31;&#x4E3A;&#x7A7A;&#xFF0C;&#x5143;&#x7C7B;&#x4E0D;&#x4E3A;&#x7A7A;</div><div class="line"></div><div class="line">return imp;</div><div class="line">}</div></pre></td></tr></table></figure>
<ul>
<li>Apple&#x6CA1;&#x6709;&#x516C;&#x5F00;_objc_msgForward&#x7684;&#x5B9E;&#x73B0;&#x6E90;&#x7801;&#xFF0C;_objc_msgForward&#x662F;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x6307;&#x9488;&#xFF08;&#x548C; IMP &#x7684;&#x7C7B;&#x578B;&#x4E00;&#x6837;&#xFF09;&#xFF0C;&#x662F;&#x7528;&#x4E8E;&#x6D88;&#x606F;&#x8F6C;&#x53D1;&#x7684;&#xFF1A;&#x5F53;&#x5411;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x53D1;&#x9001;&#x4E00;&#x6761;&#x6D88;&#x606F;&#xFF0C;&#x4F46;&#x5B83;&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;&#x7684;&#x65F6;&#x5019;&#xFF0C;_objc_msgForward&#x4F1A;&#x5C1D;&#x8BD5;&#x505A;&#x6D88;&#x606F;&#x8F6C;&#x53D1;&#x3002;</li>
<li>_objc_msgForward&#x6D88;&#x606F;&#x8F6C;&#x53D1;&#x505A;&#x7684;&#x51E0;&#x4EF6;&#x4E8B;&#xFF1A;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">1.&#x8C03;&#x7528;resolveInstanceMethod:&#x65B9;&#x6CD5; (&#x6216; resolveClassMethod:)&#x3002;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x5728;&#x6B64;&#x65F6;&#x4E3A;&#x8BE5; Class &#x52A8;&#x6001;&#x6DFB;&#x52A0;&#x5B9E;&#x73B0;&#x3002;&#x5982;&#x679C;&#x6709;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x5219;&#x8C03;&#x7528;&#x5E76;&#x8FD4;&#x56DE;YES&#xFF0C;&#x90A3;&#x4E48;&#x91CD;&#x65B0;&#x5F00;&#x59CB;objc_msgSend&#x6D41;&#x7A0B;&#x3002;&#x8FD9;&#x4E00;&#x6B21;&#x5BF9;&#x8C61;&#x4F1A;&#x54CD;&#x5E94;&#x8FD9;&#x4E2A;&#x9009;&#x62E9;&#x5668;&#xFF0C;&#x4E00;&#x822C;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x5DF2;&#x7ECF;&#x8C03;&#x7528;&#x8FC7;class_addMethod&#x3002;&#x5982;&#x679C;&#x4ECD;&#x6CA1;&#x5B9E;&#x73B0;&#xFF0C;&#x7EE7;&#x7EED;&#x4E0B;&#x9762;&#x7684;&#x52A8;&#x4F5C;&#x3002;</div><div class="line">2.&#x8C03;&#x7528;forwardingTargetForSelector:&#x65B9;&#x6CD5;&#xFF0C;&#x5C1D;&#x8BD5;&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x80FD;&#x54CD;&#x5E94;&#x8BE5;&#x6D88;&#x606F;&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x5982;&#x679C;&#x83B7;&#x53D6;&#x5230;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x628A;&#x6D88;&#x606F;&#x8F6C;&#x53D1;&#x7ED9;&#x5B83;&#xFF0C;&#x8FD4;&#x56DE;&#x975E; nil &#x5BF9;&#x8C61;&#x3002;&#x5426;&#x5219;&#x8FD4;&#x56DE; nil &#xFF0C;&#x7EE7;&#x7EED;&#x4E0B;&#x9762;&#x7684;&#x52A8;&#x4F5C;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x8981;&#x8FD4;&#x56DE; self &#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x5F62;&#x6210;&#x6B7B;&#x5FAA;&#x73AF;&#x3002;</div><div class="line">3.&#x8C03;&#x7528;methodSignatureForSelector:&#x65B9;&#x6CD5;&#xFF0C;&#x5C1D;&#x8BD5;&#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x7B7E;&#x540D;&#x3002;&#x5982;&#x679C;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x8C03;&#x7528;doesNotRecognizeSelector&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;&#x5982;&#x679C;&#x80FD;&#x83B7;&#x53D6;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;&#x975E;nil&#xFF1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; NSlnvocation &#x5E76;&#x4F20;&#x7ED9;forwardInvocation:&#x3002;</div><div class="line">4.&#x8C03;&#x7528;forwardInvocation:&#x65B9;&#x6CD5;&#xFF0C;&#x5C06;&#x7B2C;3&#x6B65;&#x83B7;&#x53D6;&#x5230;&#x7684;&#x65B9;&#x6CD5;&#x7B7E;&#x540D;&#x5305;&#x88C5;&#x6210; Invocation &#x4F20;&#x5165;&#xFF0C;&#x5982;&#x4F55;&#x5904;&#x7406;&#x5C31;&#x5728;&#x8FD9;&#x91CC;&#x9762;&#x4E86;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x975E;ni&#x3002;</div><div class="line">5.&#x8C03;&#x7528;doesNotRecognizeSelector: &#xFF0C;&#x9ED8;&#x8BA4;&#x7684;&#x5B9E;&#x73B0;&#x662F;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;&#x5982;&#x679C;&#x7B2C;3&#x6B65;&#x6CA1;&#x80FD;&#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x7B7E;&#x540D;&#xFF0C;&#x6267;&#x884C;&#x8BE5;&#x6B65;&#x9AA4;&#x3002;</div></pre></td></tr></table></figure>
<ul>
<li>&#x4E0A;&#x9762;&#x524D;4&#x4E2A;&#x65B9;&#x6CD5;&#x5747;&#x662F;&#x6A21;&#x677F;&#x65B9;&#x6CD5;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;override&#xFF0C;&#x7531; runtime &#x6765;&#x8C03;&#x7528;&#x3002;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x5B9E;&#x73B0;&#x6D88;&#x606F;&#x8F6C;&#x53D1;&#xFF1A;&#x5C31;&#x662F;&#x91CD;&#x5199;&#x65B9;&#x6CD5;3&#x548C;4&#xFF0C;&#x541E;&#x6389;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x6216;&#x8005;&#x4EE3;&#x7406;&#x7ED9;&#x5176;&#x4ED6;&#x5BF9;&#x8C61;&#x90FD;&#x662F;&#x6CA1;&#x95EE;&#x9898;&#x7684;</li>
<li>&#x76F4;&#x63A5;&#x8C03;&#x7528;_objc_msgForward&#x662F;&#x975E;&#x5E38;&#x5371;&#x9669;&#x7684;&#x4E8B;&#xFF0C;&#x5982;&#x679C;&#x7528;&#x4E0D;&#x597D;&#x4F1A;&#x76F4;&#x63A5;&#x5BFC;&#x81F4;&#x7A0B;&#x5E8F;Crash&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x7528;&#x5F97;&#x597D;&#xFF0C;&#x80FD;&#x505A;&#x5F88;&#x591A;&#x975E;&#x5E38;&#x9177;&#x7684;&#x4E8B;&#x3002;</li>
<li>_objc_msgForward&#x96B6;&#x5C5E; C &#x8BED;&#x8A00;&#xFF0C;&#x6709;&#x4E09;&#x4E2A;&#x53C2;&#x6570; &#xFF1A;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1.&#x6240;&#x5C5E;&#x5BF9;&#x8C61; -&gt;id&#x7C7B;&#x578B;</div><div class="line">2.&#x65B9;&#x6CD5;&#x540D; -&gt;SEL&#x7C7B;&#x578B;</div><div class="line">3.&#x53EF;&#x53D8;&#x53C2;&#x6570; -&gt;&#x53EF;&#x53D8;&#x53C2;&#x6570;&#x7C7B;&#x578B;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#x90A3;&#x4E48; objc_msgSend &#x5230;&#x5E95;&#x662F;&#x600E;&#x4E48;&#x5DE5;&#x4F5C;&#x7684;&#x5462;</div><div class="line"></div><div class="line">&#x5728;Objective-C&#x4E2D;&#xFF0C;&#x6D88;&#x606F;&#x76F4;&#x5230;&#x8FD0;&#x884C;&#x65F6;&#x624D;&#x4F1A;&#x7ED1;&#x5B9A;&#x5230;&#x65B9;&#x6CD5;&#x7684;&#x5B9E;&#x73B0;&#x4E0A;&#x3002;&#x7F16;&#x8BD1;&#x5668;&#x4F1A;&#x628A;&#x4EE3;&#x7801;&#x4E2D;[target doSth]&#x8F6C;&#x6362;&#x6210; objc_msgSend&#x6D88;&#x606F;&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5B8C;&#x6210;&#x4E86;&#x52A8;&#x6001;&#x7ED1;&#x5B9A;&#x7684;&#x6240;&#x6709;&#x4E8B;&#x60C5;&#x3002;&#x5B83;&#x7684;&#x8FD0;&#x884C;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;:</div><div class="line"></div><div class="line">&#x68C0;&#x67E5;selector&#x662F;&#x5426;&#x9700;&#x8981;&#x5FFD;&#x7565;&#x3002;(ps: Mac&#x5F00;&#x53D1;&#x4E2D;&#x5F00;&#x542F;GC&#x5C31;&#x4F1A;&#x5FFD;&#x7565;retain,release&#x65B9;&#x6CD5;&#x3002;)</div><div class="line">&#x68C0;&#x67E5;target&#x662F;&#x5426;&#x4E3A;nil&#x3002;&#x5982;&#x679C;&#x4E3A;nil&#xFF0C;&#x76F4;&#x63A5;cleanup&#xFF0C;&#x7136;&#x540E;return&#x3002;(&#x8FD9;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5411;nil&#x53D1;&#x9001;&#x6D88;&#x606F;&#x7684;&#x539F;&#x56E0;&#x3002;)</div><div class="line">&#x7136;&#x540E;&#x5728;target&#x7684;Class&#x4E2D;&#x6839;&#x636E;Selector&#x53BB;&#x627E;IMP</div><div class="line"></div><div class="line">&#x5BFB;&#x627E;IMP&#x7684;&#x8FC7;&#x7A0B;:</div><div class="line"></div><div class="line">&#x5148;&#x4ECE;&#x5F53;&#x524D;class&#x7684;cache&#x65B9;&#x6CD5;&#x5217;&#x8868;&#xFF08;cache methodLists&#xFF09;&#x91CC;&#x53BB;&#x627E;</div><div class="line">&#x627E;&#x5230;&#x4E86;&#xFF0C;&#x8DF3;&#x5230;&#x5BF9;&#x5E94;&#x51FD;&#x6570;&#x5B9E;&#x73B0;</div><div class="line">&#x6CA1;&#x627E;&#x5230;&#xFF0C;&#x5C31;&#x4ECE;class&#x7684;&#x65B9;&#x6CD5;&#x5217;&#x8868;&#xFF08;methodLists&#xFF09;&#x91CC;&#x627E;</div><div class="line">&#x8FD8;&#x627E;&#x4E0D;&#x5230;&#xFF0C;&#x5C31;&#x5230;super class&#x7684;&#x65B9;&#x6CD5;&#x5217;&#x8868;&#x91CC;&#x627E;&#xFF0C;&#x76F4;&#x5230;&#x627E;&#x5230;&#x57FA;&#x7C7B;(NSObject)&#x4E3A;&#x6B62;</div><div class="line">&#x6700;&#x540E;&#x518D;&#x627E;&#x4E0D;&#x5230;&#xFF0C;&#x5C31;&#x4F1A;&#x8FDB;&#x5165;&#x52A8;&#x6001;&#x65B9;&#x6CD5;&#x89E3;&#x6790;&#x548C;&#x6D88;&#x606F;&#x8F6C;&#x53D1;&#x7684;&#x673A;&#x5236;&#x3002;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/12/runloop/" itemprop="url">
                  runloop
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-07-12T08:57:05+08:00" content="2016-07-12">
              2016-07-12
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/12/runloop/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/12/runloop/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>Run Loop &#x89C2;&#x5BDF;&#x8005;</li>
<li>Run loop &#x5165;&#x53E3;</li>
<li>Run loop &#x4F55;&#x65F6;&#x5904;&#x7406;&#x4E00;&#x4E2A;&#x5B9A;&#x65F6;&#x5668;</li>
<li>Run loop &#x4F55;&#x65F6;&#x5904;&#x7406;&#x4E00;&#x4E2A;&#x8F93;&#x5165;&#x6E90;</li>
<li>Run loop &#x4F55;&#x65F6;&#x8FDB;&#x5165;&#x7761;&#x7720;&#x72B6;&#x6001;</li>
<li>Run loop &#x4F55;&#x65F6;&#x88AB;&#x5524;&#x9192;,&#x4F46;&#x5728;&#x5524;&#x9192;&#x4E4B;&#x524D;&#x8981;&#x5904;&#x7406;&#x7684;&#x4E8B;&#x4EF6;</li>
<li>Run loop &#x7EC8;&#x6B62;</li>
<li>&#x624B;&#x52A8;&#x6DFB;&#x52A0;&#x89C2;&#x5BDF;&#x8005;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// &#x521B;&#x5EFA;Observer</span></div><div class="line"><span class="comment">/*</span></div><div class="line">&#x7B2C;1&#x4E2A;&#x53C2;&#x6570;: &#x6307;&#x5B9A;&#x5982;&#x4F55;&#x7ED9;observer&#x5206;&#x914D;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;</div><div class="line">&#x7B2C;2&#x4E2A;&#x53C2;&#x6570;: &#x9700;&#x8981;&#x76D1;&#x542C;&#x7684;&#x72B6;&#x6001;&#x7C7B;&#x578B;/ kCFRunLoopAllActivities&#x76D1;&#x542C;&#x6240;&#x6709;&#x72B6;&#x6001;</div><div class="line">&#x7B2C;3&#x4E2A;&#x53C2;&#x6570;: &#x662F;&#x5426;&#x6BCF;&#x6B21;&#x90FD;&#x9700;&#x8981;&#x76D1;&#x542C;</div><div class="line">&#x7B2C;4&#x4E2A;&#x53C2;&#x6570;: &#x4F18;&#x5148;&#x7EA7;</div><div class="line">&#x7B2C;5&#x4E2A;&#x53C2;&#x6570;: &#x76D1;&#x542C;&#x5230;&#x72B6;&#x6001;&#x6539;&#x53D8;&#x4E4B;&#x540E;&#x7684;&#x56DE;&#x8C03;</div><div class="line">*/</div><div class="line"><span class="built_in">CFRunLoopObserverRef</span>  observer = <span class="built_in">CFRunLoopObserverCreateWithHandler</span>(<span class="built_in">CFAllocatorGetDefault</span>(), kCFRunLoopAllActivities, <span class="literal">YES</span>, <span class="number">0</span>, ^(<span class="built_in">CFRunLoopObserverRef</span> observer, <span class="built_in">CFRunLoopActivity</span> activity) {</div><div class="line"><span class="keyword">switch</span> (activity) {</div><div class="line"><span class="keyword">case</span> kCFRunLoopEntry:</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;&#x5373;&#x5C06;&#x8FDB;&#x5165;runloop&quot;</span>);</div><div class="line"><span class="keyword">break</span>;</div><div class="line"><span class="keyword">case</span> kCFRunLoopBeforeTimers:</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;&#x5373;&#x5C06;&#x5904;&#x7406;timer&quot;</span>);</div><div class="line"><span class="keyword">break</span>;</div><div class="line"><span class="keyword">case</span> kCFRunLoopBeforeSources:</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;&#x5373;&#x5C06;&#x5904;&#x7406;source&quot;</span>);</div><div class="line"><span class="keyword">break</span>;</div><div class="line"><span class="keyword">case</span> kCFRunLoopBeforeWaiting:</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;&#x5373;&#x5C06;&#x8FDB;&#x5165;&#x7761;&#x7720;&quot;</span>);</div><div class="line"><span class="keyword">break</span>;</div><div class="line"><span class="keyword">case</span> kCFRunLoopAfterWaiting:</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;&#x521A;&#x4ECE;&#x7761;&#x7720;&#x4E2D;&#x5524;&#x9192;&quot;</span>);</div><div class="line"><span class="keyword">break</span>;</div><div class="line"><span class="keyword">case</span> kCFRunLoopExit:</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;&#x5373;&#x5C06;&#x9000;&#x51FA;&quot;</span>);</div><div class="line"><span class="keyword">break</span>;</div><div class="line"><span class="keyword">default</span>:</div><div class="line"><span class="keyword">break</span>;</div><div class="line">}</div><div class="line">});</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// &#x7ED9;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;RunLoop&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x89C2;&#x5BDF;&#x8005;</span></div><div class="line"><span class="comment">/*</span></div><div class="line">&#x7B2C;1&#x4E2A;&#x53C2;&#x6570;: &#x9700;&#x8981;&#x7ED9;&#x54EA;&#x4E2A;RunLoop&#x6DFB;&#x52A0;&#x89C2;&#x5BDF;&#x8005;</div><div class="line">&#x7B2C;2&#x4E2A;&#x53C2;&#x6570;: &#x9700;&#x8981;&#x6DFB;&#x52A0;&#x7684;Observer&#x5BF9;&#x8C61;</div><div class="line">&#x7B2C;3&#x4E2A;&#x53C2;&#x6570;: &#x5728;&#x54EA;&#x79CD;&#x6A21;&#x5F0F;&#x4E0B;&#x53EF;&#x4EE5;&#x53EF;&#x4EE5;&#x76D1;&#x542C;</div><div class="line">*/</div><div class="line"><span class="built_in">CFRunLoopAddObserver</span>(<span class="built_in">CFRunLoopGetMain</span>(), observer, kCFRunLoopDefaultMode);</div><div class="line"></div><div class="line"><span class="comment">// &#x91CA;&#x653E;&#x5BF9;&#x8C61;</span></div><div class="line"><span class="built_in">CFRelease</span>(observer);</div></pre></td></tr></table></figure>
<ul>
<li>&#x6BCF;&#x6B21;&#x8FD0;&#x884C; run loop,&#x4F60;&#x7EBF;&#x7A0B;&#x7684;runloop&#x5BF9;&#x4F1A;&#x81EA;&#x52A8;&#x5904;&#x7406;&#x4E4B;&#x524D;&#x672A;&#x5904;&#x7406;&#x7684;&#x6D88;&#x606F;,&#x5E76;&#x901A; &#x77E5;&#x76F8;&#x5173;&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x3002;&#x5177;&#x4F53;&#x7684;&#x987A;&#x5E8F;&#x5982;&#x4E0B;:</li>
<li>1.&#x901A;&#x77E5;&#x89C2;&#x5BDF;&#x8005; run loop &#x5DF2;&#x7ECF;&#x542F;&#x52A8;</li>
<li>2.&#x901A;&#x77E5;&#x89C2;&#x5BDF;&#x8005;&#x4EFB;&#x4F55;&#x5373;&#x5C06;&#x8981;&#x5F00;&#x59CB;&#x7684;&#x5B9A;&#x65F6;&#x5668;</li>
<li>3.&#x901A;&#x77E5;&#x89C2;&#x5BDF;&#x8005;&#x4EFB;&#x4F55;&#x5373;&#x5C06;&#x542F;&#x52A8;&#x7684;&#x975E;&#x57FA;&#x4E8E;&#x7AEF;&#x53E3;&#x7684;&#x6E90;</li>
<li>4.&#x542F;&#x52A8;&#x4EFB;&#x4F55;&#x51C6;&#x5907;&#x597D;&#x7684;&#x975E;&#x57FA;&#x4E8E;&#x7AEF;&#x53E3;&#x7684;&#x6E90;</li>
<li>5.&#x5982;&#x679C;&#x57FA;&#x4E8E;&#x7AEF;&#x53E3;&#x7684;&#x6E90;&#x51C6;&#x5907;&#x597D;&#x5E76;&#x5904;&#x4E8E;&#x7B49;&#x5F85;&#x72B6;&#x6001;,&#x7ACB;&#x5373;&#x542F;&#x52A8;;&#x5E76;&#x8FDB;&#x5165;&#x6B65;&#x9AA4; 9&#x3002;</li>
<li>6.&#x901A;&#x77E5;&#x89C2;&#x5BDF;&#x8005;&#x7EBF;&#x7A0B;&#x8FDB;&#x5165;&#x4F11;&#x7720;</li>
<li>8.&#x5C06;&#x7EBF;&#x7A0B;&#x7F6E;&#x4E8E;&#x4F11;&#x7720;&#x76F4;&#x5230;&#x4EFB;&#x4E00;&#x4E0B;&#x9762;&#x7684;&#x4E8B;&#x4EF6;&#x53D1;&#x751F;:</li>
</ul>
<ul>
<li>&#x67D0;&#x4E00;&#x4E8B;&#x4EF6;&#x5230;&#x8FBE;&#x57FA;&#x4E8E;&#x7AEF;&#x53E3;&#x7684;&#x6E90;</li>
<li>&#x5B9A;&#x65F6;&#x5668;&#x542F;&#x52A8;</li>
<li>Run loop &#x8BBE;&#x7F6E;&#x7684;&#x65F6;&#x95F4;&#x5DF2;&#x7ECF;&#x8D85;&#x65F6;</li>
<li>run loop &#x88AB;&#x663E;&#x5F0F;&#x5524;&#x9192;</li>
</ul>
<ul>
<li>9.&#x5904;&#x7406;&#x672A;&#x5904;&#x7406;&#x7684;&#x4E8B;&#x4EF6;</li>
</ul>
<ul>
<li>&#x5982;&#x679C;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x5B9A;&#x65F6;&#x5668;&#x542F;&#x52A8;,&#x5904;&#x7406;&#x5B9A;&#x65F6;&#x5668;&#x4E8B;&#x4EF6;&#x5E76;&#x91CD;&#x542F; run loop&#x3002;&#x8FDB;&#x5165;&#x6B65;&#x9AA4; 2</li>
<li>&#x5982;&#x679C;&#x8F93;&#x5165;&#x6E90;&#x542F;&#x52A8;,&#x4F20;&#x9012;&#x76F8;&#x5E94;&#x7684;&#x6D88;&#x606F;</li>
<li>&#x5982;&#x679C; run loop &#x88AB;&#x663E;&#x5F0F;&#x5524;&#x9192;&#x800C;&#x4E14;&#x65F6;&#x95F4;&#x8FD8;&#x6CA1;&#x8D85;&#x65F6;,&#x91CD;&#x542F; run loop&#x3002;&#x8FDB;&#x5165;&#x6B65;&#x9AA4; 2</li>
</ul>
<ul>
<li>&#x542F;&#x52A8; run loop &#x53EA;&#x5BF9;&#x7A0B;&#x5E8F;&#x7684;&#x8F85;&#x52A9;&#x7EBF;&#x7A0B;&#x6709;&#x610F;&#x4E49;&#x3002;&#x4E00;&#x4E2A; run loop &#x901A;&#x5E38;&#x5FC5;&#x987B;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x8F93;&#x5165;&#x6E90;&#x6216;&#x5B9A;&#x65F6;&#x5668;&#x6765;&#x76D1;&#x542C;&#x4E8B;&#x4EF6;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x90FD;&#x6CA1;&#x6709;,run loop &#x542F;&#x52A8;&#x540E;&#x7ACB;&#x5373;&#x9000;&#x51FA;&#x3002;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/// 1. &#x901A;&#x77E5;Observers&#xFF0C;&#x5373;&#x5C06;&#x8FDB;&#x5165;RunLoop</span></div><div class="line"><span class="comment">/// &#x6B64;&#x5904;&#x6709;Observer&#x4F1A;&#x521B;&#x5EFA;AutoreleasePool: _objc_autoreleasePoolPush();</span></div><div class="line">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopEntry);</div><div class="line"><span class="keyword">do</span> {</div><div class="line"></div><div class="line"><span class="comment">/// 2. &#x901A;&#x77E5; Observers: &#x5373;&#x5C06;&#x89E6;&#x53D1; Timer &#x56DE;&#x8C03;&#x3002;</span></div><div class="line">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopBeforeTimers);</div><div class="line"><span class="comment">/// 3. &#x901A;&#x77E5; Observers: &#x5373;&#x5C06;&#x89E6;&#x53D1; Source (&#x975E;&#x57FA;&#x4E8E;port&#x7684;,Source0) &#x56DE;&#x8C03;&#x3002;</span></div><div class="line">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopBeforeSources);</div><div class="line">__CFRUNLOOP_IS_CALLING_OUT_TO_A_BLOCK__(block);</div><div class="line"></div><div class="line"><span class="comment">/// 4. &#x89E6;&#x53D1; Source0 (&#x975E;&#x57FA;&#x4E8E;port&#x7684;) &#x56DE;&#x8C03;&#x3002;</span></div><div class="line">__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__(source0);</div><div class="line">__CFRUNLOOP_IS_CALLING_OUT_TO_A_BLOCK__(block);</div><div class="line"></div><div class="line"><span class="comment">/// 6. &#x901A;&#x77E5;Observers&#xFF0C;&#x5373;&#x5C06;&#x8FDB;&#x5165;&#x4F11;&#x7720;</span></div><div class="line"><span class="comment">/// &#x6B64;&#x5904;&#x6709;Observer&#x91CA;&#x653E;&#x5E76;&#x65B0;&#x5EFA;AutoreleasePool: _objc_autoreleasePoolPop(); _objc_autoreleasePoolPush();</span></div><div class="line">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopBeforeWaiting);</div><div class="line"></div><div class="line"><span class="comment">/// 7. sleep to wait msg.</span></div><div class="line">mach_msg() -&gt; mach_msg_trap();</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/// 8. &#x901A;&#x77E5;Observers&#xFF0C;&#x7EBF;&#x7A0B;&#x88AB;&#x5524;&#x9192;</span></div><div class="line">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopAfterWaiting);</div><div class="line"></div><div class="line"><span class="comment">/// 9. &#x5982;&#x679C;&#x662F;&#x88AB;Timer&#x5524;&#x9192;&#x7684;&#xFF0C;&#x56DE;&#x8C03;Timer</span></div><div class="line">__CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__(timer);</div><div class="line"></div><div class="line"><span class="comment">/// 9. &#x5982;&#x679C;&#x662F;&#x88AB;dispatch&#x5524;&#x9192;&#x7684;&#xFF0C;&#x6267;&#x884C;&#x6240;&#x6709;&#x8C03;&#x7528; dispatch_async &#x7B49;&#x65B9;&#x6CD5;&#x653E;&#x5165;main queue &#x7684; block</span></div><div class="line">__CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__(dispatched_block);</div><div class="line"></div><div class="line"><span class="comment">/// 9. &#x5982;&#x679C;&#x5982;&#x679C;Runloop&#x662F;&#x88AB; Source1 (&#x57FA;&#x4E8E;port&#x7684;) &#x7684;&#x4E8B;&#x4EF6;&#x5524;&#x9192;&#x4E86;&#xFF0C;&#x5904;&#x7406;&#x8FD9;&#x4E2A;&#x4E8B;&#x4EF6;</span></div><div class="line">__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE1_PERFORM_FUNCTION__(source1);</div><div class="line"></div><div class="line"></div><div class="line">} <span class="keyword">while</span> (...);</div><div class="line"></div><div class="line"><span class="comment">/// 10. &#x901A;&#x77E5;Observers&#xFF0C;&#x5373;&#x5C06;&#x9000;&#x51FA;RunLoop</span></div><div class="line"><span class="comment">/// &#x6B64;&#x5904;&#x6709;Observer&#x91CA;&#x653E;AutoreleasePool: _objc_autoreleasePoolPop();</span></div><div class="line">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopExit);</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/10/rumTime基础使用/" itemprop="url">
                  rumTime基础使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-07-10T08:42:29+08:00" content="2016-07-10">
              2016-07-10
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/10/rumTime基础使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/10/rumTime基础使用/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027;&#xFF0C;&#x4E0D;&#x5305;&#x62EC;&#x5C5E;&#x6027;&#x503C;"><a href="#&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027;&#xFF0C;&#x4E0D;&#x5305;&#x62EC;&#x5C5E;&#x6027;&#x503C;" class="headerlink" title="&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027;&#xFF0C;&#x4E0D;&#x5305;&#x62EC;&#x5C5E;&#x6027;&#x503C;"></a>&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027;&#xFF0C;&#x4E0D;&#x5305;&#x62EC;&#x5C5E;&#x6027;&#x503C;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- (NSArray *)getAllProperties</div><div class="line">{</div><div class="line">u_int count;   </div><div class="line">objc_property_t *properties  =class_copyPropertyList([self class], &amp;count);  </div><div class="line">NSMutableArray *propertiesArray = [NSMutableArray arrayWithCapacity:count];   </div><div class="line">for (int i = 0; i&lt;count; i++)</div><div class="line">{</div><div class="line">const char* propertyName =property_getName(properties[i]);</div><div class="line">[propertiesArray addObject: [NSString stringWithUTF8String: propertyName]];   </div><div class="line">}   </div><div class="line">free(properties);   </div><div class="line">return propertiesArray;  </div><div class="line">}</div></pre></td></tr></table></figure>
<h2 id="&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027;-&#x4EE5;&#x53CA;&#x5C5E;&#x6027;&#x503C;"><a href="#&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027;-&#x4EE5;&#x53CA;&#x5C5E;&#x6027;&#x503C;" class="headerlink" title="&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027; &#x4EE5;&#x53CA;&#x5C5E;&#x6027;&#x503C;"></a>&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027; &#x4EE5;&#x53CA;&#x5C5E;&#x6027;&#x503C;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">- (NSDictionary *)properties_aps</div><div class="line">{</div><div class="line">NSMutableDictionary *props = [NSMutableDictionary dictionary];   </div><div class="line">unsigned int outCount, i;   </div><div class="line">objc_property_t *properties = class_copyPropertyList([self class], &amp;outCount);   </div><div class="line">for (i = 0; i&lt;outCount; i++)</div><div class="line">{</div><div class="line">objc_property_t property = properties[i];</div><div class="line">const char* char_f =property_getName(property);</div><div class="line">NSString *propertyName = [NSString stringWithUTF8String:char_f];</div><div class="line">id propertyValue = [self valueForKey:(NSString *)propertyName];   </div><div class="line">if (propertyValue) [props setObject:propertyValue forKey:propertyName];   </div><div class="line">}   </div><div class="line">free(properties);   </div><div class="line">return props;   </div><div class="line">}</div></pre></td></tr></table></figure>
<h2 id="&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7684;&#x6240;&#x6709;&#x65B9;&#x6CD5;"><a href="#&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7684;&#x6240;&#x6709;&#x65B9;&#x6CD5;" class="headerlink" title="&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7684;&#x6240;&#x6709;&#x65B9;&#x6CD5;"></a>&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7684;&#x6240;&#x6709;&#x65B9;&#x6CD5;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">-(void)printMothList</div><div class="line">{</div><div class="line">unsigned int mothCout_f =0;</div><div class="line">Method* mothList_f = class_copyMethodList([self class],&amp;mothCout_f);</div><div class="line">for(int i=0;i&lt;mothCout_f;i++)</div><div class="line">{</div><div class="line">Method temp_f = mothList_f[i];</div><div class="line">IMP imp_f = method_getImplementation(temp_f);</div><div class="line">SEL name_f = method_getName(temp_f);</div><div class="line">const char* name_s =sel_getName(method_getName(temp_f));</div><div class="line">int arguments = method_getNumberOfArguments(temp_f);</div><div class="line">const char* encoding =method_getTypeEncoding(temp_f);</div><div class="line">NSLog(@&quot;&#x65B9;&#x6CD5;&#x540D;&#xFF1A;%@,&#x53C2;&#x6570;&#x4E2A;&#x6570;&#xFF1A;%d,&#x7F16;&#x7801;&#x65B9;&#x5F0F;&#xFF1A;%@&quot;,[NSString stringWithUTF8String:name_s],</div><div class="line">arguments,[NSString stringWithUTF8String:encoding]);</div><div class="line">}</div><div class="line">free(mothList_f);</div><div class="line">}</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/10/多线程之NSOperation/" itemprop="url">
                  多线程之NSOperation
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-07-10T08:27:41+08:00" content="2016-07-10">
              2016-07-10
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/10/多线程之NSOperation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/10/多线程之NSOperation/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="warning-tip"><a href="#warning-tip" class="headerlink" title="warning tip"></a>warning tip</h1><ul>
<li>GCD&#x4E2D;&#x7684;global&#x5E76;&#x884C;&#x961F;&#x5217;&#x662F;&#x5355;&#x4F8B;&#xFF0C;&#x53EA;&#x662F;&#x5728;&#x6805;&#x680F;&#x961F;&#x5217;&#x91CC;&#x7531;&#x4E8E;&#x4E0D;&#x77E5;&#x540D;&#x539F;&#x56E0;&#xFF0C;&#x8868;&#x73B0;&#x5F97;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x961F;&#x5217;&#xFF0C;&#x4F46;&#x662F;&#x5B9E;&#x9645;&#x8FD8;&#x662F;&#x4E00;&#x4E2A;&#x5355;&#x4F8B;</li>
<li>&#x5F00;&#x53D1;&#x4E2D;&#x8981;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x961F;&#x5217;&#x7684;&#x8BDD;&#x4F7F;&#x7528;&#x6B63;&#x5E38;&#x7684;&#x5355;&#x4F8B;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;</li>
</ul>
<hr>
<ul>
<li>NSOperation&#x6709;&#x4E24;&#x4E2A;&#x5B50;&#x7C7B;&#xFF0C;<code>NSBlockOperation</code>&#x548C;<code>NSInvocationOperation</code>&#xFF0C;&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#x5B83;&#x4EEC;&#x662F;&#x8FD9;&#x6837;&#x4F7F;&#x7528;&#x7684;</li>
<li>NSBlockOperation</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//1. &#x5C01;&#x88C5;&#x4EFB;&#x52A1;</span></div><div class="line"><span class="built_in">NSBlockOperation</span> *op1 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^{</div><div class="line"><span class="comment">// &#x4E3B;&#x7EBF;&#x7A0B;</span></div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;1---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}];</div><div class="line"></div><div class="line"><span class="comment">// 2.&#x8FFD;&#x52A0;&#x5176;&#x5B83;&#x4EFB;&#x52A1;</span></div><div class="line"><span class="comment">// &#x6CE8;&#x610F;: &#x5728;&#x6CA1;&#x6709;&#x961F;&#x5217;&#x7684;&#x60C5;&#x51B5;&#x4E0B;, &#x5982;&#x679C;&#x7ED9;BlockOperation&#x8FFD;&#x52A0;&#x5176;&#x5B83;&#x4EFB;&#x52A1;, &#x90A3;&#x4E48;&#x5176;&#x5B83;&#x4EFB;&#x52A1;&#x4F1A;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;</span></div><div class="line">[op1 addExecutionBlock:^{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;2---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}];</div><div class="line">[op1 addExecutionBlock:^{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;3---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}];</div><div class="line"></div><div class="line"><span class="comment">// 3.&#x542F;&#x52A8;&#x4EFB;&#x52A1;</span></div><div class="line">[op1 start];</div></pre></td></tr></table></figure>
<ul>
<li>NSInvocationOperation</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// &#x6CE8;&#x610F;: &#x7236;&#x7C7B;&#x4E0D;&#x5177;&#x5907;&#x5C01;&#x88C5;&#x64CD;&#x4F5C;&#x7684;&#x80FD;&#x529B;</span></div><div class="line"><span class="comment">//    NSOperation *op = [[NSOperation alloc] init];</span></div><div class="line"></div><div class="line"><span class="comment">// 1.&#x5C01;&#x88C5;&#x4EFB;&#x52A1;</span></div><div class="line"><span class="built_in">NSInvocationOperation</span> *op1 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(run) object:<span class="literal">nil</span>];</div><div class="line"><span class="comment">// 2.&#x8981;&#x60F3;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x5FC5;&#x987B;&#x8C03;&#x7528;start</span></div><div class="line">[op1 start];</div><div class="line"></div><div class="line"><span class="built_in">NSInvocationOperation</span> *op2 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(run2) object:<span class="literal">nil</span>];</div><div class="line">[op2 start];</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)run</div><div class="line">{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}</div><div class="line">- (<span class="keyword">void</span>)run2</div><div class="line">{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}</div></pre></td></tr></table></figure>
<hr>
<ul>
<li>&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x5E76;&#x6CA1;&#x6709;&#x4E3B;&#x52A8;&#x63A7;&#x5236;&#x7EBF;&#x7A0B;&#xFF0C;NSInvocationOperation&#x7684;&#x6267;&#x884C;&#x7EBF;&#x7A0B;&#x90FD;&#x662F;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#xFF0C;NSBlockOperation&#x7B2C;&#x4E00;&#x4E2A;block&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#xFF0C;&#x8FFD;&#x52A0;&#x7684;&#x5219;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#xFF0C;&#x4E00;&#x822C;&#x5F00;&#x53D1;&#x4E2D;&#x6211;&#x4EEC;&#x4E0D;&#x4F1A;&#x8FD9;&#x6837;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#xFF0C;&#x9700;&#x8981;&#x914D;&#x5408;&#x961F;&#x5217;&#x4F7F;&#x7528;</li>
<li><p>&#x914D;&#x5408;&#x961F;&#x5217;&#x5F88;&#x7B80;&#x5355;</p>
</li>
<li><p>NSOperationQueue</p>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 1.&#x521B;&#x5EFA;&#x961F;&#x5217;</span></div><div class="line"><span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</div><div class="line"><span class="comment">// 2.&#x521B;&#x5EFA;&#x4EFB;&#x52A1;</span></div><div class="line"></div><div class="line"><span class="built_in">NSBlockOperation</span> *op1 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;1 == %@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}];</div><div class="line"><span class="built_in">NSBlockOperation</span> *op2 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;2 == %@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}];</div><div class="line"></div><div class="line"><span class="comment">// &#x6CE8;&#x610F;: &#x5982;&#x679C;&#x662F;&#x4F7F;&#x7528;block&#x6765;&#x5C01;&#x88C5;&#x4EFB;&#x52A1;, &#x90A3;&#x4E48;&#x6709;&#x4E00;&#x79CD;&#x66F4;&#x7B80;&#x4FBF;&#x7684;&#x65B9;&#x6CD5;</span></div><div class="line"><span class="comment">// &#x53EA;&#x8981;&#x5229;&#x7528;&#x961F;&#x5217;&#x8C03;&#x7528;addOperationWithBlock:&#x65B9;&#x6CD5;, &#x7CFB;&#x7EDF;&#x5185;&#x90E8;&#x4F1A;&#x81EA;&#x52A8;&#x5C01;&#x88C5;&#x6210;&#x4E00;&#x4E2A;NSBlockOperation \</span></div><div class="line">&#x7136;&#x540E;&#x518D;&#x6DFB;&#x52A0;&#x5230;&#x961F;&#x5217;&#x4E2D;</div><div class="line">[queue addOperationWithBlock:^{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;3 == %@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}];</div><div class="line"></div><div class="line"><span class="comment">// 3.&#x6DFB;&#x52A0;&#x4EFB;&#x52A1;&#x5230;&#x961F;&#x5217;</span></div><div class="line">[queue addOperation:op1];</div><div class="line">[queue addOperation:op2];</div></pre></td></tr></table></figure>
<ul>
<li>NSInvocationOperation</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 1.&#x521B;&#x5EFA;&#x961F;&#x5217;</span></div><div class="line"><span class="comment">/*</span></div><div class="line">GCD&#x4E2D;&#x6709;&#x54EA;&#x4E9B;&#x961F;&#x5217;:</div><div class="line">&#x5E76;&#x53D1;: &#x81EA;&#x5DF1;&#x521B;&#x5EFA;, &#x5168;&#x5C40;</div><div class="line">&#x4E32;&#x884C;: &#x81EA;&#x5DF1;&#x521B;&#x5EFA;, &#x4E3B;&#x961F;&#x5217;</div><div class="line"></div><div class="line">NSOperationQueue:</div><div class="line">&#x4E3B;&#x961F;&#x5217;: mainQueue</div><div class="line">&#x81EA;&#x5DF1;&#x521B;&#x5EFA;: &#x4F1A;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</div><div class="line"><span class="comment">// 2.&#x521B;&#x5EFA;&#x4EFB;&#x52A1;</span></div><div class="line"><span class="comment">// &#x53EA;&#x8981;&#x662F;&#x81EA;&#x5DF1;&#x521B;&#x5EFA;&#x7684;&#x961F;&#x5217;, &#x5C31;&#x4F1A;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;</span></div><div class="line"><span class="comment">// &#x800C;&#x4E14;&#x9ED8;&#x8BA4;&#x5C31;&#x662F;&#x5E76;&#x53D1;&#x6267;&#x884C;</span></div><div class="line"><span class="built_in">NSInvocationOperation</span> *op1 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(download1) object:<span class="literal">nil</span>];</div><div class="line"><span class="built_in">NSInvocationOperation</span> *op2 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(download2) object:<span class="literal">nil</span>];</div><div class="line"></div><div class="line"><span class="comment">// 3.&#x6DFB;&#x52A0;&#x4EFB;&#x52A1;&#x5230;&#x961F;&#x5217;&#x4E2D;</span></div><div class="line"><span class="comment">// &#x53EA;&#x8981;&#x5C06;&#x4EFB;&#x52A1;&#x6DFB;&#x52A0;&#x5230;&#x961F;&#x5217;&#x4E2D;, &#x961F;&#x5217;&#x4F1A;&#x81EA;&#x52A8;&#x8C03;&#x7528;start</span></div><div class="line">[queue addOperation:op1];</div><div class="line">[queue addOperation:op2];</div><div class="line"></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)download1</div><div class="line">{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;1 == %@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}</div><div class="line">- (<span class="keyword">void</span>)download2</div><div class="line">{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;2 == %@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}</div></pre></td></tr></table></figure>
<ul>
<li>&#x4E0A;&#x9762;&#x7684;&#x90FD;&#x4F1A;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x8FDB;&#x884C;&#xFF0C;&#x6240;&#x4EE5;&#x90FD;&#x662F;&#x5E76;&#x884C;&#x961F;&#x5217;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x8981;&#x4E32;&#x884C;&#x6267;&#x884C;&#xFF0C;&#x5C31;&#x628A;&#x6700;&#x5927;&#x5E76;&#x884C;&#x6570;&#x8BBE;&#x7F6E;&#x4E3A;1&#x5C31;&#x53EF;&#x4EE5;&#x4E86;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">queue.maxConcurrentOperationCount = <span class="number">1</span>;</div></pre></td></tr></table></figure>
<ul>
<li>NSOperation&#x6709;&#x4E2A;&#x597D;&#x5904;&#x5C31;&#x662F;&#x53EF;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#x4EFB;&#x52A1;</li>
<li>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7EE7;&#x627F;&#x81EA;NSOperation&#x7684;&#x5BF9;&#x8C61;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HJSOperation</span> : <span class="title">NSOperation</span></span></div></pre></td></tr></table></figure>
<ul>
<li>&#x7136;&#x540E;.m&#x6587;&#x4EF6;&#x91CC;&#x628A;&#x60F3;&#x8981;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;&#x586B;&#x5199;&#x5728;&#x91CD;&#x5199;&#x7684;main&#x51FD;&#x6570;&#x91CC;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">&#x53EA;&#x8981;&#x5C06;&#x4EFB;&#x52A1;&#x6DFB;&#x52A0;&#x5230;&#x961F;&#x5217;&#x4E2D;, &#x90A3;&#x4E48;&#x961F;&#x5217;&#x5728;&#x6267;&#x884C;&#x81EA;&#x5B9A;&#x4E49;&#x4EFB;&#x52A1;&#x7684;&#x65F6;&#x5019;</div><div class="line">&#x5C31;&#x4F1A;&#x81EA;&#x52A8;&#x8C03;&#x7528;main&#x65B9;&#x6CD5;</div><div class="line">*/</div><div class="line">- (<span class="keyword">void</span>)main</div><div class="line">{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%s, %@&quot;</span>, __func__, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}</div></pre></td></tr></table></figure>
<ul>
<li>&#x81EA;&#x5B9A;&#x4E49;NSOperation&#x7684;&#x64CD;&#x4F5C;&#x65B9;&#x6CD5;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// 1.&#x521B;&#x5EFA;&#x961F;&#x5217;</span></div><div class="line"><span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</div><div class="line"><span class="comment">// 2.&#x521B;&#x5EFA;&#x4EFB;&#x52A1;</span></div><div class="line"><span class="comment">// &#x81EA;&#x5B9A;&#x4E49;&#x4EFB;&#x52A1;&#x7684;&#x597D;&#x5904;: &#x63D0;&#x9AD8;&#x4EE3;&#x7801;&#x7684;&#x590D;&#x7528;&#x6027;</span></div><div class="line">XMGOperation *op1 = [[XMGOperation alloc] init];</div><div class="line">XMGOperation *op2 = [[XMGOperation alloc] init];</div><div class="line"></div><div class="line"><span class="comment">// 3.&#x6DFB;&#x52A0;&#x4EFB;&#x52A1;&#x5230;&#x961F;&#x5217;</span></div><div class="line">[queue addOperation:op1];</div><div class="line">[queue addOperation:op2];</div></pre></td></tr></table></figure>
<h2 id="NSOperation&#x7684;&#x6682;&#x505C;&#x3001;&#x6062;&#x590D;&#x548C;&#x53D6;&#x6D88;"><a href="#NSOperation&#x7684;&#x6682;&#x505C;&#x3001;&#x6062;&#x590D;&#x548C;&#x53D6;&#x6D88;" class="headerlink" title="NSOperation&#x7684;&#x6682;&#x505C;&#x3001;&#x6062;&#x590D;&#x548C;&#x53D6;&#x6D88;"></a>NSOperation&#x7684;&#x6682;&#x505C;&#x3001;&#x6062;&#x590D;&#x548C;&#x53D6;&#x6D88;</h2><ul>
<li>NSOperation&#x4E2D;&#x8FD8;&#x6709;&#x6682;&#x505C;&#xFF08;suspended&#xFF09;&#xFF0C;&#x6062;&#x590D;&#xFF08;&#xFF01;suspended&#xFF09;&#x548C;&#x53D6;&#x6D88;&#xFF08;cancelAllOperations&#xFF09;&#x529F;&#x80FD;&#xFF0C;&#x5176;&#x5B9E;&#x64CD;&#x4F5C;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x62FF;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x961F;&#x5217;&#x64CD;&#x4F5C;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x4E9B;&#x6CE8;&#x610F;&#x70B9;</li>
<li>&#x5982;&#x679C;&#x662F;&#x4E00;&#x4E2A;&#x4E32;&#x884C;&#x961F;&#x5217;&#xFF0C;&#x91CC;&#x9762;&#x6709;&#x591A;&#x4E2A;&#x4EFB;&#x52A1;&#xFF0C;&#x5F53;&#x961F;&#x5217;&#x8BBE;&#x7F6E;&#x4E3A;&#x53D6;&#x6D88;&#x6216;&#x8005;&#x6682;&#x505C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90A3;&#x4E48;&#x6B63;&#x5728;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;&#x4E0D;&#x4F1A;&#x6682;&#x505C;&#xFF0C;&#x77E5;&#x9053;&#x6267;&#x884C;&#x7ED3;&#x675F;&#xFF0C;&#x4E0B;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x4E0D;&#x4F1A;&#x518D;&#x6267;&#x884C;</li>
<li>&#x5982;&#x4E0B;&#x9762;&#x7684;&#x591A;&#x4E2A;&#x4EFB;&#x52A1;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">self.queue = [[NSOperationQueue alloc] init];</div><div class="line"></div><div class="line">self.queue.maxConcurrentOperationCount = 1;</div><div class="line">// 2.&#x521B;&#x5EFA;&#x4EFB;&#x52A1;</div><div class="line">/*</div><div class="line">[self.queue addOperationWithBlock:^{</div><div class="line">NSLog(@&quot;++++++++++++++++++++++++++++++++++++++&quot;);</div><div class="line">//        [NSThread sleepForTimeInterval:1];</div><div class="line">//        NSLog(@&quot;1 == %@&quot;, [NSThread currentThread]);</div><div class="line">for (int i = 0; i &lt; 10000; i++) { // 500</div><div class="line">NSLog(@&quot;%i ==== %@&quot;, i, [NSThread currentThread]);</div><div class="line">}</div><div class="line">}];</div><div class="line">[self.queue addOperationWithBlock:^{</div><div class="line">NSLog(@&quot;++++++++++++++++++++++++++++++++++++++&quot;);</div><div class="line">//        [NSThread sleepForTimeInterval:1];</div><div class="line">//        NSLog(@&quot;2 == %@&quot;, [NSThread currentThread]);</div><div class="line">for (int i = 0; i &lt; 10000; i++) {</div><div class="line">NSLog(@&quot;%i ==== %@&quot;, i, [NSThread currentThread]);</div><div class="line">}</div><div class="line">}];</div><div class="line">[self.queue addOperationWithBlock:^{</div><div class="line">NSLog(@&quot;++++++++++++++++++++++++++++++++++++++&quot;);</div><div class="line">//        [NSThread sleepForTimeInterval:1];</div><div class="line">//        NSLog(@&quot;3 == %@&quot;, [NSThread currentThread]);</div><div class="line">for (int i = 0; i &lt; 10000; i++) {</div><div class="line">NSLog(@&quot;%i ==== %@&quot;, i, [NSThread currentThread]);</div><div class="line">}</div><div class="line">}];</div><div class="line">[self.queue addOperationWithBlock:^{</div><div class="line">NSLog(@&quot;++++++++++++++++++++++++++++++++++++++&quot;);</div><div class="line">//        [NSThread sleepForTimeInterval:1];</div><div class="line">//        NSLog(@&quot;4 == %@&quot;, [NSThread currentThread]);</div><div class="line">for (int i = 0; i &lt; 10000; i++) {</div><div class="line">NSLog(@&quot;%i ==== %@&quot;, i, [NSThread currentThread]);</div><div class="line">}</div><div class="line">}];</div><div class="line">[self.queue addOperationWithBlock:^{</div><div class="line">NSLog(@&quot;++++++++++++++++++++++++++++++++++++++&quot;);</div><div class="line">//        [NSThread sleepForTimeInterval:1];</div><div class="line">//        NSLog(@&quot;5 == %@&quot;, [NSThread currentThread]);</div><div class="line">for (int i = 0; i &lt; 10000; i++) {</div><div class="line">NSLog(@&quot;%i ==== %@&quot;, i, [NSThread currentThread]);</div><div class="line">}</div><div class="line">}];</div><div class="line">[self.queue addOperationWithBlock:^{</div><div class="line">NSLog(@&quot;++++++++++++++++++++++++++++++++++++++&quot;);</div><div class="line">//        [NSThread sleepForTimeInterval:1];</div><div class="line">//        NSLog(@&quot;6 == %@&quot;, [NSThread currentThread]);</div><div class="line">for (int i = 0; i &lt; 10000; i++) {</div><div class="line">NSLog(@&quot;%i ==== %@&quot;, i, [NSThread currentThread]);</div><div class="line">}</div><div class="line">}];</div><div class="line">*/</div></pre></td></tr></table></figure>
<ul>
<li>&#x6682;&#x505C;&#x4EE3;&#x7801;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span> *)touches withEvent:(<span class="built_in">UIEvent</span> *)event</div><div class="line">{</div><div class="line"><span class="comment">//    [self operation1];</span></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">// &#x53EA;&#x8981;&#x8BBE;&#x7F6E;&#x961F;&#x5217;&#x7684;suspended&#x4E3A;YES, &#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x6682;&#x505C;&#x961F;&#x5217;&#x4E2D;&#x5176;&#x5B83;&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;</div><div class="line">// &#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4E0D;&#x4F1A;&#x518D;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x5230;&#x5F97;&#x4EFB;&#x52A1;</div><div class="line">// &#x53EA;&#x8981;&#x8BBE;&#x7F6E;&#x961F;&#x5217;&#x7684;suspended&#x4E3A;NO, &#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x6062;&#x590D;&#x961F;&#x5217;&#x4E2D;&#x5176;&#x5B83;&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;</div><div class="line">if (self.queue.suspended) {</div><div class="line">self.queue.suspended = NO;</div><div class="line">}else</div><div class="line">{</div><div class="line">// &#x6CE8;&#x610F;: &#x8BBE;&#x7F6E;&#x4E3A;&#x6682;&#x505C;&#x4E4B;&#x540E;, &#x4E0D;&#x4F1A;&#x7ACB;&#x5373;&#x6682;&#x505C;</div><div class="line">// &#x4F1A;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x5F53;&#x524D;&#x6B63;&#x5728;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;, &#x76F4;&#x5230;&#x5F53;&#x524D;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6BD5;, &#x5C31;&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#x4E0B;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x4E86;</div><div class="line">// &#x4E5F;&#x5C31;&#x662F;&#x8BF4;, &#x6682;&#x505C;&#x5176;&#x5B9E;&#x662F;&#x6682;&#x505C;&#x4E0B;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;, &#x800C;&#x4E0D;&#x80FD;&#x6682;&#x505C;&#x5F53;&#x524D;&#x4EFB;&#x52A1;</div><div class="line">// &#x6CE8;&#x610F;: &#x6682;&#x505C;&#x662F;&#x53EF;&#x4EE5;&#x6062;&#x590D;&#x7684;</div><div class="line">self.queue.suspended = YES;</div><div class="line">}</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="comment">// &#x53D6;&#x6D88;&#x961F;&#x5217;&#x4E2D;&#x6240;&#x6709;&#x7684;&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;</span></div><div class="line"><span class="comment">// &#x53D6;&#x6D88;&#x548C;&#x6682;&#x505C;&#x4E00;&#x6837;, &#x662F;&#x53D6;&#x6D88;&#x540E;&#x9762;&#x7684;&#x4EFB;&#x52A1;, &#x4E0D;&#x80FD;&#x53D6;&#x6D88;&#x5F53;&#x524D;&#x6B63;&#x5728;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;</span></div><div class="line"><span class="comment">// &#x6CE8;&#x610F;: &#x53D6;&#x6D88;&#x662F;&#x4E0D;&#x53EF;&#x4EE5;&#x6062;&#x590D;&#x7684;</span></div><div class="line">[<span class="keyword">self</span>.queue cancelAllOperations];</div><div class="line"></div><div class="line">}</div></pre></td></tr></table></figure>
<ul>
<li>&#x7531;&#x4E8E;&#x6682;&#x505C;&#x53D7;&#x5230;&#x5982;&#x6B64;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x6240;&#x4EE5;&#x5373;&#x4F7F;&#x82F9;&#x679C;&#x4E5F;&#x5EFA;&#x8BAE;&#x6211;&#x4EEC;&#x5728;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x4EFB;&#x52A1;&#x4E2D;&#xFF0C;&#x505A;&#x8017;&#x65F6;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x5206;&#x6BB5;&#x505A;&#x51FA;&#x4E00;&#x4E9B;&#x5224;&#x65AD;&#xFF0C;&#x5F53;&#x5BDF;&#x89C9;&#x5230;&#x7EBF;&#x7A0B;&#x72B6;&#x6001;&#x6539;&#x53D8;&#x65F6;&#xFF0C;&#x53CA;&#x65F6;&#x4E3B;&#x52A8;&#x505C;&#x6B62;&#x4EFB;&#x52A1;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)main</div><div class="line">{</div><div class="line"><span class="comment">// &#x8017;&#x65F6;&#x64CD;&#x4F5C;1</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) { <span class="comment">// 500</span></div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%i ==== %@&quot;</span>, i, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;++++++++++++++++++++++++++++++++++++++&quot;</span>);</div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.isCancelled) {</div><div class="line"><span class="keyword">return</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// &#x8017;&#x65F6;&#x64CD;&#x4F5C;2</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) { <span class="comment">// 500</span></div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%i ==== %@&quot;</span>, i, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}</div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.isCancelled) {</div><div class="line"><span class="keyword">return</span>;</div><div class="line">}</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;++++++++++++++++++++++++++++++++++++++&quot;</span>);</div><div class="line"><span class="comment">// &#x597D;&#x6240;&#x64CD;&#x4F5C;3</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) { <span class="comment">// 500</span></div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%i ==== %@&quot;</span>, i, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}</div><div class="line">}</div></pre></td></tr></table></figure>
<ul>
<li>&#x81EA;&#x5B9A;&#x4E49;&#x4EFB;&#x52A1;&#x53EA;&#x80FD;&#x8BBF;&#x95EE;isCancelled&#x5C5E;&#x6027;&#xFF0C;&#x5728;&#x51E0;&#x4E2A;&#x8017;&#x65F6;&#x4EE3;&#x7801;&#x4E4B;&#x95F4;&#x63D2;&#x5165;&#x5224;&#x65AD;&#xFF0C;&#x5F53;&#x7EBF;&#x7A0B;&#x88AB;&#x53D6;&#x6D88;&#x65F6;&#xFF0C;&#x4E3B;&#x52A8;return</li>
</ul>
<hr>
<h2 id="&#x7EBF;&#x7A0B;&#x4F9D;&#x8D56;"><a href="#&#x7EBF;&#x7A0B;&#x4F9D;&#x8D56;" class="headerlink" title="&#x7EBF;&#x7A0B;&#x4F9D;&#x8D56;"></a>&#x7EBF;&#x7A0B;&#x4F9D;&#x8D56;</h2><ul>
<li>&#x8FD9;&#x91CC;&#x6709;&#x70B9;&#x7C7B;&#x4F3C;&#x4E8E;GCD&#x4E2D;&#x7684;&#x6805;&#x680F;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x66F4;&#x5389;&#x5BB3;&#x4E00;&#x4E9B;&#xFF0C;&#x6805;&#x680F;&#x7684;&#x4F7F;&#x7528;&#x5FC5;&#x987B;&#x8981;&#x5728;&#x540C;&#x4E00;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x800C;NSOperation&#x6CA1;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x9650;&#x5236;</li>
<li>GCD&#x6805;&#x680F;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">&quot;com.520it.lnj&quot;</span>, DISPATCH_QUEUE_CONCURRENT);</div><div class="line"><span class="built_in">dispatch_queue_t</span> queue2 = dispatch_queue_create(<span class="string">&quot;com.520it.lmj&quot;</span>, DISPATCH_QUEUE_CONCURRENT);</div><div class="line"></div><div class="line"><span class="built_in">dispatch_async</span>(queue, ^{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;1-------%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">});</div><div class="line"><span class="built_in">dispatch_async</span>(queue, ^{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;2-------%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">});</div><div class="line"><span class="built_in">dispatch_async</span>(queue, ^{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;3-------%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">});</div><div class="line"></div><div class="line">dispatch_barrier_async(queue2, ^{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;4-------%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">});</div></pre></td></tr></table></figure>
<ul>
<li>&#x4E0A;&#x9762;&#x7684;&#x6805;&#x680F;&#x65E0;&#x6CD5;&#x8D77;&#x5230;&#x9650;&#x5236;&#x4F5C;&#x7528;&#xFF0C;&#x6805;&#x680F;&#x4F9D;&#x7136;&#x6709;&#x53EF;&#x80FD;&#x5728;&#x524D;&#x9762;&#x7684;&#x5F02;&#x6B65;&#x4E4B;&#x524D;&#x6267;&#x884C;&#xFF0C;&#x56E0;&#x4E3A;&#x5FC5;&#x987B;&#x8981;&#x5728;&#x540C;&#x4E00;&#x961F;&#x5217;&#x4E2D;</li>
<li>&#x518D;&#x6765;&#x770B;&#x770B;NSOperation&#x7684;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 1.&#x521B;&#x5EFA;&#x961F;&#x5217;</span></div><div class="line"><span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</div><div class="line"><span class="built_in">NSOperationQueue</span> *queue2 = [[<span class="built_in">NSOperationQueue</span> alloc] init];</div><div class="line"></div><div class="line"><span class="comment">// 2.&#x521B;&#x5EFA;&#x4EFB;&#x52A1;</span></div><div class="line"><span class="built_in">NSBlockOperation</span> *op1 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;1-------%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}];</div><div class="line"><span class="built_in">NSBlockOperation</span> *op2 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;2-------%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}];</div><div class="line"><span class="built_in">NSBlockOperation</span> *op3 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;3-------%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}];</div><div class="line"><span class="built_in">NSBlockOperation</span> *op4 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;4-------%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) {</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%i&quot;</span>, i);</div><div class="line">}</div><div class="line">}];</div><div class="line"><span class="built_in">NSBlockOperation</span> *op5 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;5-------%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">}];</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 3.&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;</span></div><div class="line">[op5 addDependency:op1];</div><div class="line">[op5 addDependency:op2];</div><div class="line">[op5 addDependency:op3];</div><div class="line">[op5 addDependency:op4];</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 4.&#x76D1;&#x542C;op4&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x6267;&#x884C;&#x5B8C;&#x6BD5;</span></div><div class="line">op4.completionBlock = ^{</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;op4&#x4E2D;&#x6240;&#x6709;&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x4E86;&quot;</span>);</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// 4.&#x6DFB;&#x52A0;&#x4EFB;&#x52A1;&#x5230;&#x961F;&#x5217;</span></div><div class="line">[queue addOperation:op1];</div><div class="line">[queue addOperation:op2];</div><div class="line">[queue2 addOperation:op3];</div><div class="line">[queue2 addOperation:op4];</div><div class="line">[queue addOperation:op5];</div></pre></td></tr></table></figure>
<ul>
<li>&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x65E0;&#x8BBA;&#x6267;&#x884C;&#x591A;&#x5C11;&#x6B21;&#xFF0C;<code>op5</code>&#x90FD;&#x53EA;&#x4F1A;&#x5728;&#x6700;&#x540E;&#x6267;&#x884C;&#xFF0C;&#x5E76;&#x4E14;&#x6CA1;&#x6709;&#x961F;&#x5217;&#x9650;&#x5236;</li>
</ul>
<hr>
<h2 id="&#x7EBF;&#x7A0B;&#x95F4;&#x7684;&#x901A;&#x4FE1;"><a href="#&#x7EBF;&#x7A0B;&#x95F4;&#x7684;&#x901A;&#x4FE1;" class="headerlink" title="&#x7EBF;&#x7A0B;&#x95F4;&#x7684;&#x901A;&#x4FE1;"></a>&#x7EBF;&#x7A0B;&#x95F4;&#x7684;&#x901A;&#x4FE1;</h2><ul>
<li>&#x77E5;&#x9053;&#x4E86;&#x600E;&#x4E48;&#x6DFB;&#x52A0;&#x7EBF;&#x7A0B;&#x4F9D;&#x8D56;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x6765;&#x5B66;&#x4E60;&#x7EBF;&#x7A0B;&#x901A;&#x4FE1;&#x4E86;</li>
<li>&#x56E0;&#x4E3A;&#x7EBF;&#x7A0B;&#x901A;&#x4FE1;&#x7275;&#x626F;&#x5230;&#x7EBF;&#x7A0B;&#x7684;&#x5148;&#x540E;&#x6267;&#x884C;&#xFF0C;&#x53EA;&#x6709;&#x5F53;&#x8017;&#x65F6;&#x64CD;&#x4F5C;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x624D;&#x80FD;&#x6765;&#x901A;&#x77E5;&#x4E3B;&#x7EBF;&#x7A0B;&#x5237;&#x65B0;UI&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x7EBF;&#x7A0B;&#x901A;&#x4FE1;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 1.&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x961F;&#x5217;</span></div><div class="line"><span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</div><div class="line"></div><div class="line"><span class="comment">// 2.&#x6DFB;&#x52A0;&#x4EFB;&#x52A1;(&#x64CD;&#x4F5C;)</span></div><div class="line">[queue addOperationWithBlock:^{</div><div class="line"><span class="comment">// 2.1&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x4E0B;&#x8F7D;&#x56FE;&#x7247;</span></div><div class="line"><span class="built_in">NSURL</span> *url  = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@&quot;http://imgcache.mysodao.com/img2/M04/8C/74/CgAPDk9dyjvS1AanAAJPpRypnFA573_700x0x1.JPG&quot;</span>];</div><div class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</div><div class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</div><div class="line"></div><div class="line"><span class="comment">// 2.2&#x56DE;&#x5230;&#x4E3B;&#x7EBF;&#x7A0B;&#x66F4;&#x65B0;UI</span></div><div class="line">[[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^{</div><div class="line"><span class="keyword">self</span>.imageView.image = image;</div><div class="line">}];</div><div class="line">}];</div></pre></td></tr></table></figure>
<ul>
<li>&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x6CA1;&#x6709;&#x4F53;&#x73B0;&#x51FA;&#x7EBF;&#x7A0B;&#x4F9D;&#x8D56;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x4E0B;&#x9762;&#x5F04;&#x4E2A;&#x6709;&#x7EBF;&#x7A0B;&#x4F9D;&#x8D56;&#x7684;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 1.&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x961F;&#x5217;</span></div><div class="line"><span class="comment">// &#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;, &#x5728;&#x505A;&#x4F01;&#x4E1A;&#x5F00;&#x53D1;&#x65F6;&#x5019;, &#x90FD;&#x4F1A;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x961F;&#x5217;, &#x4FBF;&#x4E8E;&#x4F7F;&#x7528;</span></div><div class="line"><span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</div><div class="line"></div><div class="line"><span class="comment">// 2.&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x4E0B;&#x8F7D;&#x7B2C;&#x4E00;&#x5F20;&#x56FE;&#x7247;</span></div><div class="line">__block <span class="built_in">UIImage</span> *image1 = <span class="literal">nil</span>;</div><div class="line"><span class="built_in">NSBlockOperation</span> *op1 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^{</div><div class="line"><span class="built_in">NSURL</span> *url  = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@&quot;http://imgcache.mysodao.com/img2/M04/8C/74/CgAPDk9dyjvS1AanAAJPpRypnFA573_700x0x1.JPG&quot;</span>];</div><div class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</div><div class="line">image1 = [<span class="built_in">UIImage</span> imageWithData:data];</div><div class="line">}];</div><div class="line"></div><div class="line"><span class="comment">// 3.&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x4E0B;&#x8F7D;&#x7B2C;&#x4E8C;&#x5F20;&#x56FE;&#x7247;</span></div><div class="line">__block <span class="built_in">UIImage</span> *image2 = <span class="literal">nil</span>;</div><div class="line"><span class="built_in">NSBlockOperation</span> *op2 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^{</div><div class="line"><span class="built_in">NSURL</span> *url  = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@&quot;http://imgcache.mysodao.com/img1/M02/EE/B5/CgAPDE-kEtqjE8CWAAg9m-Zz4qo025-22365300.JPG&quot;</span>];</div><div class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</div><div class="line">image2 = [<span class="built_in">UIImage</span> imageWithData:data];</div><div class="line">}];</div><div class="line"><span class="comment">// 4.&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x5408;&#x6210;&#x56FE;&#x7247;</span></div><div class="line"><span class="built_in">NSBlockOperation</span> *op3 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^{</div><div class="line"><span class="built_in">UIGraphicsBeginImageContext</span>(<span class="built_in">CGSizeMake</span>(<span class="number">200</span>, <span class="number">200</span>));</div><div class="line">[image1 drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">200</span>)];</div><div class="line">[image2 drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">200</span>)];</div><div class="line"><span class="built_in">UIImage</span> *res = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</div><div class="line"><span class="built_in">UIGraphicsEndImageContext</span>();</div><div class="line"></div><div class="line"><span class="comment">// 5.&#x56DE;&#x5230;&#x4E3B;&#x7EBF;&#x7A0B;&#x66F4;&#x65B0;UI</span></div><div class="line">[[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^{</div><div class="line"><span class="keyword">self</span>.imageView.image = res;</div><div class="line">}];</div><div class="line">}];</div><div class="line"></div><div class="line"><span class="comment">// 6.&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;</span></div><div class="line"></div><div class="line">[op3 addDependency:op1];</div><div class="line">[op3 addDependency:op2];</div><div class="line"></div><div class="line"><span class="comment">// 7.&#x6DFB;&#x52A0;&#x64CD;&#x4F5C;&#x5230;&#x961F;&#x5217;&#x4E2D;</span></div><div class="line">[queue addOperation:op1];</div><div class="line">[queue addOperation:op2];</div><div class="line">[queue addOperation:op3];</div></pre></td></tr></table></figure>
<ul>
<li><p>&#x4E0D;&#x7BA1;&#x600E;&#x6837;&#xFF0C;UI&#x7684;&#x5237;&#x65B0;&#x5FC5;&#x5B9A;&#x5728;&#x6570;&#x636E;&#x4E0B;&#x8F7D;&#x7EBF;&#x7A0B;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;</p>
<h2 id="&#x540C;&#x6B65;&#x5728;&#x4E32;&#x884C;&#x961F;&#x5217;&#x91CC;&#x9020;&#x6210;&#x6B7B;&#x9501;&#x7684;&#x60C5;&#x51B5;&#x89E3;&#x6790;"><a href="#&#x540C;&#x6B65;&#x5728;&#x4E32;&#x884C;&#x961F;&#x5217;&#x91CC;&#x9020;&#x6210;&#x6B7B;&#x9501;&#x7684;&#x60C5;&#x51B5;&#x89E3;&#x6790;" class="headerlink" title="&#x540C;&#x6B65;&#x5728;&#x4E32;&#x884C;&#x961F;&#x5217;&#x91CC;&#x9020;&#x6210;&#x6B7B;&#x9501;&#x7684;&#x60C5;&#x51B5;&#x89E3;&#x6790;"></a>&#x540C;&#x6B65;&#x5728;&#x4E32;&#x884C;&#x961F;&#x5217;&#x91CC;&#x9020;&#x6210;&#x6B7B;&#x9501;&#x7684;&#x60C5;&#x51B5;&#x89E3;&#x6790;</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">1&#xFF1A;</div><div class="line"></div><div class="line">- (void)viewDidLoad {</div><div class="line"></div><div class="line">//dispatch_sync(dispatch_get_main_queue(), ^{</div><div class="line">//NSLog(@3);</div><div class="line">//&#x6B7B;&#x9501;&#x539F;&#x56E0;</div><div class="line">//1:dispatch_sync&#x5728;&#x7B49;&#x5F85;block&#x8BED;&#x53E5;&#x6267;&#x884C;&#x5B8C;&#x6210;&#xFF0C;&#x800C;block&#x8BED;&#x53E5;&#x9700;&#x8981;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x91CC;&#x6267;&#x884C;&#xFF0C;&#x6240;&#x4EE5;dispatch_sync&#x5982;&#x679C;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x8C03;&#x7528;&#x5C31;&#x4F1A;&#x9020;&#x6210;&#x6B7B;&#x9501;</div><div class="line">//2:dispatch_sync&#x662F;&#x540C;&#x6B65;&#x7684;&#xFF0C;&#x672C;&#x8EAB;&#x5C31;&#x4F1A;&#x963B;&#x585E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#xFF0C;&#x4E5F;&#x5373;&#x4E3B;&#x7EBF;&#x7A0B;&#x3002;&#x800C;&#x53C8;&#x5F80;&#x4E3B;&#x7EBF;&#x7A0B;&#x91CC;&#x585E;&#x8FDB;&#x53BB;&#x4E00;&#x4E2A;block&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x4F1A;&#x53D1;&#x751F;&#x6B7B;&#x9501;&#x3002;</div><div class="line">//});</div><div class="line">//dispatch_async(dispatch_get_global_queue(), ^{</div><div class="line">//async &#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D; &#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x7EBF;&#x7A0B; &#x52A0;&#x5165; &#x5168;&#x5C40;&#x5E76;&#x53D1;&#x961F;&#x5217;&#xFF0C;async &#x4E0D;&#x4F1A;&#x7B49;&#x5F85;block &#x6267;&#x884C;&#x5B8C;&#x6210;&#xFF0C;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;</div><div class="line"></div><div class="line">NSLog(@2);//&#x4E0D;&#x4F1A;&#x9020;&#x6210;&#x6B7B;&#x9501;&#xFF1B;</div><div class="line"></div><div class="line">});</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line">&#x5206;&#x6790;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#xFF1A;view DidLoad &#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#xFF0C;&#x4E5F;&#x5373;dispatch_get_main_queue()&#x4E2D;&#xFF0C;&#x6267;&#x884C;&#x5230;sync&#x65F6;&#x5411;dispatch_get_main_queue()&#x63D2;&#x5165;&#x540C;&#x6B65;thread&#xFF0C;sync&#x4F1A;&#x7B49;&#x5230;&#x540E;&#x9762;&#x7684;block&#x6267;&#x884C;&#x5B8C;&#x6210;&#x624D;&#x8FD4;&#x56DE;&#x3002;sync&#x53C8;&#x5728;&#x4E3B;&#x961F;&#x5217;&#x91CC;&#x9762;&#xFF0C;&#x662F;&#x4E2A;&#x4E32;&#x884C;&#x961F;&#x5217;&#xFF0C;sync&#x662F;&#x540E;&#x9762;&#x624D;&#x52A0;&#x5165;&#x7684;&#xFF0C;&#x524D;&#x9762;&#x4E00;&#x4E2A;&#x662F;&#x4E3B;&#x7EBF;&#x7A0B;&#xFF0C;&#x6240;&#x4EE5;sync&#x60F3;&#x6267;&#x884C;block&#x5FC5;&#x987B;&#x7B49;&#x5F85;&#x524D;&#x4E00;&#x4E2A;&#x4E3B;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x5B8C;&#x6210;&#xFF0C;&#x800C;&#x4E3B;&#x7EBF;&#x7A0B;&#x5374;</div><div class="line"></div><div class="line">&#x5728;&#x7B49;&#x5F85;sync&#x8FD4;&#x56DE;&#xFF0C;&#x53BB;&#x6267;&#x884C;&#x540E;&#x7EED;&#x5DE5;&#x4F5C;&#xFF0C;&#x4ECE;&#x800C;&#x9020;&#x6210;&#x6B7B;&#x9501;&#x3002;</div><div class="line"></div><div class="line">2:</div><div class="line"></div><div class="line">dispatch_sync &#x548C; dispatch_async &#x533A;&#x522B;&#xFF1A;</div><div class="line"></div><div class="line">dispatch_async(queue,block) async &#x5F02;&#x6B65;&#x961F;&#x5217;&#xFF0C;dispatch_async &#x51FD;&#x6570;&#x4F1A;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;, block&#x4F1A;&#x5728;&#x540E;&#x53F0;&#x5F02;&#x6B65;&#x6267;&#x884C;&#x3002;</div><div class="line">dispatch_sync(queue,block) sync &#x540C;&#x6B65;&#x961F;&#x5217;&#xFF0C;dispatch_sync &#x51FD;&#x6570;&#x4E0D;&#x4F1A;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#xFF0C;&#x5373;&#x963B;&#x585E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;,&#x7B49;&#x5F85; block&#x540C;&#x6B65;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x3002;</div><div class="line"></div><div class="line">3:</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">GCD Queue &#x5206;&#x4E3A;&#x4E09;&#x79CD;&#xFF1A;</div><div class="line"></div><div class="line">1&#xFF0C;The main queue &#xFF1A;&#x4E3B;&#x961F;&#x5217;&#xFF0C;&#x4E3B;&#x7EBF;&#x7A0B;&#x5C31;&#x662F;&#x5728;&#x4E2A;&#x961F;&#x5217;&#x4E2D;&#x3002;</div><div class="line"></div><div class="line">2&#xFF0C;Global queues &#xFF1A; &#x5168;&#x5C40;&#x5E76;&#x53D1;&#x961F;&#x5217;&#x3002;</div><div class="line"></div><div class="line">3&#xFF0C;&#x7528;&#x6237;&#x961F;&#x5217;:&#x662F;&#x7528;&#x51FD;&#x6570; dispatch_queue_create &#x521B;&#x5EFA;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x961F;&#x5217;</div><div class="line">*/</div></pre></td></tr></table></figure>
</li>
<li><p>&#x961F;&#x5217;&#x662F;&#x7BA1;&#x7406;&#x4EFB;&#x52A1;&#x7684;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x7528;dispatch_async&#x6216;&#x8005;dispatch_sync&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x52A0;&#x5165;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x662F;&#x628A;&#x4EFB;&#x52A1;&#x585E;&#x7ED9;&#x4E86;&#x961F;&#x5217;</p>
</li>
<li>&#x7136;&#x540E;&#x7531;&#x961F;&#x5217;&#x6765;&#x5206;&#x914D;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x4EFB;&#x52A1;</li>
<li>&#x90A3;&#x4E48;async&#x4E0E;sync&#x5176;&#x5B9E;&#x6307;&#x7684;&#x5C31;&#x662F;&#x4EFB;&#x52A1;&#x7684;&#x4F18;&#x5148;&#x7EA7;</li>
<li>&#x5728;&#x4E32;&#x884C;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;&#x662F;&#x6309;&#x987A;&#x5E8F;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x6392;&#x5728;&#x6700;&#x524D;&#x9762;&#x7684;&#x4EFB;&#x52A1;&#x4F18;&#x5148;&#x7EA7;&#x6700;&#x9AD8;</li>
<li>&#x5728;&#x5E76;&#x884C;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x4E0D;&#x6309;&#x987A;&#x5E8F;</li>
<li>dispatch_sync&#x672C;&#x8EAB;&#x662F;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x6267;&#x884C;&#x540C;&#x65F6;&#x53C8;&#x8981;&#x6267;&#x884C;&#x5B83;&#x7684;&#x4EE3;&#x7801;&#x5757;&#xFF0C;&#x8FD9;&#x4E9B;&#x4EFB;&#x52A1;&#x90FD;&#x662F;&#x76F8;&#x540C;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x4F1A;&#x5BF9;&#x7EBF;&#x7A0B;&#x8D44;&#x6E90;&#x9020;&#x6210;&#x62A2;&#x5360;</li>
<li>&#x800C;&#x5728;dispatch_async&#x6CA1;&#x6709;&#x4EFB;&#x52A1;&#x7684;&#x987A;&#x5E8F;&#x5F3A;&#x5236;&#x6027;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x4E0D;&#x4F1A;&#x9020;&#x6210;&#x8D44;&#x6E90;&#x62A2;&#x5360;</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/10/AFNet上传/" itemprop="url">
                  AFNet上传
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-07-10T08:25:19+08:00" content="2016-07-10">
              2016-07-10
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/10/AFNet上传/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/10/AFNet上传/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>&#x4E0A;&#x4F20;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</div><div class="line"></div><div class="line"><span class="built_in">NSDictionary</span> *dict = @{<span class="string">@&quot;username&quot;</span>:<span class="string">@&quot;hjs&quot;</span>};</div><div class="line"></div><div class="line">[manager POST:<span class="string">@&quot;http://120.25.226.186:32812/upload&quot;</span> parameters:dict constructingBodyWithBlock:^(<span class="keyword">id</span>&lt;AFMultipartFormData&gt; formData) {</div><div class="line"></div><div class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> fileURLWithPath:<span class="string">@&quot;/Users/Programer/Desktop/&#x684C;&#x9762;/20140701231656_tfNAZ.jpeg&quot;</span>];</div><div class="line"></div><div class="line">[formData appendPartWithFileURL:url name:<span class="string">@&quot;file&quot;</span> error:<span class="literal">nil</span>];</div><div class="line"></div><div class="line">} success:^(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="keyword">id</span> responseObject) {</div><div class="line"><span class="built_in">NSDictionary</span> *res = responseObject;</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,res);</div><div class="line">} failure:^(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="built_in">NSError</span> *error) {</div><div class="line"><span class="keyword">if</span> (error) {</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;&#x5931;&#x8D25;&quot;</span>);</div><div class="line">}</div><div class="line">}];</div></pre></td></tr></table></figure>
<ul>
<li>&#x4E0B;&#x8F7D;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</div><div class="line"></div><div class="line">NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@&quot;http://120.25.226.186:32812/resources/images/minion_02.png&quot;]];</div><div class="line"></div><div class="line">NSProgress *progress = nil;</div><div class="line"></div><div class="line">NSURLSessionDownloadTask * task = [manager downloadTaskWithRequest:request progress:&amp;progress destination:^NSURL *(NSURL *targetPath, NSURLResponse *response) {</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">NSString *cacheP = [NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES)lastObject];</div><div class="line"></div><div class="line">NSString *path = [cacheP stringByAppendingPathComponent:response.suggestedFilename];</div><div class="line"></div><div class="line">NSLog(@&quot;%@&quot;,path);</div><div class="line"></div><div class="line">NSURL *url = [NSURL fileURLWithPath:path];</div><div class="line">return url;</div><div class="line">} completionHandler:^(NSURLResponse *response, NSURL *filePath, NSError *error) {</div><div class="line"></div><div class="line">}];</div><div class="line"></div><div class="line">//&#x4E3A;&#x8FDB;&#x5EA6;&#x6DFB;&#x52A0;&#x89C2;&#x5BDF;&#x8005;</div><div class="line">[progress addObserver:self forKeyPath:@&quot;completedUnitCount&quot; options:NSKeyValueObservingOptionNew context:nil];</div><div class="line"></div><div class="line">[task resume];</div></pre></td></tr></table></figure>
<ul>
<li>get&#x8BF7;&#x6C42;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</div><div class="line"><span class="built_in">NSDictionary</span> *parameters = @{</div><div class="line"><span class="string">@&quot;username&quot;</span>:<span class="string">@&quot;hjsit&quot;</span>,</div><div class="line"><span class="string">@&quot;pwd&quot;</span>:<span class="string">@&quot;hjsit&quot;</span></div><div class="line">};</div><div class="line">[manager GET:<span class="string">@&quot;http://120.25.226.186:32812/login&quot;</span> parameters:parameters success:^(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="keyword">id</span> responseObject) {</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,[responseObject <span class="keyword">class</span>]);</div><div class="line">} failure:^(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="built_in">NSError</span> *error) {</div><div class="line"></div><div class="line">}];</div></pre></td></tr></table></figure>
<ul>
<li>&#x76D1;&#x542C;&#x7F51;&#x7EDC;&#x72B6;&#x6001;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">// 1.&#x521B;&#x5EFA;&#x7F51;&#x7EDC;&#x76D1;&#x542C;&#x7BA1;&#x7406;&#x8005;&#x5BF9;&#x8C61;</div><div class="line">AFNetworkReachabilityManager *manager = [AFNetworkReachabilityManager sharedManager];</div><div class="line">// 2.&#x8BBE;&#x7F6E;&#x76D1;&#x542C;</div><div class="line">/*</div><div class="line">AFNetworkReachabilityStatusUnknown          = -1,  &#x672A;&#x8BC6;&#x522B;</div><div class="line">AFNetworkReachabilityStatusNotReachable     = 0,   &#x672A;&#x8FDE;&#x63A5;</div><div class="line">AFNetworkReachabilityStatusReachableViaWWAN = 1,   3G</div><div class="line">AFNetworkReachabilityStatusReachableViaWiFi = 2,  wifi</div><div class="line">*/</div><div class="line">[manager setReachabilityStatusChangeBlock:^ void(AFNetworkReachabilityStatus status) {</div><div class="line">switch (status) {</div><div class="line">case AFNetworkReachabilityStatusNotReachable:</div><div class="line">NSLog(@&quot;&#x672A;&#x8FDE;&#x63A5;&quot;);</div><div class="line">break;</div><div class="line">case AFNetworkReachabilityStatusReachableViaWWAN:</div><div class="line">NSLog(@&quot;&#x624B;&#x673A;&#x81EA;&#x5E26;&#x7F51;&#x7EDC;&quot;);</div><div class="line">break;</div><div class="line">case AFNetworkReachabilityStatusReachableViaWiFi:</div><div class="line">NSLog(@&quot;wifi&#x7F51;&#x7EDC;&quot;);</div><div class="line">break;</div><div class="line">default:</div><div class="line">NSLog(@&quot;&#x672A;&#x8BC6;&#x522B;&quot;);</div><div class="line">break;</div><div class="line">}</div><div class="line">}];</div><div class="line"></div><div class="line">// 3.&#x5F00;&#x542F;&#x76D1;&#x542C;</div><div class="line">[manager startMonitoring];</div></pre></td></tr></table></figure>
<ul>
<li>&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x6570;&#x636E;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 1.&#x521B;&#x5EFA;&#x7F51;&#x7EDC;&#x7BA1;&#x7406;&#x8005;</span></div><div class="line">AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</div><div class="line"></div><div class="line"><span class="comment">// 2.&#x5229;&#x7528;&#x7F51;&#x7EDC;&#x7BA1;&#x7406;&#x8005;&#x53D1;&#x9001;get&#x8BF7;&#x6C42;</span></div><div class="line"><span class="comment">//    NSDictionary *parameters = @{</span></div><div class="line"><span class="comment">//                                 @&quot;username&quot;:@&quot;hjsit&quot;,</span></div><div class="line"><span class="comment">//                                 @&quot;pwd&quot;:@&quot;hjsit&quot;,</span></div><div class="line"><span class="comment">//                                 @&quot;type&quot;:@&quot;XML&quot;</span></div><div class="line"><span class="comment">//                                 };</span></div><div class="line">[AFJSONResponseSerializer serializer].acceptableContentTypes = [<span class="built_in">NSSet</span> setWithObject:<span class="string">@&quot;text/xml&quot;</span>];</div><div class="line"><span class="comment">// &#x544A;&#x8BC9;AFN, &#x5C06;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x636E;&#x5F53;&#x505A;JSON&#x6765;&#x5904;&#x7406;</span></div><div class="line"><span class="comment">//    manager.responseSerializer = [AFJSONRequestSerializer serializer];</span></div><div class="line"><span class="comment">// &#x544A;&#x8BC9;AFN, &#x5C06;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x636E;&#x5F53;&#x505A;XML&#x6765;&#x5904;&#x7406;</span></div><div class="line"><span class="comment">//    manager.responseSerializer = [AFXMLParserResponseSerializer serializer];</span></div><div class="line"><span class="comment">// &#x544A;&#x8BC9;AFN, &#x5C06;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x636E;&#x5F53;&#x505A;&#x4E8C;&#x8FDB;&#x5236;&#x6765;&#x6570;&#x636E; (&#x670D;&#x52A1;&#x5668;&#x8FD4;&#x56DE;&#x4EC0;&#x4E48;&#x5C31;&#x662F;&#x4EC0;&#x4E48;)</span></div><div class="line">manager.responseSerializer = [AFHTTPResponseSerializer serializer];</div><div class="line"></div><div class="line">[manager GET:<span class="string">@&quot;http://120.25.226.186:32812/resources/images/minion_02.png&quot;</span> parameters:<span class="literal">nil</span> success:^ <span class="keyword">void</span>(<span class="built_in">NSURLSessionDataTask</span> * task, <span class="keyword">id</span> responseObject) {</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;&#x8BF7;&#x6C42;&#x6210;&#x529F; %@&quot;</span>, [responseObject <span class="keyword">class</span>]);</div><div class="line">} failure:^ <span class="keyword">void</span>(<span class="built_in">NSURLSessionDataTask</span> * operation, <span class="built_in">NSError</span> * error) {</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;&#x8BF7;&#x6C42;&#x5931;&#x8D25; %@&quot;</span>, error);</div><div class="line">}];</div></pre></td></tr></table></figure>
<ul>
<li>AFN&#x63A8;&#x8350;&#x7EE7;&#x627F;&#xFF0C;&#x63A8;&#x8350;&#x4F7F;&#x7528;initWithBaseURL,&#x5355;&#x4F8B;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">instancetype</span>)shareNetworkTools2</div><div class="line">{</div><div class="line"><span class="keyword">static</span> XMGNetworkTools2 *instance;</div><div class="line"><span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line"><span class="built_in">dispatch_once</span>(&amp;onceToken, ^{</div><div class="line"></div><div class="line"><span class="built_in">NSURLSessionConfiguration</span> *cfg  = [<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration];</div><div class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@&quot;http://120.25.226.186:32812/&quot;</span>];</div><div class="line">instance = [[<span class="keyword">self</span> alloc] initWithBaseURL:url sessionConfiguration:cfg];</div><div class="line">});</div><div class="line"><span class="keyword">return</span> instance;</div><div class="line">}</div></pre></td></tr></table></figure>
<ul>
<li>AFN&#x5DF2;&#x7ECF;&#x5C01;&#x88C5;&#x4E86;HTTPS&#x8BC1;&#x4E66;&#x6388;&#x6743;&#x4EE3;&#x7801;&#xFF0C;&#x76F4;&#x63A5;&#x53EF;&#x4EE5;&#x8BF7;&#x6C42;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x8BC1;&#x4E66;&#x6388;&#x6743;&#x4EE3;&#x7801;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">*</div><div class="line">&#x53EA;&#x8981;&#x8BF7;&#x6C42;&#x7684;&#x5730;&#x5740;&#x662F;HTTPS&#x7684;, &#x5C31;&#x4F1A;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x4EE3;&#x7406;&#x65B9;&#x6CD5;</div><div class="line">&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;&#x8BE5;&#x65B9;&#x6CD5;&#x4E2D;&#x544A;&#x8BC9;&#x7CFB;&#x7EDF;, &#x662F;&#x5426;&#x4FE1;&#x4EFB;&#x670D;&#x52A1;&#x5668;&#x8FD4;&#x56DE;&#x7684;&#x8BC1;&#x4E66;</div><div class="line">Challenge: &#x6311;&#x6218; &#x8D28;&#x95EE; (&#x5305;&#x542B;&#x4E86;&#x53D7;&#x4FDD;&#x62A4;&#x7684;&#x533A;&#x57DF;)</div><div class="line">protectionSpace : &#x53D7;&#x4FDD;&#x62A4;&#x533A;&#x57DF;</div><div class="line">NSURLAuthenticationMethodServerTrust : &#x8BC1;&#x4E66;&#x7684;&#x7C7B;&#x578B;&#x662F; &#x670D;&#x52A1;&#x5668;&#x4FE1;&#x4EFB;</div><div class="line">*/</div><div class="line">- (void)URLSession:(NSURLSession *)session didReceiveChallenge:(NSURLAuthenticationChallenge *)challenge completionHandler:(void (^)(NSURLSessionAuthChallengeDisposition, NSURLCredential *))completionHandler</div><div class="line">{</div><div class="line">//    NSLog(@&quot;didReceiveChallenge %@&quot;, challenge.protectionSpace);</div><div class="line">NSLog(@&quot;%@&quot;, challenge.protectionSpace.authenticationMethod);</div><div class="line">// 1.&#x5224;&#x65AD;&#x670D;&#x52A1;&#x5668;&#x8FD4;&#x56DE;&#x7684;&#x8BC1;&#x4E66;&#x7C7B;&#x578B;, &#x662F;&#x5426;&#x662F;&#x670D;&#x52A1;&#x5668;&#x4FE1;&#x4EFB;</div><div class="line">if ([challenge.protectionSpace.authenticationMethod isEqualToString:NSURLAuthenticationMethodServerTrust]) {</div><div class="line">NSLog(@&quot;&#x662F;&#x670D;&#x52A1;&#x5668;&#x4FE1;&#x4EFB;&#x7684;&#x8BC1;&#x4E66;&quot;);</div><div class="line">/*</div><div class="line">NSURLSessionAuthChallengeUseCredential = 0,                     &#x4F7F;&#x7528;&#x8BC1;&#x4E66;</div><div class="line">NSURLSessionAuthChallengePerformDefaultHandling = 1,            &#x5FFD;&#x7565;&#x8BC1;&#x4E66;(&#x9ED8;&#x8BA4;&#x7684;&#x5904;&#x7406;&#x65B9;&#x5F0F;)</div><div class="line">NSURLSessionAuthChallengeCancelAuthenticationChallenge = 2,     &#x5FFD;&#x7565;&#x4E66;&#x8BC1;, &#x5E76;&#x53D6;&#x6D88;&#x8FD9;&#x6B21;&#x8BF7;&#x6C42;</div><div class="line">NSURLSessionAuthChallengeRejectProtectionSpace = 3,            &#x5FFD;&#x7565;&#x5F53;&#x524D;&#x8FD9;&#x4E00;&#x6B21;, &#x4E0B;&#x4E00;&#x6B21;&#x518D;&#x8BE2;&#x95EE;</div><div class="line">*/</div><div class="line">NSURLCredential *credential = [NSURLCredential credentialForTrust:challenge.protectionSpace.serverTrust];</div><div class="line">completionHandler(NSURLSessionAuthChallengeUseCredential , credential);</div><div class="line">}</div><div class="line">}</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/10/网络环境监听-Reachability/" itemprop="url">
                  网络环境监听(Reachability)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2016-07-10T08:19:23+08:00" content="2016-07-10">
              2016-07-10
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/10/网络环境监听-Reachability/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/10/网络环境监听-Reachability/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>&#x6CA1;&#x4E8B;&#x770B;&#x770B;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#x73AF;&#x5883;&#x76D1;&#x542C;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x5F85;&#x4F1A;&#x8FD8;&#x8981;&#x53BB;&#x5B66;&#x82F1;&#x8BED;&#x5462;</li>
<li>&#x6211;&#x770B;&#x7684;&#x8FD9;&#x4E2A;&#x662F;&#x5C5E;&#x4E8E;ASI&#x6846;&#x67B6;&#x7684;</li>
<li>&#x5927;&#x6982;&#x770B;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x6700;&#x6838;&#x5FC3;&#x7684;&#x5224;&#x65AD;&#x7F51;&#x7EDC;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x8FD9;&#x4E2A;</li>
<li>SCNetworkReachabilityGetFlags</li>
<li>&#x8FD9;&#x4E2A;c&#x51FD;&#x6570;&#x83B7;&#x53D6;&#x5230;&#x5404;&#x79CD;flag&#xFF0C;&#x5B83;&#x662F;&#x7CFB;&#x7EDF;SystemConfiguration&#x6846;&#x67B6;&#x91CC;SCNetworkReachability.h&#x91CC;&#x7684;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;</li>
<li><p>&#x770B;&#x5B83;&#x7684;&#x4ECB;&#x7ECD;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">/*!</div><div class="line">@function SCNetworkReachabilityGetFlags</div><div class="line">@discussion Determines if the given target is reachable using the</div><div class="line">current network configuration.</div><div class="line">@param target The network reference associated with the address or name</div><div class="line">to be checked for reachability.</div><div class="line">@param flags A pointer to memory that will be filled with the</div><div class="line">SCNetworkReachabilityFlags detailing the reachability</div><div class="line">of the specified target.</div><div class="line">@result Returns TRUE if the network connection flags are valid;</div><div class="line">FALSE if the status could not be determined.</div><div class="line">*/</div></pre></td></tr></table></figure>
</li>
<li><p>&#x5927;&#x6982;&#x610F;&#x601D;&#x5C31;&#x662F;&#x6839;&#x636E;&#x4F20;&#x5165;&#x7684;target&#xFF08;SCNetworkReachabilityRef&#xFF09;&#x6765;&#x5F97;&#x5230;&#x5F53;&#x524D;&#x7F51;&#x7EDC;&#x72B6;&#x6001;</p>
</li>
<li><p>&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x770B;&#x5F97;&#x5230;&#x7684;flag&#x5206;&#x522B;&#x600E;&#x4E48;&#x5904;&#x7406;</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">- (NetworkStatus)networkStatusNewForFlags:(<span class="built_in">SCNetworkReachabilityFlags</span>)flags</div><div class="line"></div><div class="line">{</div><div class="line"></div><div class="line"><span class="keyword">if</span> ((flags &amp; kSCNetworkReachabilityFlagsReachable) == <span class="number">0</span>)</div><div class="line"></div><div class="line">{</div><div class="line"></div><div class="line"><span class="keyword">return</span> NotReachable;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line">NetworkStatus retVal = NotReachable;</div><div class="line"></div><div class="line"><span class="keyword">if</span> ((flags &amp; kSCNetworkReachabilityFlagsConnectionRequired) == <span class="number">0</span>)</div><div class="line"></div><div class="line">{</div><div class="line"></div><div class="line"><span class="comment">// if target host is reachable and no connection is required</span></div><div class="line"></div><div class="line"><span class="comment">//  then we&apos;ll assume (for now) that your on Wi-Fi</span></div><div class="line"></div><div class="line">retVal = ReachableViaWiFi;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">if</span> ((((flags &amp; kSCNetworkReachabilityFlagsConnectionOnDemand ) != <span class="number">0</span>) ||</div><div class="line"></div><div class="line">(flags &amp; kSCNetworkReachabilityFlagsConnectionOnTraffic) != <span class="number">0</span>))</div><div class="line"></div><div class="line">{</div><div class="line"></div><div class="line"><span class="comment">// ... and the connection is on-demand (or on-traffic) if the</span></div><div class="line"></div><div class="line"><span class="comment">//     calling application is using the CFSocketStream or higher APIs</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> ((flags &amp; kSCNetworkReachabilityFlagsInterventionRequired) == <span class="number">0</span>)</div><div class="line"></div><div class="line">{</div><div class="line"></div><div class="line"><span class="comment">// ... and no [user] intervention is needed</span></div><div class="line"></div><div class="line">retVal = ReachableViaWiFi;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> ((flags &amp; kSCNetworkReachabilityFlagsIsWWAN) == kSCNetworkReachabilityFlagsIsWWAN)</div><div class="line"></div><div class="line">{</div><div class="line"></div><div class="line"><span class="keyword">if</span> ([[[<span class="built_in">UIDevice</span> currentDevice] systemVersion] floatValue] &gt;= <span class="number">7.0</span>)</div><div class="line">{</div><div class="line"><span class="built_in">CTTelephonyNetworkInfo</span> *info = [[<span class="built_in">CTTelephonyNetworkInfo</span> alloc] init];</div><div class="line"><span class="built_in">NSString</span> *currentRadioAccessTechnology = info.currentRadioAccessTechnology;</div><div class="line"><span class="keyword">if</span> (currentRadioAccessTechnology) {</div><div class="line"><span class="keyword">if</span> ([currentRadioAccessTechnology isEqualToString:<span class="built_in">CTRadioAccessTechnologyLTE</span>]) {</div><div class="line"><span class="keyword">return</span> kReachableVia4G;</div><div class="line">} <span class="keyword">else</span> <span class="keyword">if</span> ([currentRadioAccessTechnology isEqualToString:<span class="built_in">CTRadioAccessTechnologyEdge</span>] || [currentRadioAccessTechnology isEqualToString:<span class="built_in">CTRadioAccessTechnologyGPRS</span>]) {</div><div class="line"><span class="keyword">return</span> kReachableVia2G;</div><div class="line">} <span class="keyword">else</span> {</div><div class="line"><span class="keyword">return</span> kReachableVia3G;</div><div class="line">}</div><div class="line">}</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">if</span> ((flags &amp; kSCNetworkReachabilityFlagsTransientConnection) == kSCNetworkReachabilityFlagsTransientConnection) {</div><div class="line"><span class="keyword">if</span>((flags &amp; kSCNetworkReachabilityFlagsConnectionRequired) == kSCNetworkReachabilityFlagsConnectionRequired) {</div><div class="line"><span class="keyword">return</span> kReachableVia2G;</div><div class="line">}</div><div class="line"><span class="keyword">return</span> kReachableVia3G;</div><div class="line">}</div><div class="line"><span class="keyword">return</span> kReachableViaWWAN;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">return</span> retVal;</div><div class="line"></div><div class="line">}</div></pre></td></tr></table></figure>
</li>
<li><p>&#x4E0A;&#x9762;&#x8FD9;&#x91CC;&#x5C06;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x4E00;&#x4E2A;&#x751F;&#x4EA7;flag&#x7684;&#x4E1C;&#x897F;&#x5F53;&#x505A;&#x53C2;&#x6570;&#x4F20;&#x4E86;&#x8FDB;&#x53BB;</p>
</li>
<li>&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x5229;&#x7528;runloop&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x7684;&#x73AF;&#x5883;&#x76D1;&#x542C;</li>
<li>&#x5F53;&#x6709;&#x53D8;&#x52A8;&#x65F6;&#xFF0C;&#x5219;&#x4F1A;&#x8C03;&#x7528;ReachabilityCallback&#x51FD;&#x6570;</li>
<li><p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4E5F;&#x662F;&#x6709;&#x8BB2;&#x7A76;&#x7684;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">/*!</div><div class="line">@typedef SCNetworkReachabilityCallBack</div><div class="line">@discussion Type of the callback function used when the</div><div class="line">reachability of a network address or name changes.</div><div class="line">@param target The SCNetworkReachability reference being monitored</div><div class="line">for changes.</div><div class="line">@param flags The new SCNetworkReachabilityFlags representing the</div><div class="line">reachability status of the network address/name.</div><div class="line">@param info A C pointer to a user-specified block of data.</div><div class="line">*/</div><div class="line">typedef void (*SCNetworkReachabilityCallBack)	(</div><div class="line">SCNetworkReachabilityRef			target,</div><div class="line">SCNetworkReachabilityFlags			flags,</div><div class="line">void			     *	__nullable	info</div><div class="line">);</div></pre></td></tr></table></figure>
</li>
<li><p>&#x770B;&#x5B83;&#x8BF4;&#x660E;</p>
<blockquote>
<p>the callback function used when the reachability of a network address or name changes</p>
</blockquote>
</li>
<li><p>&#x4E3A;&#x7F51;&#x7EDC;&#x6539;&#x53D8;&#x800C;&#x751F;&#x7684;&#x56DE;&#x8C03;&#xFF0C;&#x54C8;&#x54C8;</p>
</li>
<li><p>&#x518D;&#x6765;&#x770B;&#x770B;&#x8FD9;&#x4E2A;&#x8BBE;&#x7F6E;callback&#x7684;&#x65B9;&#x6CD5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">SCNetworkReachabilitySetCallback</div><div class="line"></div><div class="line">/////////////</div><div class="line">/*!</div><div class="line">@function SCNetworkReachabilitySetCallback</div><div class="line">@discussion Assigns a client to a target, which receives callbacks</div><div class="line">when the reachability of the target changes.</div><div class="line">@param target The network reference associated with the address or</div><div class="line">name to be checked for reachability.</div><div class="line">@param callout The function to be called when the reachability of the</div><div class="line">target changes.  If NULL, the current client for the target</div><div class="line">is removed.</div><div class="line">@param context The SCNetworkReachabilityContext associated with</div><div class="line">the callout.  The value may be NULL.</div><div class="line">@result Returns TRUE if the notification client was successfully set.</div><div class="line">*/</div><div class="line">Boolean</div><div class="line">SCNetworkReachabilitySetCallback		(</div><div class="line">SCNetworkReachabilityRef			target,</div><div class="line">SCNetworkReachabilityCallBack	__nullable	callout,</div><div class="line">SCNetworkReachabilityContext	* __nullable	context</div><div class="line">)				__OSX_AVAILABLE_STARTING(__MAC_10_3,__IPHONE_2_0);</div></pre></td></tr></table></figure>
</li>
<li><p>&#x6240;&#x4EE5;&#xFF0C;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x5199;&#x4E2A;&#x7F51;&#x7EDC;&#x73AF;&#x5883;&#x76D1;&#x542C;&#xFF0C;&#x77E5;&#x9053;&#x7CFB;&#x7EDF;&#x65B9;&#x6CD5;&#x5E72;&#x5565;&#x7684;&#x5C31;&#x884C;&#x4E86;</p>
</li>
<li><p>&#x6700;&#x540E;&#x522B;&#x5FD8;&#x4E86;&#x91CA;&#x653E;&#x76D1;&#x542C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (void)stopNotifier</div><div class="line">{</div><div class="line">if (_reachabilityRef != NULL)</div><div class="line">{</div><div class="line">SCNetworkReachabilityUnscheduleFromRunLoop(_reachabilityRef, CFRunLoopGetCurrent(), kCFRunLoopDefaultMode);</div><div class="line">}</div><div class="line">}</div></pre></td></tr></table></figure>
</li>
<li><p>&#x7EC6;&#x770B;&#x5C31;&#x53EF;&#x4EE5;&#x5927;&#x6982;&#x4E86;&#x89E3;&#x8FD9;&#x4E9B;flag&#x662F;&#x600E;&#x4E48;&#x8FD0;&#x4F5C;&#x7684;</p>
</li>
<li>&#x63A5;&#x4E0B;&#x6765;&#x770B;&#x770B;&#x662F;&#x5982;&#x4F55;&#x505A;&#x5230;&#x5B9E;&#x65F6;&#x7684;&#x7F51;&#x7EDC;&#x73AF;&#x5883;&#x76D1;&#x542C;&#x7684;<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (BOOL)startNotifier</div><div class="line">{</div><div class="line">BOOL returnValue = NO;</div><div class="line">SCNetworkReachabilityContext context = {0, (__bridge void *)(self), NULL, NULL, NULL};</div><div class="line"></div><div class="line">if (SCNetworkReachabilitySetCallback(_reachabilityRef, ReachabilityCallback, &amp;context))</div><div class="line">{</div><div class="line">if (SCNetworkReachabilityScheduleWithRunLoop(_reachabilityRef, CFRunLoopGetCurrent(), kCFRunLoopDefaultMode))</div><div class="line">{</div><div class="line">returnValue = YES;</div><div class="line">}</div><div class="line">}</div><div class="line"></div><div class="line">return returnValue;</div><div class="line">}</div></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<ul>
<li>&#x8FD9;&#x91CC;&#x9644;&#x4E0A;&#x4E00;&#x4E2A;&#x76D1;&#x6D4B;ipv6&#x7684;&#x4E1C;&#x897F;</li>
<li><p>&#x8FD9;&#x91CC;&#x5148;&#x8D34;&#x4E0A;&#x4E24;&#x4E2A;&#x5DE5;&#x5177;&#x65B9;&#x6CD5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">*	@brief	&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;IPv4&#x5730;&#x5740;</div><div class="line">*</div><div class="line">*	@return</div><div class="line">*/</div><div class="line">- (BOOL)isIPv4Address:(NSString *)addr {</div><div class="line"></div><div class="line">if (addr == nil) {</div><div class="line">return NO;</div><div class="line">}</div><div class="line">const char *utf8 = [addr UTF8String];</div><div class="line">// Check valid IPv4.</div><div class="line">struct in_addr dst;</div><div class="line">int success = inet_pton(AF_INET, utf8, &amp;(dst.s_addr));</div><div class="line">return success == 1;</div><div class="line">}</div><div class="line"></div><div class="line">/**</div><div class="line">*	@brief	&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;IPv6&#x5730;&#x5740;</div><div class="line">*</div><div class="line">*	@return</div><div class="line">*/</div><div class="line">- (BOOL)isIPv6Address:(NSString *)addr {</div><div class="line">if (addr == nil) {</div><div class="line">return NO;</div><div class="line">}</div><div class="line">const char *utf8 = [addr UTF8String];</div><div class="line">// Check valid IPv6.</div><div class="line">struct in6_addr dst6;</div><div class="line">int success = inet_pton(AF_INET6, utf8, &amp;dst6);</div><div class="line">return (success == 1);</div><div class="line">}</div></pre></td></tr></table></figure>
</li>
<li><p>&#x7136;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x903B;&#x8F91;&#x8FD0;&#x7B97;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">dnsIPStack = IPLocalIPStack_IPv4 | IPLocalIPStack_IPv6;</div><div class="line">dnsIPStack &amp;= [self getDNSServersIpStack];</div><div class="line"></div><div class="line">if (dnsIPStack &amp; IPLocalIPStack_IPv4) {</div><div class="line">// support IPv4</div><div class="line">isIPv6Only = NO;</div><div class="line">} else if (dnsIPStack &amp; IPLocalIPStack_IPv6) {</div><div class="line">// IPv6-Only</div><div class="line">isIPv6Only = YES;</div><div class="line">[[OSSIPv6PrefixResolver getInstance] updateIPv6Prefix];</div><div class="line">} else {</div><div class="line">KGIPv6Log(@&quot;[%s]: Error.&quot;, __FUNCTION__);</div><div class="line">isIPv6Only = NO;</div><div class="line">}</div></pre></td></tr></table></figure>
</li>
<li><p>&#x5176;&#x4E2D;&#x5982;&#x679C;&#x662F;ipv6&#x6211;&#x4EEC;&#x5C31;&#x8981;&#x505A;&#x4E9B;&#x4E8B;&#x60C5;&#x4E86;&#xFF0C;&#x4E0D;&#x8FC7;&#x5148;&#x8D34;&#x4E0A;&#x5B8C;&#x6574;&#x4EE3;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">- (BOOL)isIPv6OnlyNetwork {</div><div class="line">@synchronized(self) {</div><div class="line">if (isIPv6OnlyResolved) {</div><div class="line">return isIPv6Only;</div><div class="line">}</div><div class="line"></div><div class="line">struct in6_addr addr6_gateway = {0};</div><div class="line">if (0 != getdefaultgateway6(&amp;addr6_gateway) || IN6_IS_ADDR_UNSPECIFIED(&amp;addr6_gateway)) {</div><div class="line">isIPv6Only = NO;</div><div class="line">return isIPv6Only;</div><div class="line">}</div><div class="line"></div><div class="line">struct in_addr addr_gateway = {0};</div><div class="line">if (0 != getdefaultgateway4(&amp;addr_gateway)) {</div><div class="line">isIPv6Only = YES;</div><div class="line">[[OSSIPv6PrefixResolver getInstance] updateIPv6Prefix];</div><div class="line">return isIPv6Only;</div><div class="line">}</div><div class="line">if (INADDR_NONE == addr_gateway.s_addr</div><div class="line">|| INADDR_ANY == addr_gateway.s_addr ) {</div><div class="line">isIPv6Only = YES;</div><div class="line">[[OSSIPv6PrefixResolver getInstance] updateIPv6Prefix];</div><div class="line">return isIPv6Only;</div><div class="line">}</div><div class="line"></div><div class="line">int haveIPv4 = _have_ipv4();</div><div class="line">int haveIPv6 = _have_ipv6();</div><div class="line">int local_stack = 0;</div><div class="line">if (haveIPv4) { local_stack |= IPLocalIPStack_IPv4; }</div><div class="line">if (haveIPv6) { local_stack |= IPLocalIPStack_IPv6; }</div><div class="line"></div><div class="line">if (IPLocalIPStack_IPv4 == local_stack) {</div><div class="line">isIPv6Only = NO;</div><div class="line">return isIPv6Only;</div><div class="line">} else if (IPLocalIPStack_IPv6 == local_stack) {</div><div class="line">isIPv6Only = YES;</div><div class="line">[[OSSIPv6PrefixResolver getInstance] updateIPv6Prefix];</div><div class="line">return isIPv6Only;</div><div class="line">}</div><div class="line"></div><div class="line">KGIPv6Log(@&quot;Start resolved network to see if in IPv6-Only env.&quot;);</div><div class="line">int dnsIPStack = 0;</div><div class="line"></div><div class="line">dnsIPStack = IPLocalIPStack_IPv4 | IPLocalIPStack_IPv6;</div><div class="line">dnsIPStack &amp;= [self getDNSServersIpStack];</div><div class="line"></div><div class="line">if (dnsIPStack &amp; IPLocalIPStack_IPv4) {</div><div class="line">// support IPv4</div><div class="line">isIPv6Only = NO;</div><div class="line">} else if (dnsIPStack &amp; IPLocalIPStack_IPv6) {</div><div class="line">// IPv6-Only</div><div class="line">isIPv6Only = YES;</div><div class="line">[[OSSIPv6PrefixResolver getInstance] updateIPv6Prefix];</div><div class="line">} else {</div><div class="line">KGIPv6Log(@&quot;[%s]: Error.&quot;, __FUNCTION__);</div><div class="line">isIPv6Only = NO;</div><div class="line">}</div><div class="line">isIPv6OnlyResolved = YES;</div><div class="line">if (isIPv6Only) {</div><div class="line">KGIPv6Log(@&quot;[%s]: IPv6-Only network now.&quot;, __FUNCTION__);</div><div class="line">} else {</div><div class="line">KGIPv6Log(@&quot;[%s]: Not IPv6-Only network now.&quot;, __FUNCTION__);</div><div class="line">}</div><div class="line">return isIPv6Only;</div><div class="line">}</div><div class="line">}</div></pre></td></tr></table></figure>
</li>
<li><p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x770B;&#x4E00;&#x4E0B;&#x662F;&#x5982;&#x4F55;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x7F51;&#x7EDC;&#x662F;&#x5426;&#x4E3A;ipv6only&#x7684;</p>
</li>
<li><p>&#x7B54;&#x6848;&#x662F;&#x67E5;&#x8BE2;&#x672C;&#x673A;DNS Servers&#x534F;&#x8BAE;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">- (int)getDNSServersIpStack {</div><div class="line">int dns_stack = 0;</div><div class="line">res_state res = malloc(sizeof(struct __res_state));</div><div class="line">int result = res_ninit(res);</div><div class="line">if (result == 0) {</div><div class="line">union res_9_sockaddr_union *addr_union = malloc(res-&gt;nscount * sizeof(union res_9_sockaddr_union));</div><div class="line">res_getservers(res, addr_union, res-&gt;nscount);</div><div class="line">for (int i = 0; i &lt; res-&gt;nscount; i++) {</div><div class="line">if (addr_union[i].sin.sin_family == AF_INET) {</div><div class="line">char ip[INET_ADDRSTRLEN];</div><div class="line">if (inet_ntop(AF_INET, &amp;(addr_union[i].sin.sin_addr), ip, INET_ADDRSTRLEN)) {</div><div class="line">dns_stack |= IPLocalIPStack_IPv4;</div><div class="line">}</div><div class="line">} else if (addr_union[i].sin6.sin6_family == AF_INET6) {</div><div class="line">char ip[INET6_ADDRSTRLEN];</div><div class="line">if (inet_ntop(AF_INET6, &amp;(addr_union[i].sin6.sin6_addr), ip, INET6_ADDRSTRLEN)) {</div><div class="line">dns_stack |= IPLocalIPStack_IPv6;</div><div class="line">}</div><div class="line">} else {</div><div class="line">KGIPv6Log(@&quot;%s: Undefined family.&quot;, __FUNCTION__);</div><div class="line">}</div><div class="line">}</div><div class="line">}</div><div class="line">res_nclose(res);</div><div class="line">return dns_stack;</div><div class="line">}</div></pre></td></tr></table></figure>
</li>
<li><p>&#x6211;&#x4EEC;&#x770B;&#x770B;&#x8FD9;&#x4E2A;OSSIPv6PrefixResolver&#x662F;&#x5982;&#x4F55;&#x89E3;&#x51B3;ipv6&#x95EE;&#x9898;&#x7684;</p>
</li>
<li><p>&#x76F4;&#x63A5;&#x5C31;&#x662F;&#x4E0B;&#x9762;&#x7684;&#x8F6C;&#x6362;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD8;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x89E3;&#x51B3;prefix&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4EE3;&#x7801;&#x4E0B;&#x9762;&#x9644;&#x4E0A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">if (([[KGIPv6Adapater sharedInstance] isIPv6OnlyNetwork]</div><div class="line">&amp;&amp; [[UIDevice currentDevice].systemVersion floatValue] &lt; 9.0)) {</div><div class="line">NSURL *tempURL = [NSURL URLWithString:domainURLString];</div><div class="line">if ([[KGIPv6Adapater sharedInstance] isIPv4Address:tempURL.host]) {</div><div class="line">NSString *tempIPv6String = [[KGIPv6Adapater sharedInstance] handleIpv4Address:tempURL.host];</div><div class="line">domainURLString = [domainURLString stringByReplacingOccurrencesOfString:tempURL.host</div><div class="line">withString:tempIPv6String];</div><div class="line">}</div><div class="line">}</div></pre></td></tr></table></figure>
</li>
<li><p>&#x67E5;&#x770B;&#x5F53;&#x524D;&#x662F;&#x5426;&#x53EA;&#x5141;&#x8BB8;ipv6&#x7F51;&#x7EDC;&#xFF0C;&#x662F;&#x5219;&#x5C06;ipv4&#x8F6C;&#x6362;&#x6210;ipv6</p>
</li>
<li><p>&#x4E0B;&#x9762;&#x662F;&#x8F6C;&#x6362;&#x7B97;&#x6CD5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">- (NSString *)convertIPv4toIPv6:(NSString *)ipv4 {</div><div class="line">if ([ipv4 length] &lt;= 0) {</div><div class="line">return nil;</div><div class="line">}</div><div class="line"></div><div class="line">__uint8_t ipv6[16] = {0x00};</div><div class="line">__uint8_t length = [self resolveIPv6Prefix:ipv6];</div><div class="line"></div><div class="line">if (length &lt;= 0) {</div><div class="line">return nil;</div><div class="line">}</div><div class="line"></div><div class="line">in_addr_t addr_v4 = inet_addr([ipv4 UTF8String]);</div><div class="line"></div><div class="line">// &#x6309;length&#x7684;&#x4E0D;&#x540C;&#x60C5;&#x51B5;&#x8FDB;&#x884C;&#x5904;&#x7406;</div><div class="line">if (length==4 || length==12) { //32 bits or 96 bits</div><div class="line">ipv6[length+0] |= (__uint8_t)(addr_v4&gt;&gt;0 &amp; 0xff);</div><div class="line">ipv6[length+1] |= (__uint8_t)(addr_v4&gt;&gt;8 &amp; 0xff);</div><div class="line">ipv6[length+2] |= (__uint8_t)(addr_v4&gt;&gt;16 &amp; 0xff);</div><div class="line">ipv6[length+3] |= (__uint8_t)(addr_v4&gt;&gt;24 &amp; 0xff);</div><div class="line">}</div><div class="line">else if (length == 5) { //40 bits  :a.b.c.0.d</div><div class="line">ipv6[length+0] |= (__uint8_t)(addr_v4&gt;&gt;0 &amp; 0xff);</div><div class="line">ipv6[length+1] |= (__uint8_t)(addr_v4&gt;&gt;8 &amp; 0xff);</div><div class="line">ipv6[length+2] |= (__uint8_t)(addr_v4&gt;&gt;16 &amp; 0xff);</div><div class="line">ipv6[length+4] |= (__uint8_t)(addr_v4&gt;&gt;24 &amp; 0xff);</div><div class="line">}</div><div class="line">else if (length == 6) { //48 bits   :a.b.0.c.d</div><div class="line">ipv6[length+0] |= (__uint8_t)(addr_v4&gt;&gt;0 &amp; 0xff);</div><div class="line">ipv6[length+1] |= (__uint8_t)(addr_v4&gt;&gt;8 &amp; 0xff);</div><div class="line">ipv6[length+3] |= (__uint8_t)(addr_v4&gt;&gt;16 &amp; 0xff);</div><div class="line">ipv6[length+4] |= (__uint8_t)(addr_v4&gt;&gt;24 &amp; 0xff);</div><div class="line">}</div><div class="line">else if (length == 7) { //56 bits   :a.0.b.c.d</div><div class="line">ipv6[length+0] |= (__uint8_t)(addr_v4&gt;&gt;0 &amp; 0xff);</div><div class="line">ipv6[length+2] |= (__uint8_t)(addr_v4&gt;&gt;8 &amp; 0xff);</div><div class="line">ipv6[length+3] |= (__uint8_t)(addr_v4&gt;&gt;16 &amp; 0xff);</div><div class="line">ipv6[length+4] |= (__uint8_t)(addr_v4&gt;&gt;24 &amp; 0xff);</div><div class="line">}</div><div class="line">else if (length == 8) { //64 bits   :0.a.b.c.d</div><div class="line">ipv6[length+1] |= (__uint8_t)(addr_v4&gt;&gt;0 &amp; 0xff);</div><div class="line">ipv6[length+2] |= (__uint8_t)(addr_v4&gt;&gt;8 &amp; 0xff);</div><div class="line">ipv6[length+3] |= (__uint8_t)(addr_v4&gt;&gt;16 &amp; 0xff);</div><div class="line">ipv6[length+4] |= (__uint8_t)(addr_v4&gt;&gt;24 &amp; 0xff);</div><div class="line">}</div><div class="line"></div><div class="line">// &#x6784;&#x9020;IPv6&#x7684;&#x7ED3;&#x6784;</div><div class="line">char addr_text[ MAX(INET_ADDRSTRLEN, INET6_ADDRSTRLEN) ];</div><div class="line">if(inet_ntop(AF_INET6, ipv6, addr_text, INET6_ADDRSTRLEN)) {</div><div class="line">NSString *ret = [NSString stringWithUTF8String:addr_text];</div><div class="line">return ret;</div><div class="line">}</div><div class="line">return nil;</div><div class="line">}</div></pre></td></tr></table></figure>
</li>
<li><p>&#x89E3;&#x51B3;ipv6prefix&#x95EE;&#x9898;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- (__uint8_t)resolveIPv6Prefix:(__uint8_t *)prefix {</div><div class="line">if ( !prefix ) {</div><div class="line">return 0;</div><div class="line">}</div><div class="line">__uint8_t len = prefixLen;</div><div class="line">memcpy(prefix, ipv6Prefix, prefixLen);</div><div class="line">@synchronized(self) {</div><div class="line">if (ipv6PrefixResolveStatus==IPv6PrefixUnResolved ) {</div><div class="line">ipv6PrefixResolveStatus = IPv6PrefixResolving;</div><div class="line">dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{</div><div class="line">struct addrinfo hints, *addr;</div><div class="line">memset(&amp;hints, 0, sizeof(hints));</div><div class="line">hints.ai_family = PF_INET6;</div><div class="line">hints.ai_socktype = SOCK_STREAM;</div><div class="line">hints.ai_flags = AI_DEFAULT;</div><div class="line"></div><div class="line">if (0 != getaddrinfo(&quot;ipv4only.arpa&quot;, &quot;http&quot;, &amp;hints, &amp;addr)) {</div><div class="line">ipv6PrefixResolveStatus = IPv6PrefixUnResolved;</div><div class="line">return;</div><div class="line">}</div><div class="line"></div><div class="line">if (addr &amp;&amp; AF_INET6 == addr-&gt;ai_addr-&gt;sa_family) {</div><div class="line">struct sockaddr_in6 *addr6 = (struct sockaddr_in6 *)(addr-&gt;ai_addr);</div><div class="line">if ( !addr6 ) {</div><div class="line">ipv6PrefixResolveStatus = IPv6PrefixUnResolved;</div><div class="line">return;</div><div class="line">}</div><div class="line"></div><div class="line">__uint8_t* u8 = addr6-&gt;sin6_addr.__u6_addr.__u6_addr8;</div><div class="line">for (__uint8_t i=0; i &lt; V6_PREFIX_TABLE_SIZE; i++) {</div><div class="line">if ([self isIPv6Prefix:(__uint8_t *)V6_PREFIX_CONTENT_TABLE[i]</div><div class="line">withPrefixLen:V6_PREFIX_SIZE_TABLE[i]</div><div class="line">withIP:u8</div><div class="line">withIPLen:16]) {</div><div class="line"></div><div class="line">ipv6Prefix = (__uint8_t *)V6_PREFIX_CONTENT_TABLE[i];</div><div class="line">prefixLen = V6_PREFIX_SIZE_TABLE[i];</div><div class="line">ipv6PrefixResolveStatus = IPv6PrefixResolved;</div><div class="line">break;</div><div class="line">}</div><div class="line">}</div><div class="line">ipv6PrefixResolveStatus = IPv6PrefixUnResolved;</div><div class="line">}</div><div class="line"></div><div class="line">});</div><div class="line">}</div><div class="line">}</div><div class="line"></div><div class="line">return len;</div><div class="line">}</div></pre></td></tr></table></figure>
</li>
<li><p>ok&#xFF0C;&#x672C;&#x671F;&#x8BB2;&#x5EA7;&#x5230;&#x6B64;&#x7ED3;&#x675F;</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/17/二维码扫描、更新与创建/" itemprop="url">
                  二维码扫描、更新与创建
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2015-10-17T00:53:38+08:00" content="2015-10-17">
              2015-10-17
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/10/17/二维码扫描、更新与创建/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/17/二维码扫描、更新与创建/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>&#x4E8C;&#x7EF4;&#x7801;&#x9700;&#x8981;&#x7528;&#x5230;&#x5E93;<strong>AVFoundation</strong></li>
<li><p>&#x5BFC;&#x5165;&#x5E93;&#x5B8C;&#x6BD5;&#x540E;&#xFF0C;&#x6309;&#x7167;&#x4E0B;&#x9762;&#x51E0;&#x4E2A;&#x6B65;&#x9AA4;&#x6765;&#x505A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">/// 1.&#x521B;&#x5EFA;&#x8F93;&#x5165;</div><div class="line">    private lazy var inputDevice: AVCaptureDeviceInput? =</div><div class="line">    {</div><div class="line">       let device = AVCaptureDevice.defaultDeviceWithMediaType(AVMediaTypeVideo)</div><div class="line">        do{</div><div class="line">            let input = try AVCaptureDeviceInput(device: device)</div><div class="line">            return input</div><div class="line">        }catch</div><div class="line">        {</div><div class="line">            return nil</div><div class="line">        }</div><div class="line">    }()</div><div class="line">    /// 2.&#x521B;&#x5EFA;&#x8F93;&#x51FA;</div><div class="line">    private lazy var output: AVCaptureMetadataOutput = {</div><div class="line">       let output = AVCaptureMetadataOutput()</div><div class="line">        return output</div><div class="line">    }()</div><div class="line">    /// 3.&#x521B;&#x5EFA;&#x4F1A;&#x8BDD;</div><div class="line">    private lazy var session: AVCaptureSession = {</div><div class="line">        let s = AVCaptureSession()</div><div class="line">        s.sessionPreset = &quot;AVCaptureSessionPreset1920x1080&quot;</div><div class="line">        return s</div><div class="line">    }()</div><div class="line">    /// 4.&#x521B;&#x5EFA;&#x9884;&#x89C8;&#x56FE;&#x5C42;</div><div class="line">    private lazy var previewLayer: AVCaptureVideoPreviewLayer = {</div><div class="line">       let layer = AVCaptureVideoPreviewLayer(session: self.session)</div><div class="line">        layer.frame = UIScreen.mainScreen().bounds</div><div class="line">        return layer</div><div class="line">    }()</div></pre></td></tr></table></figure>
</li>
<li><p>&#x4EE3;&#x7406;&#x6355;&#x6349;&#x626B;&#x63CF;&#x4FE1;&#x606F;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">extension QRCodeViewController: AVCaptureMetadataOutputObjectsDelegate</div><div class="line"></div><div class="line">{</div><div class="line">    func captureOutput(captureOutput: AVCaptureOutput!, didOutputMetadataObjects metadataObjects: [AnyObject]!, fromConnection connection: AVCaptureConnection!)</div><div class="line">    {</div><div class="line">        NJLog(metadataObjects.last?.stringValue)</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>
</li>
<li><p>&#x542F;&#x52A8;&#x626B;&#x63CF;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">private func startScanQRCode()</div><div class="line">    {</div><div class="line">        // 1.&#x5224;&#x65AD;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x8F93;&#x5165;&#x8BBE;&#x5907;</div><div class="line">        if !session.canAddInput(inputDevice)</div><div class="line">        {</div><div class="line">            return</div><div class="line">        }</div><div class="line">        // 2.&#x5224;&#x65AD;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x8F93;&#x51FA;&#x5BF9;&#x8C61;</div><div class="line">        if !session.canAddOutput(output)</div><div class="line">        {</div><div class="line">            return</div><div class="line">        }</div><div class="line">        // 3.&#x6DFB;&#x52A0;&#x8F93;&#x5165;&#x548C;&#x8F93;&#x51FA;&#x5230;&#x4F1A;&#x8BDD;&#x4E2D;</div><div class="line">        session.addInput(inputDevice)</div><div class="line">        session.addOutput(output)</div><div class="line">        // 4.&#x8BBE;&#x7F6E;&#x8F93;&#x51FA;&#x89E3;&#x6790;&#x6570;&#x636E;&#x7C7B;&#x578B;</div><div class="line">        // &#x5FC5;&#x987B;&#x5728;&#x8F93;&#x51FA;&#x5BF9;&#x8C61;&#x6DFB;&#x52A0;&#x5230;&#x4F1A;&#x8BDD;&#x4E4B;&#x540E;&#x624D;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;, &#x5426;&#x5219;&#x4F1A;&#x62A5;&#x9519;</div><div class="line">        output.metadataObjectTypes = output.availableMetadataObjectTypes</div><div class="line">        // 5.&#x8BBE;&#x7F6E;&#x8F93;&#x51FA;&#x4EE3;&#x7406;, &#x76D1;&#x542C;&#x89E3;&#x6790;&#x5230;&#x5F97;&#x7ED3;&#x679C;</div><div class="line">        output.setMetadataObjectsDelegate(self, queue: dispatch_get_main_queue())</div><div class="line">        </div><div class="line">        // 6.&#x6DFB;&#x52A0;&#x9884;&#x89C8;&#x56FE;&#x5C42;</div><div class="line">        view.layer.insertSublayer(previewLayer, atIndex: 0)</div><div class="line">		// &#x5C06;&#x7ED8;&#x5236;&#x8FB9;&#x6846;&#x56FE;&#x5C42;&#x6DFB;&#x52A0;&#x5230;&#x9884;&#x89C8;&#x56FE;&#x5C42;&#x4E0A;        previewLayer.addSublayer(drawLayer)</div><div class="line">        // 6.&#x5229;&#x7528;&#x4F1A;&#x8BDD;&#x5F00;&#x59CB;&#x626B;&#x63CF;</div><div class="line">        session.startRunning()</div><div class="line">    }</div></pre></td></tr></table></figure>
</li>
<li><p>&#x8BBE;&#x7F6E;&#x611F;&#x5174;&#x8DA3;&#x8303;&#x56F4;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/// 2.&#x521B;&#x5EFA;&#x8F93;&#x51FA;</div><div class="line">    private lazy var output: AVCaptureMetadataOutput = {</div><div class="line">       let output = AVCaptureMetadataOutput()</div><div class="line">        // &#x8BBE;&#x7F6E;&#x5174;&#x8DA3;&#x70B9;(&#x611F;&#x5174;&#x8DA3;&#x8303;&#x56F4;), &#x9ED8;&#x8BA4;&#x662F;&#x5168;&#x5C4F;</div><div class="line">        // &#x6CE8;&#x610F;: &#x662F;&#x4EE5;&#x6A2A;&#x5C4F;&#x7684;&#x5DE6;&#x4E0A;&#x89D2;&#x4E3A;&#x53C2;&#x7167;</div><div class="line">//        output.rectOfInterest = CGRect(x: 0, y: 0, width: 0.5, height: 0.5)</div><div class="line">        let frame = self.containerView.frame</div><div class="line">        let size = self.view.frame.size</div><div class="line">        // &#x7531;&#x4E8E;&#x662F;&#x6309;&#x7167;&#x6A2A;&#x5C4F;&#x6765;&#x8BA1;&#x7B97;&#x7684;, &#x6240;&#x4EE5;&#x9700;&#x8981;&#x5C06;x&#x53D8;&#x4E3A;y, y&#x53D8;&#x4E3A;x, &#x5C06;&#x5BBD;&#x53D8;&#x4E3A;&#x9AD8;, &#x9AD8;&#x53D8;&#x4E3A;&#x5BBD;</div><div class="line">        output.rectOfInterest = CGRect(x: frame.origin.y / size.height, y: frame.origin.x / size.width, width: frame.size.height / size.height, height: frame.size.width / size.width)</div><div class="line">        </div><div class="line">        return output</div><div class="line">    }()</div></pre></td></tr></table></figure>
</li>
<li><p>&#x63CF;&#x7ED8;&#x8FB9;&#x6846;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">func captureOutput(captureOutput: AVCaptureOutput!, didOutputMetadataObjects metadataObjects: [AnyObject]!, fromConnection connection: AVCaptureConnection!)</div><div class="line">{</div><div class="line">    // 0. &#x79FB;&#x9664;&#x4EE5;&#x524D;&#x7684;&#x63CF;&#x8FB9;</div><div class="line">    clearCorners()</div><div class="line"></div><div class="line">    </div><div class="line">    for objc in metadataObjects</div><div class="line">    {</div><div class="line">        // 1.&#x5C06;&#x626B;&#x63CF;&#x5230;&#x4E8C;&#x7EF4;&#x7801;&#x7684;&#x5750;&#x6807;&#x8F6C;&#x6362;&#x4E3A;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x8BC6;&#x522B;&#x7684;&#x5750;&#x6807;</div><div class="line">       let codeObjc =  previewLayer.transformedMetadataObjectForMetadataObject(objc as! AVMetadataObject)</div><div class="line"></div><div class="line">        // 2.&#x6839;&#x636E;&#x8F6C;&#x6362;&#x597D;&#x7684;&#x5750;&#x6807;&#x7ED8;&#x5236;&#x4E8C;&#x7EF4;&#x7801;&#x63CF;&#x8FB9;</div><div class="line">        drawCorners(codeObjc as! AVMetadataMachineReadableCodeObject)</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line">///&#x7ED8;&#x5236;&#x4E8C;&#x7EF4;&#x7801;&#x63CF;&#x8FB9;</div><div class="line">private func drawCorners(codeObjc: AVMetadataMachineReadableCodeObject)</div><div class="line">{</div><div class="line">    if codeObjc.corners == nil || codeObjc.corners.count == 0</div><div class="line">    {</div><div class="line">        return</div><div class="line">    }</div><div class="line">    </div><div class="line">    // 1.&#x7ED8;&#x5236;&#x8DEF;&#x5F84;</div><div class="line">    let subLayer = CAShapeLayer()</div><div class="line">    subLayer.lineWidth = 4</div><div class="line">    subLayer.strokeColor = UIColor.redColor().CGColor</div><div class="line">    subLayer.fillColor = UIColor.clearColor().CGColor</div><div class="line">    </div><div class="line">    // 2.&#x4ECE;&#x4F20;&#x5165;&#x5BF9;&#x8C61;&#x4E2D;&#x83B7;&#x53D6;4&#x4E2A;&#x70B9;, &#x521B;&#x5EFA;Path</div><div class="line">    let path = UIBezierPath()</div><div class="line">    var point = CGPointZero</div><div class="line">    var index = 0</div><div class="line">    let dictArr = codeObjc.corners</div><div class="line">    // 2.1&#x53D6;&#x51FA;&#x7B2C;0&#x4E2A;&#x70B9;</div><div class="line">    // &#x5C06;&#x5B57;&#x5178;&#x4E2D;&#x7684;xy&#x8F6C;&#x6362;&#x4E3A;CGPoint</div><div class="line">    CGPointMakeWithDictionaryRepresentation(dictArr[index++] as! CFDictionaryRef, &amp;point)</div><div class="line">    // 2.2&#x79FB;&#x52A8;&#x5230;&#x7B2C;0&#x4E2A;&#x70B9;</div><div class="line">    path.moveToPoint(point)</div><div class="line">    </div><div class="line">    // 2.3&#x6DFB;&#x52A0;&#x5176;&#x5B83;&#x7684;&#x70B9;</div><div class="line">    while index &lt; dictArr.count</div><div class="line">    {</div><div class="line">        CGPointMakeWithDictionaryRepresentation(dictArr[index++] as! CFDictionaryRef, &amp;point)</div><div class="line">        path.addLineToPoint(point)</div><div class="line">    }</div><div class="line">    </div><div class="line">    // 2.4&#x5173;&#x95ED;&#x8DEF;&#x5F84;</div><div class="line">    path.closePath()</div><div class="line">    </div><div class="line">    subLayer.path = path.CGPath</div><div class="line">    </div><div class="line">    // 3.&#x5C06;layer&#x6DFB;&#x52A0;&#x5230;drawLayer&#x4E0A;</div><div class="line">    drawLayer.addSublayer(subLayer)</div><div class="line">}</div><div class="line"></div><div class="line">/// &#x79FB;&#x9664;&#x4EE5;&#x524D;&#x7684;&#x63CF;&#x8FB9;</div><div class="line">private func clearCorners()</div><div class="line">{</div><div class="line">    if drawLayer.sublayers == nil || drawLayer.sublayers?.count == 0</div><div class="line">    {</div><div class="line">        return</div><div class="line">    }</div><div class="line">    </div><div class="line">    for subLayer in drawLayer.sublayers!</div><div class="line">    {</div><div class="line">        subLayer.removeFromSuperlayer()</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="&#x4E8C;&#x7EF4;&#x7801;&#x521B;&#x5EFA;"><a href="#&#x4E8C;&#x7EF4;&#x7801;&#x521B;&#x5EFA;" class="headerlink" title="&#x4E8C;&#x7EF4;&#x7801;&#x521B;&#x5EFA;"></a>&#x4E8C;&#x7EF4;&#x7801;&#x521B;&#x5EFA;</h2><ul>
<li><p>&#x6839;&#x636E;&#x4FE1;&#x606F;&#x521B;&#x5EFA;&#x4E8C;&#x7EF4;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">// 1.&#x751F;&#x6210;&#x4E8C;&#x7EF4;&#x7801;</div><div class="line">       </div><div class="line">       // 1.&#x521B;&#x5EFA;&#x6EE4;&#x955C;</div><div class="line">       let filter = CIFilter(name: &quot;CIQRCodeGenerator&quot;)!</div><div class="line">       // 2.&#x8FD8;&#x539F;&#x6EE4;&#x955C;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;</div><div class="line">       filter.setDefaults()</div><div class="line">       // 3.&#x8BBE;&#x7F6E;&#x6570;&#x636E;</div><div class="line">       filter.setValue(&quot;&#x6781;&#x5BA2;&#x6C5F;&#x5357;&quot;.dataUsingEncoding(NSUTF8StringEncoding), forKey: &quot;inputMessage&quot;)</div><div class="line">       // 4.&#x4ECE;&#x6EE4;&#x955C;&#x4ECE;&#x53D6;&#x51FA;&#x4E8C;&#x7EF4;&#x7801;</div><div class="line">       let ciImage = filter.outputImage!</div><div class="line">       //        customImageView.image = UIImage(CIImage: ciImage)</div><div class="line">       //        customImageView.image = createNonInterpolatedUIImageFormCIImage(ciImage, size: 500)</div><div class="line">       let QRCodeImage = createNonInterpolatedUIImageFormCIImage(ciImage, size: 500)</div><div class="line">       </div><div class="line">       </div><div class="line">       // 5.&#x8BBE;&#x7F6E;&#x56FE;&#x7247;&#x5230;&#x754C;&#x9762;&#x4E0A;</div><div class="line">       image.image = QRCodeImage</div></pre></td></tr></table></figure>
</li>
<li><p>&#x751F;&#x6210;&#x9AD8;&#x6E05;&#x653E;&#x5927;&#x7684;&#x56FE;&#x50CF;</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">    &#x6839;&#x636E;CIImage&#x751F;&#x6210;&#x6307;&#x5B9A;&#x5927;&#x5C0F;&#x7684;&#x9AD8;&#x6E05;UIImage</div><div class="line">    </div><div class="line">    :param: image &#x6307;&#x5B9A;CIImage</div><div class="line">    :param: size    &#x6307;&#x5B9A;&#x5927;&#x5C0F;</div><div class="line">    :returns: &#x751F;&#x6210;&#x597D;&#x7684;&#x56FE;&#x7247;</div><div class="line">    */</div><div class="line">    private func createNonInterpolatedUIImageFormCIImage(image: CIImage, size: CGFloat) -&gt; UIImage {</div><div class="line">        </div><div class="line">        let extent: CGRect = CGRectIntegral(image.extent)</div><div class="line">        let scale: CGFloat = min(size/CGRectGetWidth(extent), size/CGRectGetHeight(extent))</div><div class="line">        </div><div class="line">        // 1.&#x521B;&#x5EFA;bitmap;</div><div class="line">        let width = CGRectGetWidth(extent) * scale</div><div class="line">        let height = CGRectGetHeight(extent) * scale</div><div class="line">        let cs: CGColorSpaceRef = CGColorSpaceCreateDeviceGray()!</div><div class="line">        let bitmapRef = CGBitmapContextCreate(nil, Int(width), Int(height), 8, 0, cs, 0)!</div><div class="line">        </div><div class="line">        let context = CIContext(options: nil)</div><div class="line">        let bitmapImage: CGImageRef = context.createCGImage(image, fromRect: extent)</div><div class="line">        </div><div class="line">        CGContextSetInterpolationQuality(bitmapRef,  CGInterpolationQuality.None)</div><div class="line">        CGContextScaleCTM(bitmapRef, scale, scale);</div><div class="line">        CGContextDrawImage(bitmapRef, extent, bitmapImage);</div><div class="line">        </div><div class="line">        // 2.&#x4FDD;&#x5B58;bitmap&#x5230;&#x56FE;&#x7247;</div><div class="line">        let scaledImage: CGImageRef = CGBitmapContextCreateImage(bitmapRef)!</div><div class="line">        </div><div class="line">        return UIImage(CGImage: scaledImage)</div><div class="line">    }</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/16/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2015-10-16T23:32:54+08:00" content="2015-10-16">
              2015-10-16
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/10/16/hello-world/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/16/hello-world/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></div></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/myAvatar.jpg"
               alt="Tyrion" />
          <p class="site-author-name" itemprop="name">Tyrion</p>
          <p class="site-description motion-element" itemprop="description">When you fall down,keep on getting back up</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">10</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tyrion</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"targaryen"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

</body>
</html>
